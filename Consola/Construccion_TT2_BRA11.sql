SELECT CON.NODO_TRANSFORM_V  AS TT2_CODIGOELEMENTO
    ,''                      AS TT2_IUA --GESTIONADO POR PROCEDIMIENTO
    ,COM.GRUPO_CALIDAD       AS TT2_GRUPOCALIDAD
    ,COM.ID_MERCADO          AS TT2_IDMERCADO
    ,CON.CAPACIDAD_NOMINAL   AS TT2_CAPACIDAD_TRAFO
    ,CPRO.PROPIETARIO_1      AS TT2_PROPIEDAD
    ,ET.TIPO_SUBESTACION     AS TT2_TSUBESTACION
    ,COM.COOR_GPS_LON        AS TT2_LONGITUD
    ,COM.COOR_GPS_LAT        AS TT2_LATITUD
    ,COM.COOR_Z              AS TT2_ALTITUD
    ,COM.ESTADO              AS TT2_ESTADO_PROPIO
    ,DECODE(ET.PROVISIONAL,'SI','CONSTRUCCION',COM.ESTADO) AS TT2_ESTADO_BRA11
    ,'CREG015'              AS TT2_RESMETODOLOGIA
    ,''                      AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
    ,CON.CIRCUITO            AS TT2_NOMBRE_CIRCUITO
    ,TT1.TT1_CODIGOCIRCUITO  AS TT2_IUL
    ,''                      AS TT2_CODIGOPROYECTO --INDEFINIDO
    ,COM.UC                  AS TT2_UNIDAD_CONSTRUCTIVA
    ,DECODE(CPRO.PROPIETARIO_1,'ESTADO','1','0') AS TT2_RPP
    ,DECODE(COM.SALINIDAD, 'SI', 1, 2) AS TT2_SALINIDAD
    ,''                      AS TT2_TIPOPROYECTO -- CREADO POR PROCEDIMIENTO
    ,2                       AS TT2_REMUNERACION_PENDIENTE 
    ,DECODE(DECODE(ET.PROVISIONAL,'SI','CONSTRUCCION',COM.ESTADO),'CONSTRUCCION','INVA'
                  ,'OPERACION','BRAEN'
                  ,'RETIRADO','BRAFO') AS TT2_ALTERNATIVA_VALORACION 
    ,''                      AS TT2_ID_PLAN
    ,''                      AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
    ,COM.FECHA_OPERACION     AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
    ,COM.FECHA_COLOCACION    AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
    ,COM.FECHA_MODIFICACION  AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
    ,COM.USUARIO_COLOCACION  AS TT2_USR_COLOCACION --PERS
    ,COM.USUARIO_MODIFICACION AS TT2_USR_MODFICACION

FROM
    CCONECTIVIDAD_E@GTECH  CON
    LEFT OUTER JOIN CCOMUN@GTECH           COM ON COM.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET ON ET.G3E_FID = COM.G3E_FID
    LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON CPRO.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN QA_TTT1_REGISTRO TT1 ON TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
WHERE COM.G3E_FNO = 20400

---PARA EXPANSION
/*

*/
--TRANSFORMDORES NO REPORTADOS EN TT2    
SELECT * FROM QA_TTT2_REGISTRO;     
SELECT * FROM CCOMUN@GTECH ;

---------------
SELECT CON.NODO_TRANSFORM_V, COM.ESTADO
FROM
    CCONECTIVIDAD_E@GTECH  CON
    LEFT OUTER JOIN CCOMUN@GTECH           COM ON COM.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET ON ET.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON CPRO.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN QA_TTT1_REGISTRO TT1 ON TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
WHERE
        COM.G3E_FNO = 20400
    AND COM.ESTADO='OPERACION'
    AND CON.NODO_TRANSFORM_V='1T13058'

    MINUS

SELECT TT2_CODIGOELEMENTO 
FROM QA_TTT2_REGISTRO;


--INVERSO, TRANSFORMADORES RETIRADOS

SELECT TT2_CODIGOELEMENTO 
FROM QA_TTT2_REGISTRO

MINUS

SELECT CON.NODO_TRANSFORM_V 
FROM
    CCONECTIVIDAD_E@GTECH  CON
    LEFT OUTER JOIN CCOMUN@GTECH           COM ON COM.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET ON ET.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON CPRO.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN QA_TTT1_REGISTRO TT1 ON TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
WHERE
        COM.G3E_FNO = 20400
    AND COM.ESTADO='OPERACION';



 --VERSION 2
 
(SELECT A.NODO_TRANSFORM_V
       ,B.GRUPO_CALIDAD
       ,B.ID_MERCADO
       ,A.CAPACIDAD_NOMINAL
       ,(CASE WHEN X.PROPIETARIO_1 = 'CENS' THEN 1 ELSE 2 END) PROPIEDAD
       ,C.TIPO_SUBESTACION
       ,B.COOR_GPS_LON
       ,B.COOR_GPS_LAT
       ,B.COOR_Z
       ,B.FECHA_OPERACION
       ,B.UC
       ,C.NRO_TRANSFORMADOR_V
       ,C.CODIGO
       ,B.ESTADO
 FROM CCONECTIVIDAD_E@GTECH A,CCOMUN@GTECH B,ETRANSFO_AT@GTECH C,CPROPIETARIO@GTECH X
 WHERE B.G3E_FID=A.G3E_FID AND C.G3E_FID=A.G3E_FID AND X.G3E_FID=A.G3E_FID and B.FECHA_COLOCACION BETWEEN TO_DATE ('01/09/2021','DD/MM/YYYY') AND TO_DATE ('30/09/2021','DD/MM/YYYY')AND B.FECHA_OPERACION BETWEEN TO_DATE ('01/01/2021','DD/MM/YYYY') AND CURRENT_DATE AND B.ESTADO IN ('OPERACION'))
UNION ALL--MINUS
(SELECT A.NODO_TRANSFORM_V
       ,B.GRUPO_CALIDAD
       ,B.ID_MERCADO
       ,A.CAPACIDAD_NOMINAL
       ,(CASE WHEN X.PROPIETARIO_1 = 'CENS' THEN 1 ELSE 2 END) PROPIEDAD
       ,C.TIPO_SUBESTACION
       ,B.COOR_GPS_LON
       ,B.COOR_GPS_LAT
       ,B.COOR_Z
       ,B.FECHA_OPERACION
       ,B.UC,C.NRO_TRANSFORMADOR_V
       ,C.CODIGO,B.ESTADO
 FROM CCONECTIVIDAD_E@GTECH A,CCOMUN@GTECH B,ETRANSFO_AT@GTECH C,CPROPIETARIO@GTECH X
 WHERE B.G3E_FID=A.G3E_FID 
  AND C.G3E_FID=A.G3E_FID 
  AND X.G3E_FID=A.G3E_FID 
  and B.FECHA_MODIFICACION BETWEEN TO_DATE ('01/09/2021','DD/MM/YYYY') 
  AND TO_DATE ('30/09/2021','DD/MM/YYYY') AND B.ESTADO IN ('RETIRADO'))
;

----VERSION DAVID

SELECT nodo_transform_v AS code, t.fabricante_trafo AS marca, c.codigo_marcacion AS nroserie, t.codigo AS serial, t.grupo_calidad AS grupo, c.grupo_calidad AS grupo_015, con.tension AS KV, con.capacidad_nominal AS KVA_, con.circuito AS alimentador,
usu.usuarios, TRANSLATE(c.ubicacion, 'ÁÉÍÓÚÑ,', 'AEIOUN') AS direccion_trafo, TRANSLATE(REPLACE(REPLACE(c.observaciones, CHR(10), ''), CHR(13), ''), 'Ñ,', 'N') AS elementos, c.coor_gps_lat AS coord_x, c.coor_gps_lon AS coord_y, c.coor_z AS altitud, con.capacidad_nominal AS area, TRANSLATE(con.subestacion, 'ÁÉÍÓÚÑ', 'AEIOUN') AS subestacion, t.tipo_propietario AS propiedad,
macro.numero_macro_spard, con.localizacion tipo_red, c.clasificacion_mercado AS tipo_poblacion, TRANSLATE(c.municipio, 'ÁÉÍÓÚÑ', 'AEIOUN') AS municipio, TRANSLATE(c.region, 'Ñ', 'N') AS region, con.fases AS fase, TRANSLATE(REPLACE(REPLACE(c.contrato_instalacion, CHR(10), ''), CHR(13), ''), 'Ñ,', 'N') AS caracteristicas, t.consumidor_ap AS alumbrado_exclusivo, c.fecha_remplazo
FROM etransfo_at@gtech t
JOIN ccomun@gtech c USING(g3e_fid)
JOIN cconectividad_e@gtech con USING(g3e_fid)
LEFT JOIN (
SELECT con.nodo_transform_v, COUNT(*) AS usuarios
FROM cconectividad_e@gtech con
JOIN ccomun@gtech c USING(g3e_fid)
WHERE con.g3e_fno = '20700'
GROUP BY con.nodo_transform_v
) usu USING(nodo_transform_v)
LEFT JOIN (
SELECT con.nodo_transform_v, LISTAGG (ec.codigo, '; ') WITHIN GROUP (ORDER BY ec.codigo) AS numero_macro_spard
FROM ecliente_at@gtech ec
JOIN cconectividad_e@gtech con USING(g3e_fid)
WHERE ec.tipo_cliente = 'MACROMEDIDOR' AND con.nodo_transform_v IS NOT NULL
GROUP BY con.nodo_transform_v
) macro USING(nodo_transform_v)
WHERE c.estado = 'OPERACION' AND nodo_transform_v IN ('3T02116', '1T05067');

--- PAPITA PAL LORO

SELECT ct.proyecto|| 
    DECODE (ct.municipio, 'SALAZAR', '54680', 'CÚCUTA', '54001', 'TIBÚ', '54003', 'SAN CAYETANO', '54673', 'CHINÁCOTA', '54172', 'EL ZULIA', '54261', 'AGUACHICA', '20011', 'PAMPLONITA', '54520', 'BOCHALEMA', '54099', ct.municipio) ||
    (SELECT EXTRACT (YEAR FROM SYSDATE) FROM DUAL) || 'NT' || t.tension_creg || ct.tipo_proyecto AS codigo_proyecto, ci.iua AS iul, NULL AS iua, 'falta_poblar' AS codigo_activo_provisional, ct.uc as codigo_unidad_constructiva,
    DECODE (p.propietario_1, 'CENS', 0, 1) AS rpp, DECODE (ct.salinidad, 'SI', 1, 2) AS salinidad, DECODE (ct.tipo_proyecto, 'I', 1, 'II', 2, 'III', 3, 'IV', 4, null) AS tipo_inversion,ct.tipo_proyecto, 'NA' AS observaciones,
    ct.fecha_operacion AS ano_entrada_salida_operacion, 'falta_regla' AS remuneracion_pendiente, 'falta_regla' AS estado, 'CREG 015' AS resolucion_creg, 'SI' AS cargado
FROM ccomun@gtech ct
    JOIN etransfo_at@gtech t ON ct.g3e_fid = t.g3e_fid
    JOIN cconectividad_e@gtech con ON ct.g3e_fid = con.g3e_fid
    JOIN einterru_at@gtech i ON con.circuito = i.codigo
    JOIN ccomun@gtech ci ON i.g3e_fid = ci.g3e_fid
    JOIN cpropietario@gtech p ON ci.g3e_fid = p.g3e_fid
--WHERE  ct.fecha_operacion > '01/07/2021' 
--WHERE DECODE (ct.tipo_proyecto, 'I', 1, 'II', 2, 'III', 3, 'IV', 4, null) is not null
ORDER BY ct.fecha_operacion DESC;

-----
SELECT 
    COM.FECHA_COLOCACION,
    COM.FECHA_OPERACION       AS FECHAESTADO,
    COM.FECHA_MODIFICACION    AS FECHA_PERIODO_FTO,
    CON.NODO_TRANSFORM_V      AS CODIGO_OR,
    'IUA'                     AS CODIGO_TRANFORMADOR,
    COM.GRUPO_CALIDAD,
    CON.CAPACIDAD_NOMINAL,
    CPRO.PROPIETARIO_1,
    ET.TIPO_SUBESTACION,
    COM.ID_MERCADO,
    COM.COOR_GPS_LON,
    COM.COOR_GPS_LAT,
    COM.COOR_Z,
    COM.ESTADO,
    'CREG 015'                AS RESOLUCION,
    COM.PROYECTO
FROM
    CCONECTIVIDAD_E  CON
    LEFT OUTER JOIN CCOMUN           COM ON COM.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN ETRANSFO_AT      ET ON ET.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN CPROPIETARIO     CPRO ON CPRO.G3E_FID = CON.G3E_FID
WHERE
        COM.G3E_FNO = 20400
    ;   
    
SELECT * FROM ALL_TABLES
WHERE TABLE_NAME LIKE 'QA_TTT2%';


CREATE PUBLIC DATABASE LINK GTECH
CONNECT TO LSANTAFE
IDENTIFIED BY MDEPROD2021
USING 'GENEPROD';

DROP PUBLIC DATABASE LINK GTECH; 

SELECT * FROM CCONECTIVIDAD_E@GTECH;



SELECT * FROM QA_TTC1
WHERE TC1_PERIODO='202109'
AND TC1_CODCONEX IN ('1T00586',	'1T04811',	'1T07374',	'1T08618',	'1T08891',	'1T10366',	'1TB0031',	'2T00124',	'2T00246',	'2T01464',	'3T03322');


ALTER TABLE BRAE.QA_TTT2_REGISTRO RENAME TO QA_TTT2_REGISTRO_ANT;

ALTER TABLE BRAE.QA_TTT2_REGISTRO_ANT
ADD TT2_PERIODO_OP DATE;


    
SELECT * FROM QA_TTT2_REGISTRO_ANT;

DELETE FROM QA_TTT2_REGISTRO_ANT;
COMMIT;




CREATE TABLE BRAE.QA_TTT2_REGISTRO(
	TT2_CODIGOELEMENTO	VARCHAR2(20)
,	TT2_IUA	VARCHAR2(20)
,	TT2_GRUPOCALIDAD	VARCHAR2(2)
,	TT2_IDMERCADO	VARCHAR2(20)
,	TT2_CAPACIDAD_TRAFO	NUMBER
,	TT2_PROPIEDAD	VARCHAR2(20)
,	TT2_TSUBESTACION	NUMBER
,	TT2_LONGITUD	NUMBER
,	TT2_LATITUD	NUMBER
,	TT2_ALTITUD	NUMBER
,	TT2_ESTADO_PROPIO	VARCHAR2(20)
,	TT2_ESTADO_BRA11	VARCHAR2(20)
,	TT2_RESMETODOLOGIA	VARCHAR2(20)
,	TT2_CLASS_CARGA	VARCHAR2(20)
,	TT2_NOMBRE_CIRCUITO	VARCHAR2(20)
,	TT2_IUL	VARCHAR2(5)
,	TT2_CODIGOPROYECTO	VARCHAR2(20)
,	TT2_UNIDAD_CONSTRUCTIVA	VARCHAR2(20)
,	TT2_RPP	NUMBER
,	TT2_SALINIDAD	VARCHAR2(2)
,	TT2_TIPOPROYECTO	VARCHAR2(5)
,	TT2_REMUNERACION_PENDIENTE	NUMBER
,	TT2_ALTERNATIVA_VALORACION	NUMBER
,	TT2_ID_PLAN	NUMBER
,	TT2_CANTIDAD_REPOSICIONES	NUMBER
,	TT2_FESTADO	DATE
,	TT2_FCOLOCACION	DATE
,	TT2_FMODIFICACION	DATE
,	TT2_USR_COLOCACION	VARCHAR2(20)
,	TT2_USR_MODFICACION	VARCHAR2(20)
);


SELECT * FROM QA_TTT2_REGISTRO;
DELETE FROM QA_TTT2_REGISTRO;
COMMIT;


INSERT INTO QA_TTT2_REGISTRO (	TT2_CODIGOELEMENTO
                            ,	TT2_CODE_IUA
                            ,	TT2_GRUPOCALIDAD
                            ,	TT2_IDMERCADO
                            ,	TT2_CAPACIDAD_TRAFO
                            ,	TT2_PROPIEDAD
                            ,	TT2_TSUBESTACION
                            ,	TT2_LONGITUD
                            ,	TT2_LATITUD
                            ,	TT2_ALTITUD
                            ,	TT2_ESTADO_PROPIO
                            ,	TT2_FESTADO
                            ,	TT2_RESMETODOLOGIA
                            ,	TT2_CLASS_CARGA
                            ,   TT2_PERIODO_OP
                            )
SELECT * FROM QA_TTT2_REGISTRO_ANT
;

SELECT * FROM QA_TTT2_REGISTRO_TEMP;
SELECT * FROM QA_TTT2_REGISTRO;



COMMIT;


CREATE TABLE BRAE.QA_TTT2_REGISTRO_TEMP(
	TT2_CODIGOELEMENTO	VARCHAR2(20)
,	TT2_IUA	VARCHAR2(20)
,	TT2_GRUPOCALIDAD	VARCHAR2(2)
,	TT2_IDMERCADO	VARCHAR2(20)
,	TT2_CAPACIDAD_TRAFO	NUMBER
,	TT2_PROPIEDAD	VARCHAR2(20)
,	TT2_TSUBESTACION	NUMBER
,	TT2_LONGITUD	NUMBER
,	TT2_LATITUD	NUMBER
,	TT2_ALTITUD	NUMBER
,	TT2_ESTADO_PROPIO	VARCHAR2(20)
,	TT2_ESTADO_BRA11	VARCHAR2(20)
,	TT2_RESMETODOLOGIA	VARCHAR2(20)
,	TT2_CLASS_CARGA	VARCHAR2(20)
,	TT2_NOMBRE_CIRCUITO	VARCHAR2(20)
,	TT2_IUL	VARCHAR2(5)
,	TT2_CODIGOPROYECTO	VARCHAR2(20)
,	TT2_UNIDAD_CONSTRUCTIVA	VARCHAR2(20)
,	TT2_RPP	NUMBER
,	TT2_SALINIDAD	VARCHAR2(2)
,	TT2_TIPOPROYECTO	VARCHAR2(5)
,	TT2_REMUNERACION_PENDIENTE	NUMBER
,	TT2_ALTERNATIVA_VALORACION	VARCHAR2(20)
,	TT2_ID_PLAN	NUMBER
,	TT2_CANTIDAD_REPOSICIONES	NUMBER
,	TT2_FESTADO	DATE
,	TT2_FCOLOCACION	DATE
,	TT2_FMODIFICACION	DATE
,	TT2_USR_COLOCACION	VARCHAR2(20)
,	TT2_USR_MODFICACION	VARCHAR2(20)
,   TT2_PERIODO_OP DATE
);



DELETE FROM QA_TTT2_REGISTRO_TEMP;

COMMIT;

INSERT INTO QA_TTT2_REGISTRO_TEMP
SELECT CON.NODO_TRANSFORM_V  AS TT2_CODIGOELEMENTO
    ,''                      AS TT2_IUA --GESTIONADO POR PROCEDIMIENTO
    ,COM.GRUPO_CALIDAD       AS TT2_GRUPOCALIDAD
    ,COM.ID_MERCADO          AS TT2_IDMERCADO
    ,CON.CAPACIDAD_NOMINAL   AS TT2_CAPACIDAD_TRAFO
    ,CPRO.PROPIETARIO_1      AS TT2_PROPIEDAD
    ,TO_NUMBER(ET.TIPO_SUBESTACION)     AS TT2_TSUBESTACION
    ,COM.COOR_GPS_LON        AS TT2_LONGITUD
    ,COM.COOR_GPS_LAT        AS TT2_LATITUD
    ,COM.COOR_Z              AS TT2_ALTITUD
    ,COM.ESTADO              AS TT2_ESTADO_PROPIO
    ,DECODE(ET.PROVISIONAL,'SI','CONSTRUCCION',COM.ESTADO) AS TT2_ESTADO_BRA11
    ,'CREG 015'              AS TT2_RESMETODOLOGIA
    ,''                      AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
    ,CON.CIRCUITO            AS TT2_NOMBRE_CIRCUITO
    ,TT1.TT1_CODIGOCIRCUITO  AS TT2_IUL
    ,''                      AS TT2_CODIGOPROYECTO --INDEFINIDO
    ,COM.UC                  AS TT2_UNIDAD_CONSTRUCTIVA
    ,DECODE(CPRO.PROPIETARIO_1,'ESTADO',1,0) AS TT2_RPP
    ,DECODE(COM.SALINIDAD, 'SI', 1, 2) AS TT2_SALINIDAD
    ,''                      AS TT2_TIPOPROYECTO -- CREADO POR PROCEDIMIENTO
    ,2                       AS TT2_REMUNERACION_PENDIENTE 
    ,DECODE(DECODE(ET.PROVISIONAL,'SI','CONSTRUCCION',COM.ESTADO),'CONSTRUCCION','INVA'
                  ,'OPERACION','BRAEN'
                  ,'RETIRADO','BRAFO') AS TT2_ALTERNATIVA_VALORACION 
    ,NULL                    AS TT2_ID_PLAN
    ,0                      AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
    ,COM.FECHA_OPERACION     AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
    ,COM.FECHA_COLOCACION    AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
    ,COM.FECHA_MODIFICACION  AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
    ,COM.USUARIO_COLOCACION  AS TT2_USR_COLOCACION --PERS
    ,COM.USUARIO_MODIFICACION AS TT2_USR_MODFICACION
    ,TO_DATE('01/01/2021','DD/MM/YYYY') AS TT2_PERIODO_OP
FROM
    CCONECTIVIDAD_E@GTECH  CON
    LEFT OUTER JOIN CCOMUN@GTECH           COM ON COM.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET ON ET.G3E_FID = COM.G3E_FID
    LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON CPRO.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN QA_TTT1_REGISTRO TT1 ON TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
WHERE COM.G3E_FNO = 20400

--AND CON.NODO_TRANSFORM_V IN ('1T10005',	'1T13053',	'1T13058',	'1T13060',	'1T13061',	'1T13063',	'1T13064',	'1T13066',	'1T13067',	'1T13078',	'1T13079',	'1T13080',	'1T13081',	'1T13085',	'1T13087',	'1T13088',	'1T13089',	'1T13091',	'1T13092',	'1T13104',	'1T13105',	'1T13112',	'1T13119',	'1T13120',	'1T13131',	'1T13132',	'1T13140',	'1T13156',	'1T13157',	'1T13158',	'1T13159',	'1T13160',	'1T13161',	'1T13162',	'1T13163',	'2T02456',	'3T04900',	'3T04936',	'3T04937',	'4T01676',	'5T02964',	'5T02965')
--AND CON.NODO_TRANSFORM_V IN ('1T00586',	'1T04811',	'1T07374',	'1T08618',	'1T08891',	'1T10366',	'1TB0031',	'2T00124',	'2T00246',	'2T01464',	'3T03322')
;


SELECT COUNT(*)
FROM 
    CCONECTIVIDAD_E@GTECH  CON
    LEFT OUTER JOIN CCOMUN@GTECH           COM ON COM.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET ON ET.G3E_FID = COM.G3E_FID
    LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON CPRO.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN QA_TTT1_REGISTRO TT1 ON TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
WHERE COM.G3E_FNO = 20400
;
--DROP TABLE BRAE.QA_TTT2_REGISTRO_TEMP;
--DROP TABLE BRAE.QA_TTT2_REGISTRO; 22461  Filas

SELECT * FROM CAT WHERE TABLE_NAME LIKE 'BIN%';


SELECT * FROM QA_TTT2_REGISTRO_TEMP
WHERE TT2_FCOLOCACION IS NOT NULL;

SELECT * FROM QA_TTT2_REGISTRO;

COMMIT;

CREATE TABLE BRAE.QA_TTT2_REGISTRO_TEMP2(
	TT2_CODIGOELEMENTO	VARCHAR2(20)
,	TT2_IUA	VARCHAR2(20)
,	TT2_GRUPOCALIDAD	VARCHAR2(2)
,	TT2_IDMERCADO	VARCHAR2(20)
,	TT2_CAPACIDAD_TRAFO	NUMBER
,	TT2_PROPIEDAD	VARCHAR2(20)
,	TT2_TSUBESTACION	NUMBER
,	TT2_LONGITUD	NUMBER
,	TT2_LATITUD	NUMBER
,	TT2_ALTITUD	NUMBER
,	TT2_ESTADO_PROPIO	VARCHAR2(20)
,	TT2_ESTADO_BRA11	VARCHAR2(20)
,	TT2_RESMETODOLOGIA	VARCHAR2(20)
,	TT2_CLASS_CARGA	VARCHAR2(20)
,	TT2_NOMBRE_CIRCUITO	VARCHAR2(20)
,	TT2_IUL	VARCHAR2(5)
,	TT2_CODIGOPROYECTO	VARCHAR2(20)
,	TT2_UNIDAD_CONSTRUCTIVA	VARCHAR2(20)
,	TT2_RPP	NUMBER
,	TT2_SALINIDAD	VARCHAR2(2)
,	TT2_TIPOPROYECTO	VARCHAR2(5)
,	TT2_REMUNERACION_PENDIENTE	NUMBER
,	TT2_ALTERNATIVA_VALORACION	VARCHAR2(20)
,	TT2_ID_PLAN	NUMBER
,	TT2_CANTIDAD_REPOSICIONES	NUMBER
,	TT2_FESTADO	DATE
,	TT2_FCOLOCACION	DATE
,	TT2_FMODIFICACION	DATE
,	TT2_USR_COLOCACION	VARCHAR2(20)
,	TT2_USR_MODFICACION	VARCHAR2(20)
,   TT2_PERIODO_OP DATE
);

DELETE FROM QA_TTT2_REGISTRO_TEMP2;
COMMIT;


SELECT * FROM QA_TTT2_REGISTRO;

--CRUCE DE INFORMACION
INSERT INTO QA_TTT2_REGISTRO_TEMP2
SELECT 	TP.	TT2_CODIGOELEMENTO
,	TP.	TT2_CODE_IUA
,	TP.	TT2_GRUPOCALIDAD
,	TP.	TT2_IDMERCADO
,	TP.	TT2_CAPACIDAD_TRAFO
,	TP.	TT2_PROPIEDAD
,	TP.	TT2_TSUBESTACION
,	TP.	TT2_LONGITUD
,	TP.	TT2_LATITUD
,	TP.	TT2_ALTITUD
,	'OPERACION'
,	TEMP.TT2_ESTADO_BRA11
,	TP.	TT2_RESMETODOLOGIA
,	TP.	TT2_CLASS_CARGA
,	TEMP.	TT2_NOMBRE_CIRCUITO
,	TEMP.	TT2_IUL
,	TEMP.	TT2_CODIGOPROYECTO
,	TEMP.	TT2_UNIDAD_CONSTRUCTIVA
,	TEMP.	TT2_RPP
,	TEMP.	TT2_SALINIDAD
,	TEMP.	TT2_TIPOPROYECTO
,	TEMP.	TT2_REMUNERACION_PENDIENTE
,	TEMP.	TT2_ALTERNATIVA_VALORACION
,	TEMP.	TT2_ID_PLAN
,	TEMP.	TT2_CANTIDAD_REPOSICIONES
,	TP.	TT2_FESTADO
,	TEMP.	TT2_FCOLOCACION
,	TEMP.	TT2_FMODIFICACION
,	TEMP.	TT2_USR_COLOCACION
,	TEMP.	TT2_USR_MODFICACION 
,   TP.     TT2_PERIODO_OP
FROM QA_TTT2_REGISTRO TP
LEFT JOIN (SELECT * FROM QA_TTT2_REGISTRO_TEMP WHERE TT2_ESTADO_PROPIO='OPERACION') TEMP 
ON TP.TT2_CODIGOELEMENTO=TEMP.TT2_CODIGOELEMENTO
;

COMMIT;

SELECT  * FROM QA_TTT2_REGISTRO;

DELETE FROM QA_TTT2_REGISTRO;
COMMIT;

INSERT INTO QA_TTT2_REGISTRO
SELECT * FROM QA_TTT2_REGISTRO_TEMP2;


SELECT * FROM QA_TTT2_REGISTRO_TEMP
;--WHERE TT2_FCOLOCACION IS NOT NULL;

--DELETE FROM QA_TTT2_REGISTRO;
DELETE FROM QA_TTT2_REGISTRO_TEMP;
DELETE FROM QA_TTT2_REGISTRO_TEMP2;
--DELETE FROM QA_TTT2_REGISTRO_ANR;

--COMMIT;

SELECT TT2_CODIGOELEMENTO,TT2_IUA FROM QA_TTT2_REGISTRO
;--WHERE TT2_FCOLOCACION IS NOT NULL;

SELECT DISTINCT TT2_PERIODO_OP FROM QA_TTT2_REPORTE;

DROP TABLE QA_TTT2_REGISTRO_TEMP;
DROP TABLE QA_TTT2_REGISTRO_TEMP2;


ALTER TABLE QA_TTT2_REGISTRO
ADD (TT2_PERIODO_OP DATE);

SELECT * FROM QA_TTT2_REGISTRO;


UPDATE QA_TTT2_REGISTRO
SET TT2_PERIODO_OP ='01/01/2021'
;


DESC QA_TTT2_REGISTRO;

ALTER TABLE BRAE.QA_TTT2_TEMP
ADD TT2_PERIODO_OP DATE;



SELECT * 
FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT TT2_CODIGOELEMENTO
                            FROM QA_TTT2_TEMP
                            WHERE TT2_ESTADO_PROPIO='OPERACION'
                            MINUS
                            SELECT TT2_CODIGOELEMENTO
                            FROM QA_TTT2_REGISTRO
                            );


SELECT TT2_CODIGOELEMENTO
FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('1T10005');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/10/2021'
;--AND TT2_ESTADO_PROPIO='RETIRADO';

EXEC QA_PTT2(TO_DATE('01/10/2021','DD/MM/YYYY'));


CREATE TABLE BRAE.QA_TTT2_OBS(
	TT2_CODIGOELEMENTO	VARCHAR2(20)
,	TT2_IUA	VARCHAR2(20)
,	TT2_GRUPOCALIDAD	VARCHAR2(2)
,	TT2_IDMERCADO	VARCHAR2(20)
,	TT2_CAPACIDAD_TRAFO	NUMBER
,	TT2_PROPIEDAD	VARCHAR2(20)
,	TT2_TSUBESTACION	NUMBER
,	TT2_LONGITUD	NUMBER
,	TT2_LATITUD	NUMBER
,	TT2_ALTITUD	NUMBER
,	TT2_ESTADO_PROPIO	VARCHAR2(20)
,	TT2_ESTADO_BRA11	VARCHAR2(20)
,	TT2_RESMETODOLOGIA	VARCHAR2(20)
,	TT2_CLASS_CARGA	VARCHAR2(20)
,	TT2_NOMBRE_CIRCUITO	VARCHAR2(20)
,	TT2_IUL	VARCHAR2(5)
,	TT2_CODIGOPROYECTO	VARCHAR2(20)
,	TT2_UNIDAD_CONSTRUCTIVA	VARCHAR2(20)
,	TT2_RPP	NUMBER
,	TT2_SALINIDAD	VARCHAR2(2)
,	TT2_TIPOPROYECTO	VARCHAR2(5)
,	TT2_REMUNERACION_PENDIENTE	NUMBER
,	TT2_ALTERNATIVA_VALORACION	VARCHAR2(20)
,	TT2_ID_PLAN	NUMBER
,	TT2_CANTIDAD_REPOSICIONES	NUMBER
,	TT2_FESTADO	DATE
,	TT2_FCOLOCACION	DATE
,	TT2_FMODIFICACION	DATE
,	TT2_USR_COLOCACION	VARCHAR2(20)
,	TT2_USR_MODFICACION	VARCHAR2(20)
,   TT2_PERIODO_OP DATE
);


SELECT * FROM QA_TTT2_REGISTRO
WHERE TO_CHAR(TT2_FESTADO,'YYYY')<>TO_CHAR(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'),'YYYY')
AND TT2_PERIODO_OP=TRUNC(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/10/2021'
;--AND TT2_ESTADO_PROPIO='RETIRADO';

EXEC QA_PTT2(TO_DATE('01/10/2021','DD/MM/YYYY'));
SELECT * FROM QA_TTT2_OBS;

select * from qa_ttt1_registro;

SELECT * 
FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/10/2021'
AND(	TT2_GRUPOCALIDAD	IS NULL
    OR	TT2_IDMERCADO	IS NULL
    OR	TT2_CAPACIDAD_TRAFO	IS NULL
    OR	TT2_PROPIEDAD	IS NULL
    OR	TT2_TSUBESTACION	IS NULL
    OR	TT2_LONGITUD	IS NULL
    OR	TT2_LATITUD	IS NULL
    OR	TT2_ALTITUD	IS NULL
    OR	TT2_ESTADO_PROPIO	IS NULL
    OR	TT2_ESTADO_BRA11	IS NULL
    OR	TT2_NOMBRE_CIRCUITO	IS NULL
    OR	TT2_IUL	IS NULL
    OR	TT2_UNIDAD_CONSTRUCTIVA	IS NULL
    )
;

EXEC QA_PTT2(TO_DATE('01/10/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

UPDATE QA_TTT2_REGISTRO
SET TT2_TIPOPROYECTO='2'
WHERE TT2_PERIODO_OP='01/10/2021'
AND (TT2_TIPOPROYECTO<>'T4' OR TT2_TIPOPROYECTO IS NULL)
;

UPDATE QA_TTT2_REGISTRO
SET TT2_TIPOPROYECTO='4'
WHERE TT2_PERIODO_OP='01/10/2021'
AND TT2_TIPOPROYECTO='T4'
;


EXEC QA_PTT2(TO_DATE('01/10/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/10/2021';

SELECT * FROM qa_ttt2_temp;


--REPOSICION

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT DISTINCT T1.TT2_CODIGOELEMENTO
                            FROM QA_TTT2_TEMP T1
                            INNER  JOIN (SELECT DISTINCT TT2_CODIGOELEMENTO 
                                         FROM QA_TTT2_TEMP
                                         WHERE TT2_ESTADO_PROPIO='OPERACION'
                                         ) T2 ON T2.TT2_CODIGOELEMENTO=T1.TT2_CODIGOELEMENTO
                            WHERE TT2_ESTADO_PROPIO='RETIRADO'
                            AND TO_CHAR(TT2_FMODIFICACION,'MM/YYYY') 
                              = TO_CHAR(TO_DATE('01/10/2021','DD/MM/YYYY'),'MM/YYYY')
                            );


SELECT DISTINCT T1.TT2_CODIGOELEMENTO
FROM QA_TTT2_TEMP T1
WHERE TT2_ESTADO_PROPIO='RETIRADO'
MINUS
SELECT DISTINCT TT2_CODIGOELEMENTO 
FROM QA_TTT2_TEMP
WHERE TT2_ESTADO_PROPIO='OPERACION';

SELECT * FROM QA_TTT2_TEMP 
WHERE TT2_CODIGOELEMENTO IN (
SELECT DISTINCT T1.TT2_CODIGOELEMENTO
FROM QA_TTT2_TEMP T1
INNER  JOIN (SELECT DISTINCT TT2_CODIGOELEMENTO 
             FROM QA_TTT2_TEMP
             WHERE TT2_ESTADO_PROPIO='OPERACION'
             ) T2 ON T2.TT2_CODIGOELEMENTO=T1.TT2_CODIGOELEMENTO
WHERE TT2_ESTADO_PROPIO='RETIRADO'
--AND TO_CHAR(TT2_FMODIFICACION,'MM/YYY') = TO_CHAR(TO_DATE('01/10/2021','DD/MM/YYYY'),'MM/YYYY')
)
AND TT2_ESTADO_PROPIO='RETIRADO'
;



EXEC QA_PTT2(TO_DATE('01/10/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/10/2021'
AND TT2_TIPOPROYECTO IS NULL
;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='2T00582';

	TT2_GRUPOCALIDAD
,	TT2_IDMERCADO
,	TT2_CAPACIDAD_TRAFO
,	TT2_PROPIEDAD
,	TT2_TSUBESTACION
,	TT2_LONGITUD
,	TT2_LATITUD
,	TT2_ALTITUD

SELECT 	TT2_GRUPOCALIDAD
,	TT2_IDMERCADO
,	TT2_CAPACIDAD_TRAFO
,	TT2_PROPIEDAD
,	TT2_TSUBESTACION
,	TT2_LONGITUD
,	TT2_LATITUD
,	TT2_ALTITUD
FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/10/2021'
AND TT2_ESTADO_PROPIO='RETIRADO';


SELECT 	TT2_GRUPOCALIDAD
,	TT2_IDMERCADO
,	TT2_CAPACIDAD_TRAFO
,	TT2_PROPIEDAD
,	TT2_TSUBESTACION
,	TT2_LONGITUD
,	TT2_LATITUD
,	TT2_ALTITUD
FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/10/2021'
AND TT2_ESTADO_PROPIO='RETIRADO';



SELECT TT2_GRUPOCALIDAD    
,	TT2_IDMERCADO
,	TT2_CAPACIDAD_TRAFO
,	TT2_PROPIEDAD
,	TT2_TSUBESTACION
,	TT2_LONGITUD
,	TT2_LATITUD
,	TT2_ALTITUD
FROM BRAE.QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP<>TO_DATE('01/10/2021','DD/MM/YYYY');



SELECT 	T1.	TT2_CODIGOELEMENTO
,	T1.	TT2_IUA
,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
         THEN T2.TT2_GRUPOCALIDAD  
         ELSE T1.TT2_GRUPOCALIDAD 
    END) AS TT2_GRUPOCALIDAD
,	T1.	TT2_IDMERCADO
,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
         THEN T2.TT2_CAPACIDAD_TRAFO  
         ELSE T1.TT2_CAPACIDAD_TRAFO 
    END) AS TT2_CAPACIDAD_TRAFO
,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
         THEN T2.TT2_PROPIEDAD  
         ELSE T1.TT2_PROPIEDAD 
    END) AS TT2_PROPIEDAD
,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
         THEN T2.TT2_TSUBESTACION  
         ELSE T1.TT2_TSUBESTACION 
    END) AS TT2_TSUBESTACION
,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
         THEN T2.TT2_LONGITUD  
         ELSE T1.TT2_LONGITUD 
    END) AS TT2_LONGITUD
,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
         THEN T2.TT2_LATITUD  
         ELSE T1.TT2_LATITUD 
    END) AS TT2_LATITUD
,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
         THEN T2.TT2_ALTITUD  
         ELSE T1.TT2_ALTITUD 
    END) AS TT2_ALTITUD
,	T1.	TT2_ESTADO_PROPIO
,	T1.	TT2_ESTADO_BRA11
,	T1.	TT2_RESMETODOLOGIA
,	T1.	TT2_CLASS_CARGA
,	T1.	TT2_NOMBRE_CIRCUITO
,	T1.	TT2_IUL
,	T1.	TT2_CODIGOPROYECTO
,	T1.	TT2_UNIDAD_CONSTRUCTIVA
,	T1.	TT2_RPP
,	T1.	TT2_SALINIDAD
,	T1.	TT2_TIPOPROYECTO
,	T1.	TT2_REMUNERACION_PENDIENTE
,	T1.	TT2_ALTERNATIVA_VALORACION
,	T1.	TT2_ID_PLAN
,	T1.	TT2_CANTIDAD_REPOSICIONES
,	T1.	TT2_FESTADO
,	T1.	TT2_FCOLOCACION
,	T1.	TT2_FMODIFICACION
,	T1.	TT2_USR_COLOCACION
,	T1.	TT2_USR_MODFICACION
,	T1.	TT2_PERIODO_OP
BULK COLLECT INTO V_QA_TTT2_REGISTRO
FROM QA_TTT2_TEMP T1
LEFT OUTER JOIN (SELECT TT2_CODIGOELEMENTO
                    ,   TT2_GRUPOCALIDAD    
                    ,	TT2_IDMERCADO
                    ,	TT2_CAPACIDAD_TRAFO
                    ,	TT2_PROPIEDAD
                    ,	TT2_TSUBESTACION
                    ,	TT2_LONGITUD
                    ,	TT2_LATITUD
                    ,	TT2_ALTITUD
                 FROM BRAE.QA_TTT2_REGISTRO
                 WHERE TRUNC(TT2_PERIODO_OP)<>TRUNC(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'))
                 ) T2 ON T2.TT2_CODIGOELEMENTO=T1.TT2_CODIGOELEMENTO
WHERE T1.TT2_CODIGOELEMENTO IN (
                                SELECT DISTINCT T1.TT2_CODIGOELEMENTO
                                FROM QA_TTT2_TEMP T1
                                INNER  JOIN (SELECT DISTINCT TT2_CODIGOELEMENTO 
                                             FROM QA_TTT2_TEMP
                                             WHERE TT2_ESTADO_PROPIO='OPERACION'
                                             ) T2 ON T2.TT2_CODIGOELEMENTO=T1.TT2_CODIGOELEMENTO
                                WHERE TT2_ESTADO_PROPIO='RETIRADO'
                                AND TO_CHAR(TT2_FMODIFICACION,'MM/YYYY') 
                                  = TO_CHAR(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'),'MM/YYYY')
                                )
;



EXEC QA_PTT2(TO_DATE('01/10/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/10/2021'
AND TT2_TIPOPROYECTO IS NULL
;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='3T00799';

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP IS NULL
OR TT2_PERIODO_OP = TO_DATE('01/01/2021','DD/MM/YYYY')
;

SELECT DISTINCT TT2_PERIODO_OP FROM QA_TTT2_REGISTRO
;

UPDATE QA_TTT2_REGISTRO
SET TT2_PERIODO_OP = TO_DATE('01/01/2021','DD/MM/YYYY HH24:MI:SS')
WHERE TT2_PERIODO_OP IS NULL
;


SELECT DISTINCT TT2_PERIODO_OP FROM QA_TTT2_REGISTRO
;

--COMMIT;

EXEC QA_PTT2(TO_DATE('01/10/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/10/2021'
AND TT2_TIPOPROYECTO IS NULL
AND TT2_CODIGOELEMENTO IN ('4T00172','3T00799');



SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_TIPOPROYECTO IS NULL
AND TT2_PERIODO_OP = TO_DATE('01/10/2021','DD/MM/YYYY')
;





SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='4T00172';







 SELECT CON.NODO_TRANSFORM_V  AS TT2_CODIGOELEMENTO
            ,''                      AS TT2_IUA --GESTIONADO POR PROCEDIMIENTO
            ,TO_CHAR(COM.GRUPO_CALIDAD)       AS TT2_GRUPOCALIDAD
            ,TO_CHAR(COM.ID_MERCADO)          AS TT2_IDMERCADO
            ,TO_NUMBER(CON.CAPACIDAD_NOMINAL)   AS TT2_CAPACIDAD_TRAFO
            ,TO_CHAR(CASE WHEN CPRO.PROPIETARIO_1='CENS'
                          THEN '1'
                          ELSE '0'
                     END)      AS TT2_PROPIEDAD
            ,TO_NUMBER(ET.TIPO_SUBESTACION)     AS TT2_TSUBESTACION
            ,TO_NUMBER(COM.COOR_GPS_LON)        AS TT2_LONGITUD
            ,TO_NUMBER(COM.COOR_GPS_LAT)        AS TT2_LATITUD
            ,TO_NUMBER(COM.COOR_Z)              AS TT2_ALTITUD
            ,COM.ESTADO              AS TT2_ESTADO_PROPIO
            ,DECODE(ET.PROVISIONAL,'SI','CONSTRUCCION',COM.ESTADO) AS TT2_ESTADO_BRA11
            ,'CREG 015'              AS TT2_RESMETODOLOGIA
            ,''                      AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
            ,CON.CIRCUITO            AS TT2_NOMBRE_CIRCUITO
            ,TT1.TT1_CODIGOCIRCUITO  AS TT2_IUL
            ,''                      AS TT2_CODIGOPROYECTO --INDEFINIDO
            ,COM.UC                  AS TT2_UNIDAD_CONSTRUCTIVA
            ,DECODE(CPRO.PROPIETARIO_1,'ESTADO',1,0) AS TT2_RPP
            ,DECODE(COM.SALINIDAD, 'SI', '1', '2') AS TT2_SALINIDAD
            ,(CASE WHEN COM.TIPO_PROYECTO='T4'
                   THEN 'T4'
                   ELSE NULL
                   END)              AS TT2_TIPOPROYECTO -- CONFIGURADO POR PROCEDIMIENTO
            ,2                       AS TT2_REMUNERACION_PENDIENTE 
            ,DECODE(DECODE(ET.PROVISIONAL,'SI','CONSTRUCCION',COM.ESTADO),'CONSTRUCCION','INVA'
                          ,'OPERACION','BRAEN'
                          ,'RETIRADO','BRAFO') AS TT2_ALTERNATIVA_VALORACION 
            ,NULL                    AS TT2_ID_PLAN
            ,0                      AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
            ,COM.FECHA_OPERACION     AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
            ,COM.FECHA_COLOCACION    AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
            ,COM.FECHA_MODIFICACION  AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
            ,COM.USUARIO_COLOCACION  AS TT2_USR_COLOCACION --PERS
            ,COM.USUARIO_MODIFICACION AS TT2_USR_MODFICACION
            --,TRUNC(FECHAOPERACION)    AS TT2_PERIODO_OP
            ,ET.PROVISIONAL           AS PROVISIONAL
        --BULK COLLECT INTO V_QA_TTT2_REGISTRO
        FROM CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM ON COM.G3E_FID = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET ON ET.G3E_FID = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON CPRO.G3E_FID = CON.G3E_FID
            LEFT OUTER JOIN QA_TTT1_REGISTRO TT1 ON TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
        WHERE COM.G3E_FNO = 20400
        ;--AND   ET.PROVISIONAL = 'SI';
        
        

DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/10/2021','DD/MM/YYYY');
--COMMIT;

EXEC QA_PTT2(TO_DATE('01/10/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/10/2021'
and TT2_CODIGOELEMENTO IN ('1T13180','2T02457')
;

DESC QA_TTC1;


SELECT DISTINCT FDD_CODIGOELEMENTO FROM QA_TFDDREGISTRO
WHERE TRUNC(FDD_FINICIAL) = TO_DATE('01/11/2021','DD/MM/YYYY');


SELECT * FROM QA_TTC1 WHERE TC1_PERIODO='202109';


SELECT * FROM QA_TFDDREPORTE WHERE FDR_CODIGOEVENTO='864469';

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/10/2021';

SELECT * FROM QA_TTT2_REGISTRO_ANT;


DELETE QA_TTT2_REGISTRO;
DELETE QA_TTT2_REGISTRO_ANT;
DELETE FROM QA_TTT2_REGISTRO_TEMP;
DELETE FROM QA_TTT2_REGISTRO_TEMP2;
COMMIT;



SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP IS NULL
;

UPDATE QA_TTT2_REGISTRO
SET TT2_PERIODO_OP=TO_DATE('01/01/2021','DD/MM/YYYY')
WHERE TT2_PERIODO_OP IS NULL
;

--COMMIT;


EXEC QA_PTT2(TO_DATE('01/11/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/11/2021';

SELECT * FROM QA_TTT2_OBS;

        
        
SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP             ='01/11/2021'
AND   TT2_TIPOPROYECTO           IS NULL
--AND   TT2_ALTERNATIVA_VALORACION = 'BRAFO'
AND TT2_CODIGOELEMENTO='3T00799'
ORDER BY 1;  

--ACTIVOS CON REPOSICIONES EN EL PERIODO
SELECT TT2_CODIGOELEMENTO
FROM QA_TTT2_REGISTRO
GROUP BY TT2_CODIGOELEMENTO
HAVING COUNT(TT2_CODIGOELEMENTO)>1;



--IDENTIFICAR EL BRAFO MAS VIEJO
UPDATE QA_TTT2_REGISTRO
--SET   TT2_CAPACIDAD_TRAFO = 
WHERE TT2_PERIODO_OP             ='01/11/2021'
AND   TT2_TIPOPROYECTO           IS NULL
AND   TT2_ALTERNATIVA_VALORACION = 'BRAFO'
AND TT2_CODIGOELEMENTO='3T00799'
AND TT2_FMODIFICACION = (SELECT MIN(TT2_FMODIFICACION) 
                         FROM QA_TTT2_REGISTRO
                         WHERE TT2_PERIODO_OP             ='01/11/2021'
                         AND   TT2_TIPOPROYECTO           IS NULL
                         AND   TT2_ALTERNATIVA_VALORACION = 'BRAFO'
                         AND TT2_CODIGOELEMENTO='3T00799'
                         )
;  





SELECT * FROM QA_TTT2_REGISTRO;
SELECT * FROM QA_TTT2_REGISTRO;




SELECT *
FROM BRAE.QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE(:PERIODO_ACTUAL,'DD/MM/YYYY');
;

SELECT DISTINCT TT2_CODIGOELEMENTO-
--BULK COLLECT INTO V_ACTIVOS_REPUESTOS
FROM BRAE.QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE(:PERIODO_ACTUAL,'DD/MM/YYYY')
  AND TT2_TIPOPROYECTO IS NULL;

SELECT TT2_CODIGOELEMENTO
--BULK COLLECT INTO V_ACTIVOS_REPUESTOS
FROM BRAE.QA_TTT2_REGISTRO
GROUP BY TT2_CODIGOELEMENTO
HAVING COUNT(TT2_CODIGOELEMENTO)>1
;

SELECT *
FROM BRAE.QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO = '3T00799'
AND   TT2_PERIODO_OP = TO_DATE(:PERIODO_ACTUAL,'DD/MM/YYYY')
AND   TT2_FMODIFICACION IN (
                            SELECT MIN(TT2_FMODIFICACION) 
                            FROM QA_TTT2_REGISTRO
                            WHERE TT2_CODIGOELEMENTO = '3T00799'
                            AND TT2_PERIODO_OP = TO_DATE(:PERIODO_ACTUAL,'DD/MM/YYYY')
                           )
;









SELECT *
FROM BRAE.QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO = '3T00799'
AND   TT2_PERIODO_OP = TO_DATE(:PERIODO_ACTUAL,'DD/MM/YYYY')
AND   TT2_ALTERNATIVA_VALORACION = 'BRAFO'
;




SELECT MIN(TT2_FMODIFICACION) 
FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO = '3T00799'
AND   TT2_ALTERNATIVA_VALORACION = 'BRAFO'
AND TT2_PERIODO_OP = TO_DATE(:PERIODO_ACTUAL,'DD/MM/YYYY');

---------------REINICIO DE EJECUION
DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/11/2021';
COMMIT;

EXEC QA_PTT2(TO_DATE('01/11/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/11/2021'
AND TT2_TIPOPROYECTO IS NULL;

SELECT * FROM QA_TTT2_OBS;

---------------------------------------------
---FOR PRIMER NIVEL
SELECT TT2_CODIGOELEMENTO
FROM QA_TTT2_REGISTRO
GROUP BY TT2_CODIGOELEMENTO
HAVING COUNT(TT2_CODIGOELEMENTO)>1;


---FOR ANIDADO SEGUNDO NIVEL 
SELECT TT2_CODIGOELEMENTO
      ,TT2_UNIDAD_CONSTRUCTIVA 
      ,TT2_FMODIFICACION
      ,TT2_ALTERNATIVA_VALORACION
      ,TT2_CODE_IUA
      ,TT2_TIPOPROYECTO
FROM BRAE.QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO = '4T00618'
AND   TT2_PERIODO_OP =  TO_DATE(:PERIODO_ACTUAL,'DD/MM/YYYY')
ORDER BY TT2_FMODIFICACION;


SELECT TT2_CODIGOELEMENTO
      ,TT2_UNIDAD_CONSTRUCTIVA
      ,TT2_FMODIFICACION
      ,TT2_ALTERNATIVA_VALORACION
      ,TT2_CODE_IUA
FROM BRAE.QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO = '4T00618'
AND   TT2_PERIODO_OP =  TO_DATE(:PERIODO_ACTUAL,'DD/MM/YYYY')
ORDER BY TT2_FMODIFICACION;


DESC QA_TTT2_REGISTRO;


---------------REINICIO DE EJECUION
UPDATE QA_TTT2_REGISTRO
SET TT2_TIPOPROYECTO='2'
WHERE TT2_CODE_IUA IS NOT NULL;

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_FMODIFICACION IS NULL
AND TT2_CODE_IUA IS NOT NULL;


UPDATE QA_TTT2_REGISTRO
SET TT2_FMODIFICACION=TO_DATE('01/01/2021 00:00:00','DD/MM/YYYY HH24:MI:SS')
WHERE TT2_CODE_IUA IS NOT NULL;

COMMIT;


---------------REINICIO DE EJECUION-------
SELECT DISTINCT TT2_PERIODO_OP 
FROM QA_TTT2_REGISTRO;




UPDATE BRAE.QA_TTT2_REGISTRO
SET   TT2_PERIODO_OP             = TO_DATE('01/01/2021','DD/MM/YYYY'),
      TT2_ALTERNATIVA_VALORACION = 'BRAEN',
      TT2_ESTADO_PROPIO          = 'OPERACION',
      TT2_ESTADO_BRA11           = 'OPERACION',
      TT2_FESTADO                =  TO_DATE('01/01/2021','DD/MM/YYYY HH24:MI:SS')  --COLOLCAR LA MISMA FECHA DEL BRAEN
WHERE TT2_CODE_IUA IS NOT NULL
AND   TT2_PERIODO_OP='01/11/2021';

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

COMMIT;

EXEC QA_PTT2(TO_DATE('01/11/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY')
AND TT2_TIPOPROYECTO IS NULL;

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_UNIDAD_CONSTRUCTIVA IS NULL;-- COLOCAR UNIDAD CONSTRUCTIVA A LOS ACITVOS EN ESTA CONSULTA



        SELECT 	T1.	TT2_CODIGOELEMENTO
        ,	T1.	TT2_IUA
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_GRUPOCALIDAD  
                 ELSE T1.TT2_GRUPOCALIDAD 
            END) AS TT2_GRUPOCALIDAD
        ,	T1.	TT2_IDMERCADO
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_CAPACIDAD_TRAFO  
                 ELSE T1.TT2_CAPACIDAD_TRAFO 
            END) AS TT2_CAPACIDAD_TRAFO
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_PROPIEDAD  
                 ELSE T1.TT2_PROPIEDAD 
            END) AS TT2_PROPIEDAD
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_TSUBESTACION  
                 ELSE T1.TT2_TSUBESTACION 
            END) AS TT2_TSUBESTACION
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_LONGITUD  
                 ELSE T1.TT2_LONGITUD 
            END) AS TT2_LONGITUD
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_LATITUD  
                 ELSE T1.TT2_LATITUD 
            END) AS TT2_LATITUD
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_ALTITUD  
                 ELSE T1.TT2_ALTITUD 
            END) AS TT2_ALTITUD
        ,	T1.	TT2_ESTADO_PROPIO
        ,	T1.	TT2_ESTADO_BRA11
        ,	T1.	TT2_RESMETODOLOGIA
        ,	T1.	TT2_CLASS_CARGA
        ,	T1.	TT2_NOMBRE_CIRCUITO
        ,	T1.	TT2_IUL
        ,	T1.	TT2_CODIGOPROYECTO
        ,	T1.	TT2_UNIDAD_CONSTRUCTIVA
        ,	T1.	TT2_RPP
        ,	T1.	TT2_SALINIDAD
        ,	T1.	TT2_TIPOPROYECTO
        ,	T1.	TT2_REMUNERACION_PENDIENTE
        ,	T1.	TT2_ALTERNATIVA_VALORACION
        ,	T1.	TT2_ID_PLAN
        ,	T1.	TT2_CANTIDAD_REPOSICIONES
        ,	T1.	TT2_FESTADO
        ,	T1.	TT2_FCOLOCACION
        ,	T1.	TT2_FMODIFICACION
        ,	T1.	TT2_USR_COLOCACION
        ,	T1.	TT2_USR_MODFICACION
        ,	T1.	TT2_PERIODO_OP
        --BULK COLLECT INTO V_QA_TTT2_REGISTRO
        FROM QA_TTT2_TEMP T1
        LEFT OUTER JOIN (SELECT TT2_CODIGOELEMENTO
                            ,   TT2_GRUPOCALIDAD    
                            ,	TT2_IDMERCADO
                            ,	TT2_CAPACIDAD_TRAFO
                            ,	TT2_PROPIEDAD
                            ,	TT2_TSUBESTACION
                            ,	TT2_LONGITUD
                            ,	TT2_LATITUD
                            ,	TT2_ALTITUD
                         FROM BRAE.QA_TTT2_REGISTRO
                         WHERE TRUNC(TT2_PERIODO_OP)<>TRUNC(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'))
                         ) T2 ON T2.TT2_CODIGOELEMENTO=T1.TT2_CODIGOELEMENTO
        WHERE T1.TT2_CODIGOELEMENTO IN (
                                        SELECT DISTINCT T1.TT2_CODIGOELEMENTO
                                        FROM QA_TTT2_TEMP T1
                                        INNER  JOIN (SELECT DISTINCT TT2_CODIGOELEMENTO 
                                                     FROM QA_TTT2_TEMP
                                                     WHERE TT2_ESTADO_PROPIO='OPERACION'
                                                     ) T2 ON T2.TT2_CODIGOELEMENTO=T1.TT2_CODIGOELEMENTO
                                        WHERE TT2_ESTADO_PROPIO='RETIRADO'
                                        AND TO_CHAR(TT2_FMODIFICACION,'MM/YYYY') 
                                          = TO_CHAR(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'),'MM/YYYY')
                                        )
        ;






UPDATE QA_TTT2_REGISTRO
SET TT2_FESTADO =  LAST_DAY(TO_DATE('01/11/2021','DD/MM/YYYY'))
WHERE TT2_PERIODO_OP = TO_DATE('01/11/2021','DD/MM/YYYY');
ROLLBACK;

---------------REINICIO DE EJECUION-------30/11/2021
SELECT * 
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA IS NOT NULL
AND   TT2_PERIODO_OP='01/11/2021';


UPDATE BRAE.QA_TTT2_REGISTRO
SET   TT2_PERIODO_OP             = TO_DATE('01/01/2021','DD/MM/YYYY'),
      TT2_ALTERNATIVA_VALORACION = 'BRAEN',
      TT2_ESTADO_PROPIO          = 'OPERACION',
      TT2_ESTADO_BRA11           = 'OPERACION',
      TT2_FESTADO                =  TO_DATE('01/01/2021','DD/MM/YYYY HH24:MI:SS'),
      TT2_TIPOPROYECTO           = '2'
WHERE TT2_CODE_IUA IS NOT NULL
AND   TT2_PERIODO_OP='01/11/2021';

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

COMMIT;

EXEC QA_PTT2(TO_DATE('01/11/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY')
AND TT2_TIPOPROYECTO IS NULL;

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_UNIDAD_CONSTRUCTIVA IS NULL;-- COLOCAR UNIDAD CONSTRUCTIVA A LOS ACITVOS EN ESTA CONSULTA


 (SELECT DISTINCT TT2_CODIGOELEMENTO 
  FROM QA_TTT2_REGISTRO
  WHERE TT2_ESTADO_PROPIO = 'OPERACION'
  )
MINUS
 (SELECT DISTINCT TT2_CODIGOELEMENTO 
  FROM QA_TTT2_TEMP
  WHERE TT2_ESTADO_PROPIO IN ('OPERACION','CONSTRUCCION')
  );


SELECT *
FROM CCONECTIVIDAD_E@GTECH  CON
    LEFT OUTER JOIN CCOMUN@GTECH           COM ON COM.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET ON ET.G3E_FID = COM.G3E_FID
    LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON CPRO.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN QA_TTT1_REGISTRO TT1 ON TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
WHERE COM.G3E_FNO = 20400
AND CON.NODO_TRANSFORM_V IN ('1T00586',	'1T04811',	'1T07374',	'1T08618',	'1T08891',	'1T10366',	'1T10400',	'1TB0031',	'2T00124',	'2T00246',	'2T01464',	'3T03322');
        


SELECT TT2_CODIGOELEMENTO 
FROM(
     (SELECT DISTINCT TT2_CODIGOELEMENTO 
      FROM QA_TTT2_REGISTRO
      WHERE TT2_ESTADO_PROPIO = 'OPERACION'
      )
    MINUS
     (SELECT DISTINCT TT2_CODIGOELEMENTO 
      FROM QA_TTT2_TEMP
      WHERE TT2_ESTADO_PROPIO IN ('OPERACION','CONSTRUCCION')
      )
    )
WHERE TT2_CODIGOELEMENTO NOT IN (SELECT DISTINCT CODIGO_OPERATIVO
                                 FROM B$CCOMUN@GTECH
                                 WHERE LTT_ID IN (SELECT LTT_ID FROM LTT_IDENTIFIERS@GTECH)
                                 AND G3E_FNO=20400 
                                 AND EMPRESA_ORIGEN='CENS'
                                );




SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('2T00246',	'3T03322',	'2T00124',	'1T04811',	'1T07374',	'1T10366',	'1T08891',	'2T01464',	'1T08618',	'1T00586',	'1TB0031')
AND   TT2_PERIODO_OP <> TO_DATE('01/11/2021','DD/MM/YYYY')
;--AND   TT2_ALTERNATIVA_VALORACION = 'BRAEN';


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ALTERNATIVA_VALORACION IS NULL;

UPDATE QA_TTT2_REGISTRO
SET TT2_ALTERNATIVA_VALORACION='BRAEN'
WHERE TT2_ALTERNATIVA_VALORACION IS NULL;

--COMMIT;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('2T00246',	'3T03322',	'2T00124',	'1T10400',	'1T04811',	'1T07374',	'1T10366',	'1T08891',	'2T01464',	'1T08618',	'1T00586',	'1TB0031')
AND   TT2_PERIODO_OP <> TO_DATE('01/11/2021','DD/MM/YYYY');



SELECT * FROM SPARD.TRANSFOR
WHERE CODE IN ('1T10400',	'1T08891',	'1T08618',	'2T00124',	'1T07374',	'1TB0031',	'1T00586',	'2T00246',	'1T10366',	'2T01464',	'1T04811',	'3T03322');



select to_number('10', 'XXXXXXXXXXXXX') AS NUM from dual; 



select LPAD(QA_Fbase_conv(24274,10,36),5,0) from dual;

SELECT SUBSTR(TT2_CODE_IUA,2,5) AS CONSEC_36
      ,QA_FBASE_CONV(SUBSTR(TT2_CODE_IUA,2,5),36,10) AS CONSEC_10
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA IS NOT NULL;

SELECT LPAD(QA_FBASE_CONV(MAX(TO_NUMBER(QA_FBASE_CONV(SUBSTR(TT2_CODE_IUA,2,5),36,10)))+1,10,36),5,0) AS MAX_CONSEC
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA IS NOT NULL;

--MAXIMO NUMERO ACTUAL
SELECT MAX(TO_NUMBER(QA_FBASE_CONV(SUBSTR(TT2_CODE_IUA,2,5),36,10))) AS MAX_CONSEC
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA IS NOT NULL;

DESC QA_TTT2_REGISTRO;


CREATE TABLE QA_TTT2_CODIGO_UC( 
 TT2_UNIDAD_CONSTRUTIVA	VARCHAR2(20)
,TT2_DESCRIPCION	    VARCHAR2(400)
,TT2_NIVEL_TENSION	    VARCHAR2(20)
,TT2_CODIGO_UC          VARCHAR2(20)
);

SELECT * FROM QA_TTT2_CODIGO_UC;

        SELECT * 
        --BULK COLLECT INTO V_QA_TTT2_REGISTRO
        FROM QA_TTT2_TEMP
        WHERE TT2_CODIGOELEMENTO IN (
                                    SELECT TT2_CODIGOELEMENTO
                                    FROM QA_TTT2_TEMP
                                    WHERE TT2_ESTADO_PROPIO='OPERACION'
                                    MINUS
                                    SELECT TT2_CODIGOELEMENTO
                                    FROM QA_TTT2_REGISTRO
                                    )
        AND NVL(TRUNC(TT2_FMODIFICACION),TO_DATE(:FECHAPERIODO,'DD/MM/YYYY')) < 
            TRUNC(ADD_MONTHS(TO_DATE(:FECHAPERIODO,'DD/MM/YYYY'),1))
        ;
          


SELECT TT2_CODIGOELEMENTO,TT2_FMODIFICACION
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA IS NULL
AND   TT2_PERIODO_OP = TO_DATE('01/11/2021','DD/MM/YYYY');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY')
AND TT2_CODE_IUA IS NOT NULL
;


ALTER TABLE QA_TTT2_CODIGO_UC
RENAME COLUMN TT2_UNIDAD_CONSTRUTIVA TO TT2_UNIDAD_CONSTRUCTIVA;

        SELECT T2.TT2_CODIGOELEMENTO
             , T2.TT2_FMODIFICACION
             , UC.TT2_CODIGO_UC
        --BULK COLLECT INTO V_FORIUA
        FROM QA_TTT2_REGISTRO T2
        LEFT OUTER JOIN QA_TTT2_CODIGO_UC UC
          ON UC.TT2_UNIDAD_CONSTRUCTIVA = T2.TT2_UNIDAD_CONSTRUCTIVA
        WHERE T2.TT2_CODE_IUA IS NULL
        AND   T2.TT2_PERIODO_OP = TO_DATE('01/11/2021','DD/MM/YYYY');


---------------REINICIO DE EJECUION-------01/12/2021
SELECT * 
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA IS NOT NULL
AND   TT2_PERIODO_OP='01/11/2021';


UPDATE BRAE.QA_TTT2_REGISTRO
SET   TT2_PERIODO_OP             = TO_DATE('01/01/2021','DD/MM/YYYY'),
      TT2_ALTERNATIVA_VALORACION = 'BRAEN',
      TT2_ESTADO_PROPIO          = 'OPERACION',
      TT2_ESTADO_BRA11           = 'OPERACION',
      TT2_FESTADO                =  TO_DATE('01/01/2021','DD/MM/YYYY HH24:MI:SS'),
      TT2_TIPOPROYECTO           = '2'
WHERE TT2_CODE_IUA IS NOT NULL
AND   TT2_PERIODO_OP='01/11/2021';

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO;

DESC QA_TTT2_REGISTRO;

CREATE TABLE QA_TTT2_REGISTRO_ESPEJO(
	TT2_CODIGOELEMENTO	VARCHAR2(20)
,	TT2_CODE_IUA	VARCHAR2(20)
,	TT2_GRUPOCALIDAD	VARCHAR2(2)
,	TT2_IDMERCADO	VARCHAR2(20)
,	TT2_CAPACIDAD_TRAFO	NUMBER
,	TT2_PROPIEDAD	VARCHAR2(20)
,	TT2_TSUBESTACION	NUMBER
,	TT2_LONGITUD	NUMBER
,	TT2_LATITUD	NUMBER
,	TT2_ALTITUD	NUMBER
,	TT2_ESTADO_PROPIO	VARCHAR2(20)
,	TT2_ESTADO_BRA11	VARCHAR2(20)
,	TT2_RESMETODOLOGIA	VARCHAR2(20)
,	TT2_CLASS_CARGA	VARCHAR2(20)
,	TT2_NOMBRE_CIRCUITO	VARCHAR2(20)
,	TT2_IUL	VARCHAR2(5)
,	TT2_CODIGOPROYECTO	VARCHAR2(20)
,	TT2_UNIDAD_CONSTRUCTIVA	VARCHAR2(20)
,	TT2_RPP	NUMBER
,	TT2_SALINIDAD	VARCHAR2(2)
,	TT2_TIPOPROYECTO	VARCHAR2(5)
,	TT2_REMUNERACION_PENDIENTE	NUMBER
,	TT2_ALTERNATIVA_VALORACION	VARCHAR2(20)
,	TT2_ID_PLAN	NUMBER
,	TT2_CANTIDAD_REPOSICIONES	NUMBER
,	TT2_FESTADO	DATE
,	TT2_FCOLOCACION	DATE
,	TT2_FMODIFICACION	DATE
,	TT2_USR_COLOCACION	VARCHAR2(20)
,	TT2_USR_MODFICACION	VARCHAR2(20)
,	TT2_PERIODO_OP	DATE
);

INSERT INTO QA_TTT2_REGISTRO_ESPEJO
SELECT * FROM QA_TTT2_REGISTRO;

COMMIT;

EXEC QA_PTT2(TO_DATE('01/11/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');


---------------REINICIO DE EJECUION-------01/12/2021
SELECT * 
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA IS NOT NULL
AND   TT2_PERIODO_OP='01/11/2021';


UPDATE BRAE.QA_TTT2_REGISTRO
SET   TT2_PERIODO_OP             = TO_DATE('01/01/2021','DD/MM/YYYY'),
      TT2_ALTERNATIVA_VALORACION = 'BRAEN',
      TT2_ESTADO_PROPIO          = 'OPERACION',
      TT2_ESTADO_BRA11           = 'OPERACION',
      TT2_FESTADO                =  TO_DATE('01/01/2021','DD/MM/YYYY HH24:MI:SS'),
      TT2_TIPOPROYECTO           = '2'
WHERE TT2_CODE_IUA IS NOT NULL
AND   TT2_PERIODO_OP='01/11/2021';

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO;

DESC QA_TTT2_REGISTRO;

CREATE TABLE QA_TTT2_REGISTRO_ESPEJO(
	TT2_CODIGOELEMENTO	VARCHAR2(20)
,	TT2_CODE_IUA	VARCHAR2(20)
,	TT2_GRUPOCALIDAD	VARCHAR2(2)
,	TT2_IDMERCADO	VARCHAR2(20)
,	TT2_CAPACIDAD_TRAFO	NUMBER
,	TT2_PROPIEDAD	VARCHAR2(20)
,	TT2_TSUBESTACION	NUMBER
,	TT2_LONGITUD	NUMBER
,	TT2_LATITUD	NUMBER
,	TT2_ALTITUD	NUMBER
,	TT2_ESTADO_PROPIO	VARCHAR2(20)
,	TT2_ESTADO_BRA11	VARCHAR2(20)
,	TT2_RESMETODOLOGIA	VARCHAR2(20)
,	TT2_CLASS_CARGA	VARCHAR2(20)
,	TT2_NOMBRE_CIRCUITO	VARCHAR2(20)
,	TT2_IUL	VARCHAR2(5)
,	TT2_CODIGOPROYECTO	VARCHAR2(20)
,	TT2_UNIDAD_CONSTRUCTIVA	VARCHAR2(20)
,	TT2_RPP	NUMBER
,	TT2_SALINIDAD	VARCHAR2(2)
,	TT2_TIPOPROYECTO	VARCHAR2(5)
,	TT2_REMUNERACION_PENDIENTE	NUMBER
,	TT2_ALTERNATIVA_VALORACION	VARCHAR2(20)
,	TT2_ID_PLAN	NUMBER
,	TT2_CANTIDAD_REPOSICIONES	NUMBER
,	TT2_FESTADO	DATE
,	TT2_FCOLOCACION	DATE
,	TT2_FMODIFICACION	DATE
,	TT2_USR_COLOCACION	VARCHAR2(20)
,	TT2_USR_MODFICACION	VARCHAR2(20)
,	TT2_PERIODO_OP	DATE
);

INSERT INTO QA_TTT2_REGISTRO_ESPEJO
SELECT * FROM QA_TTT2_REGISTRO;

COMMIT;

EXEC QA_PTT2(TO_DATE('01/11/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');


---------------REINICIO DE EJECUION-------01/12/2021
SELECT * 
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA IS NOT NULL
AND   TT2_PERIODO_OP='01/11/2021';


UPDATE BRAE.QA_TTT2_REGISTRO
SET   TT2_PERIODO_OP             = TO_DATE('01/01/2021','DD/MM/YYYY'),
      TT2_ALTERNATIVA_VALORACION = 'BRAEN',
      TT2_ESTADO_PROPIO          = 'OPERACION',
      TT2_ESTADO_BRA11           = 'OPERACION',
      TT2_FESTADO                =  TO_DATE('01/01/2021','DD/MM/YYYY HH24:MI:SS'),
      TT2_TIPOPROYECTO           = '2'
WHERE TT2_CODE_IUA IS NOT NULL
AND   TT2_PERIODO_OP='01/11/2021';

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO;

DESC QA_TTT2_REGISTRO;

CREATE TABLE QA_TTT2_REGISTRO_ESPEJO(
	TT2_CODIGOELEMENTO	VARCHAR2(20)
,	TT2_CODE_IUA	VARCHAR2(20)
,	TT2_GRUPOCALIDAD	VARCHAR2(2)
,	TT2_IDMERCADO	VARCHAR2(20)
,	TT2_CAPACIDAD_TRAFO	NUMBER
,	TT2_PROPIEDAD	VARCHAR2(20)
,	TT2_TSUBESTACION	NUMBER
,	TT2_LONGITUD	NUMBER
,	TT2_LATITUD	NUMBER
,	TT2_ALTITUD	NUMBER
,	TT2_ESTADO_PROPIO	VARCHAR2(20)
,	TT2_ESTADO_BRA11	VARCHAR2(20)
,	TT2_RESMETODOLOGIA	VARCHAR2(20)
,	TT2_CLASS_CARGA	VARCHAR2(20)
,	TT2_NOMBRE_CIRCUITO	VARCHAR2(20)
,	TT2_IUL	VARCHAR2(5)
,	TT2_CODIGOPROYECTO	VARCHAR2(20)
,	TT2_UNIDAD_CONSTRUCTIVA	VARCHAR2(20)
,	TT2_RPP	NUMBER
,	TT2_SALINIDAD	VARCHAR2(2)
,	TT2_TIPOPROYECTO	VARCHAR2(5)
,	TT2_REMUNERACION_PENDIENTE	NUMBER
,	TT2_ALTERNATIVA_VALORACION	VARCHAR2(20)
,	TT2_ID_PLAN	NUMBER
,	TT2_CANTIDAD_REPOSICIONES	NUMBER
,	TT2_FESTADO	DATE
,	TT2_FCOLOCACION	DATE
,	TT2_FMODIFICACION	DATE
,	TT2_USR_COLOCACION	VARCHAR2(20)
,	TT2_USR_MODFICACION	VARCHAR2(20)
,	TT2_PERIODO_OP	DATE
);

INSERT INTO QA_TTT2_REGISTRO_ESPEJO
SELECT * FROM QA_TTT2_REGISTRO;

COMMIT;

EXEC QA_PTT2(TO_DATE('01/11/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');


---------------REINICIO DE EJECUION-------02/12/2021
SELECT * FROM QA_TTT2_REGISTRO_ESPEJO;

DELETE FROM QA_TTT2_REGISTRO;

COMMIT;

INSERT INTO QA_TTT2_REGISTRO
SELECT * FROM QA_TTT2_REGISTRO_ESPEJO;

COMMIT;

EXEC QA_PTT2(TO_DATE('01/11/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

-------------------------------




        SELECT * 
        --BULK COLLECT INTO V_QA_TTT2_REGISTRO
        FROM QA_TTT2_TEMP
        WHERE TT2_CODIGOELEMENTO IN (
                                    SELECT TT2_CODIGOELEMENTO
                                    FROM QA_TTT2_TEMP
                                    WHERE TT2_ESTADO_PROPIO='OPERACION'
                                    MINUS
                                    SELECT TT2_CODIGOELEMENTO
                                    FROM QA_TTT2_REGISTRO
                                    )
        AND NVL(TRUNC(TT2_FMODIFICACION),FECHAOPERACION) < 
            TRUNC(ADD_MONTHS(FECHAOPERACION,1))                                    
        ;
        
        
        
SELECT *
FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO='1T04970'
--AND TT2_ESTADO_PROPIO='OPERACION'
;        

SELECT *
FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='4T00686'
--AND TT2_ESTADO_PROPIO='OPERACION'
;     

SELECT LPAD(QA_FBASE_CONV(24429,10,36),5,0) FROM DUAL;


SELECT * FROM QA_TTT2_OBS;



---------------REINICIO DE EJECUION-------02/12/2021
SELECT * FROM QA_TTT2_REGISTRO_ESPEJO;
SELECT * FROM QA_TTT2_REGISTRO;

DELETE FROM QA_TTT2_REGISTRO;

COMMIT;

INSERT INTO QA_TTT2_REGISTRO
SELECT * FROM QA_TTT2_REGISTRO_ESPEJO;

COMMIT;

EXEC QA_PTT2(TO_DATE('01/11/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');



        SELECT * 
        --BULK COLLECT INTO V_QA_TTT2_REGISTRO
        FROM QA_TTT2_REGISTRO
        WHERE TO_CHAR(TT2_FESTADO,'YYYY')<>TO_CHAR(TO_DATE('01/11/2021','DD/MM/YYYY'),'YYYY')
        AND TT2_PERIODO_OP=TRUNC(TO_DATE('01/11/2021','DD/MM/YYYY'));
        
SELECT * FROM QA_TTT2_REGISTRO;



SELECT DISTINCT I.TRAFO FROM OMS.INTERUPC I
LEFT OUTER JOIN OMS.MANIOBRAS M
ON M.CODE = I.MINICIAL
WHERE  M.CAUSA <> 'PRUEBA'
AND I.TYPEEQUIP = 'Transformer'
AND I.FINICIAL >= TO_DATE('01/11/2021','DD/MM/YYYY')
AND I.FINICIAL  <  TO_DATE('01/12/2021','DD/MM/YYYY')
AND I.TRAFO IN ('1T08618',
'2T00246',
'3T03322'); 


SELECT * FROM QA_TTT2_REPORTE
WHERE TT2_CODE_TRAFO IN ('1T13058',
'1T13053',
'1T13063',
'1T13066',
'3T04935',
'5T02964',
'5T02965',
'5T02966');



SELECT MAX(TC1_PERIODO) FROM QA_TTC1;
SELECT * FROM QA_TTC1_TEMP;

DELETE FROM QA_TTC1_TEMP
WHERE TC1_PERIODO='202110'
;
COMMIT;

INSERT INTO QA_TTC1
SELECT * FROM QA_TTC1_TEMP;


SELECT * FROM QA_TTC1
WHERE TC1_CODCONEX IN ('1T10400',	'1T08891',	'1T08618',	'2T00124',	'1T07374',	'1TB0031',	'1T00586',	'2T00246',	'1T10366',	'2T01464',	'1T04811',	'3T03322')
AND TC1_PERIODO='202110';





SELECT TT2_CODIGOELEMENTO,TT2_CODE_IUA FROM QA_TTT2_REGISTRO_ESPEJO;


---------------REINICIO DE EJECUION-------03/12/2021
SELECT * FROM QA_TTT2_REGISTRO_ESPEJO;
SELECT * FROM QA_TTT2_REGISTRO;

DELETE FROM QA_TTT2_REGISTRO;

COMMIT;

INSERT INTO QA_TTT2_REGISTRO
SELECT * FROM QA_TTT2_REGISTRO_ESPEJO;

COMMIT;

EXEC QA_PTT2(TO_DATE('01/11/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/11/2021','DD/MM/YYYY');

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN ('1T10005',
'5T02986',
'1T13053',
'1T13058',
'1T13060',
'1T13061',
'1T13063',
'1T13066',
'1T13067',
'1T13078',
'1T13081',
'1T13105',
'1T13132',
'1T13181',
'1T13194',
'1T13203',
'3T04900',
'3T04935',
'5T02964',
'5T02965',
'5T02966');


SELECT * FROM QA_TT3_SEGUIMIENTO
WHERE TO_CHAR(TT3_SEGUIRMES,'DD/MM/YYYY')= '01/11/2021';
.
SELECT * FROM QA_TT3_SEGUIMIENTO
WHERE TT3_ID_DESCONEXION=61 
AND TO_CHAR(TT3_SEGUIRMES,'DD/MM/YYYY')= '01/11/2021';


SELECT * FROM QA_TFDDREGISTRO
WHERE TO_CHAR(FDD_FINICIAL,'MMYYYY') ='112021'
AND FDD_CAUSA_CREG = '10'
;
--676  Filas 1739  Filas
SELECT DISTINCT TC1_IUA
               ,TC1_CODCIRC 
FROM   QA_TTC1
WHERE  TC1_PERIODO='202110';



SELECT * FROM QA_TFDDREPORTE_AJ
WHERE FDR_PERIODO_OP='01/11/2021';

SELECT * FROM QA_TFDDREGISTRO
WHERE FDD_CODIGOEVENTO='877619';


SELECT * FROM QA_TFDDREPORTE
WHERE FDR_CODIGOEVENTO='877619';


SELECT * FROM QA_TTT2_REGISTRO_TEMP
WHERE TT2_CODIGOELEMENTO IN ('1T13185',	'3T04941',	'3T04944',	'5T02991',	'3T04942',	'3T04923',	'4T01672',	'3T04924',	'1T13170',	'3T04934',	'1T13183',	'3T04931',	'3T04945',	'3T04915',	'1T13198',	'1T13169',	'3T04940',	'5T02989',	'3T04916',	'3T04921',	'3T04943',	'3T04938',	'1T13186',	'1T13165',	'1T13136',	'3T04928',	'5T02990',	'1T13182',	'1T13184',	'3T04917',	'1T13171',	'1T13164',	'3T04914',	'5T02992',	'3T04946',	'1T13117',	'5T02987',	'5T02988',	'1T13172');

UPDATE QA_TTT2_REGISTRO 
SET TT2_ESTADO_BRA11 = 'CONSTRUCCION'
WHERE TT2_ESTADO_BRA11 IS NULL;
--COMMIT;

UPDATE QA_TTT2_REGISTRO
SET   TT2_ALTERNATIVA_VALORACION ='INVA'
WHERE TT2_ALTERNATIVA_VALORACION IS NULL;

UPDATE QA_TTT2_REGISTRO
SET   TT2_FMODIFICACION = '01/01/2021'
WHERE TT2_FMODIFICACION IS NULL;

--COMMIT;


SELECT TT2_CODIGOELEMENTO
    ,  TT2_PROPIEDAD
FROM QA_TTT2_REGISTRO_TEMP
WHERE TT2_CODIGOELEMENTO IN (SELECT DISTINCT TT2_CODIGOELEMENTO 
                             FROM QA_TTT2_REGISTRO
                             WHERE TT2_PROPIEDAD = 0)
;


UPDATE QA_TTT2_REGISTRO
SET   TT2_PROPIEDAD = '1'
WHERE TT2_CODIGOELEMENTO='1T04970';

COMMIT;

UPDATE QA_TTT2_REGISTRO
SET   TT2_PROPIEDAD =2
WHERE TT2_PROPIEDAD =0;

COMMIT;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PROPIEDAD  =2;

UPDATE QA_TTT2_REGISTRO A
SET   TT2_NOMBRE_CIRCUITO = (SELECT TT2_NOMBRE_CIRCUITO FROM QA_TTT2_REGISTRO_TEMP WHERE TT2_CODIGOELEMENTO=A.TT2_CODIGOELEMENTO)
    , TT2_IUL             = (SELECT TT2_IUL             FROM QA_TTT2_REGISTRO_TEMP WHERE TT2_CODIGOELEMENTO=A.TT2_CODIGOELEMENTO)
WHERE TT2_CODIGOELEMENTO IN (SELECT DISTINCT TT2_CODIGOELEMENTO 
                             FROM QA_TTT2_REGISTRO
                             WHERE TT2_NOMBRE_CIRCUITO IS NULL)
;

SELECT DISTINCT TT2_NOMBRE_CIRCUITO FROM QA_TTT2_REGISTRO;


COMMIT;



UPDATE QA_TTT2_REGISTRO A
SET   TT2_UNIDAD_CONSTRUCTIVA = (SELECT TT2_UNIDAD_CONSTRUCTIVA 
                                 FROM QA_TTT2_REGISTRO_TEMP 
                                 WHERE TT2_CODIGOELEMENTO=A.TT2_CODIGOELEMENTO
                                 )
WHERE TT2_CODIGOELEMENTO IN (SELECT DISTINCT TT2_CODIGOELEMENTO 
                             FROM QA_TTT2_REGISTRO
                             WHERE TT2_UNIDAD_CONSTRUCTIVA IS NULL)
;

SELECT * FROM QA_TTT2_REGISTRO_TEMP
WHERE TT2_CODIGOELEMENTO IN (SELECT DISTINCT TT2_CODIGOELEMENTO 
                             FROM QA_TTT2_REGISTRO
                             WHERE TT2_UNIDAD_CONSTRUCTIVA IS NULL);


COMMIT;


SELECT DISTINCT  TT2_CODIGOELEMENTO
FROM QA_TTT2_REGISTRO
WHERE TT2_UNIDAD_CONSTRUCTIVA IS NULL;




SELECT CON.NODO_TRANSFORM_V  AS TT2_CODIGOELEMENTO
      ,COM.UC  
FROM
    CCONECTIVIDAD_E@GTECH  CON
    LEFT OUTER JOIN CCOMUN@GTECH           COM ON COM.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET ON ET.G3E_FID = COM.G3E_FID
    LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON CPRO.G3E_FID = CON.G3E_FID
    LEFT OUTER JOIN QA_TTT1_REGISTRO TT1 ON TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
WHERE COM.G3E_FNO = 20400
AND CON.NODO_TRANSFORM_V IN (SELECT DISTINCT  TT2_CODIGOELEMENTO
                             FROM QA_TTT2_REGISTRO
                             WHERE TT2_UNIDAD_CONSTRUCTIVA IS NULL);
                             
                             
UPDATE QA_TTT2_REGISTRO
SET   TT2_TIPOPROYECTO = '2'
WHERE TT2_TIPOPROYECTO IS NULL;
COMMIT;                             

SELECT * FROM QA_TTT2_REGISTRO_TEMP
WHERE TT2_CODIGOELEMENTO IN (SELECT DISTINCT TT2_CODIGOELEMENTO 
                             FROM QA_TTT2_REGISTRO 
                             WHERE TT2_NOMBRE_CIRCUITO='SIN CIRCUITO')
;
      
      
SELECT * FROM QA_TTT2_REGISTRO_ESPEJO;                       
                             

DELETE FROM QA_TTT2_REGISTRO_ESPEJO;                              
COMMIT;

INSERT INTO QA_TTT2_REGISTRO_ESPEJO
SELECT * FROM QA_TTT2_REGISTRO;
--


ALTER TABLE QA_TTT2_REGISTRO_ESPEJO
ADD TT2_REPORTE NUMBER;


-----------------NUEVA REVERSION DEL PROCEDIMEINTO TT2
--AGREGAR CAMPO PARA MARCAR LOS REGISTROS REPORTADOS TT2_REPORTADO (1/0)

SELECT * FROM QA_tTT2_rEGISTRO;

UPDATE QA_TTT2_REGISTRO_ESPEJO
SET TT2_REPORTE=1;
COMMIT;



--REVISAR LOS TIPO INVERSION 2 Y 4 Y ELIMINAR LOS DEL PERIODO DE OPERACION
--REVISAR LOS TIPO INVERSION 1 Y 3 Y REVERSAR LOS DEL PERIODO DE OPERACION

---------------REINICIO DE EJECUION-------09/12/2021

EXEC QA_PTT2(TO_DATE('01/12/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY');


ALTER TABLE QA_TTT2_REGISTRO_ESPEJO
ADD TT2_FSISTEMA DATE;


SELECT * FROM QA_TTT2_REGISTRO;

UPDATE QA_TTT2_REGISTRO
SET TT2_FSISTEMA = TRUNC(TT2_PERIODO_OP);
COMMIT;

-----------REVERSION DEL PROCEOS QA_PTT2

--ACTUALIZO LOS MODIFICADOS
UPDATE BRAE.QA_TTT2_REGISTRO
SET   TT2_PERIODO_OP             =  TRUNC(TT2_FSISTEMA,'MM'),
      TT2_ALTERNATIVA_VALORACION = 'BRAEN',
      TT2_ESTADO_PROPIO          = 'OPERACION',
      TT2_ESTADO_BRA11           = 'OPERACION',
      TT2_FESTADO                =  LAST_DAY(TT2_FSISTEMA),
      TT2_TIPOPROYECTO           = '2'
WHERE TT2_REPORTE = 1
AND   TT2_TIPOPROYECTO IN ('1','3')
AND   TT2_PERIODO_OP='01/12/2021';

--ELIMINO LOS NUEVOS DE EXPANSION Y LOS NUEVOS DE REPOSICION
DELETE 
FROM  QA_TTT2_REGISTRO
WHERE TT2_REPORTE = 0
AND   TT2_PERIODO_OP='01/12/2021';

COMMIT;


--------------------


        SELECT COUNT(TT2_CODIGOELEMENTO)
        FROM QA_TTT2_REGISTRO
        WHERE TT2_PERIODO_OP = TO_DATE('01/12/2021','DD/MM/YYYY');
        
        
        
------------EJECUCION ----10/12/2021


EXEC QA_PTT2(TO_DATE('01/12/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_REPORTE=1;


-------------------------




        --COLOCACION DE LOS REGISTRSO DE REPOSICION EN LA TABLA QA_TTT2_REGISTRO
        V_QA_TTT2_REGISTRO.DELETE;

        SELECT 	T1.	TT2_CODIGOELEMENTO
        ,	T1.	TT2_IUA
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_GRUPOCALIDAD  
                 ELSE T1.TT2_GRUPOCALIDAD 
            END) AS TT2_GRUPOCALIDAD
        ,	T1.	TT2_IDMERCADO
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_CAPACIDAD_TRAFO  
                 ELSE T1.TT2_CAPACIDAD_TRAFO 
            END) AS TT2_CAPACIDAD_TRAFO
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_PROPIEDAD  
                 ELSE T1.TT2_PROPIEDAD 
            END) AS TT2_PROPIEDAD
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_TSUBESTACION  
                 ELSE T1.TT2_TSUBESTACION 
            END) AS TT2_TSUBESTACION
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_LONGITUD  
                 ELSE T1.TT2_LONGITUD 
            END) AS TT2_LONGITUD
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_LATITUD  
                 ELSE T1.TT2_LATITUD 
            END) AS TT2_LATITUD
        ,  (CASE WHEN T1.TT2_ESTADO_PROPIO='RETIRADO' 
                 THEN T2.TT2_ALTITUD  
                 ELSE T1.TT2_ALTITUD 
            END) AS TT2_ALTITUD
        ,	T1.	TT2_ESTADO_PROPIO
        ,	T1.	TT2_ESTADO_BRA11
        ,	T1.	TT2_RESMETODOLOGIA
        ,	T1.	TT2_CLASS_CARGA
        ,	T1.	TT2_NOMBRE_CIRCUITO
        ,	T1.	TT2_IUL
        ,	T1.	TT2_CODIGOPROYECTO
        ,	T1.	TT2_UNIDAD_CONSTRUCTIVA
        ,	T1.	TT2_RPP
        ,	T1.	TT2_SALINIDAD
        ,	T1.	TT2_TIPOPROYECTO
        ,	T1.	TT2_REMUNERACION_PENDIENTE
        ,	T1.	TT2_ALTERNATIVA_VALORACION
        ,	T1.	TT2_ID_PLAN
        ,	T1.	TT2_CANTIDAD_REPOSICIONES
        ,	T1.	TT2_FESTADO
        ,	T1.	TT2_FCOLOCACION
        ,	T1.	TT2_FMODIFICACION
        ,	T1.	TT2_USR_COLOCACION
        ,	T1.	TT2_USR_MODFICACION
        ,	T1.	TT2_PERIODO_OP
        ,   T1. TT2_REPORTE
        ,   T1. TT2_FSISTEMA
        --BULK COLLECT INTO V_QA_TTT2_REGISTRO
        FROM QA_TTT2_TEMP T1
        LEFT OUTER JOIN (SELECT TT2_CODIGOELEMENTO
                            ,   TT2_GRUPOCALIDAD    
                            ,	TT2_IDMERCADO
                            ,	TT2_CAPACIDAD_TRAFO
                            ,	TT2_PROPIEDAD
                            ,	TT2_TSUBESTACION
                            ,	TT2_LONGITUD
                            ,	TT2_LATITUD
                            ,	TT2_ALTITUD
                         FROM BRAE.QA_TTT2_REGISTRO
                         WHERE TRUNC(TT2_PERIODO_OP)<>TRUNC(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'))
                         ) T2 ON T2.TT2_CODIGOELEMENTO=T1.TT2_CODIGOELEMENTO
        WHERE T1.TT2_CODIGOELEMENTO IN (
                                        SELECT DISTINCT T1.TT2_CODIGOELEMENTO
                                        FROM QA_TTT2_TEMP T1
                                        INNER  JOIN (SELECT DISTINCT TT2_CODIGOELEMENTO 
                                                     FROM QA_TTT2_TEMP
                                                     WHERE TT2_ESTADO_PROPIO='OPERACION'
                                                     ) T2 ON T2.TT2_CODIGOELEMENTO=T1.TT2_CODIGOELEMENTO
                                        WHERE TT2_ESTADO_PROPIO='RETIRADO'
                                        AND TO_CHAR(TT2_FMODIFICACION,'MM/YYYY') 
                                          = TO_CHAR(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY')   ,'MM/YYYY')
                                        AND TT2_ESTADO_BRA11 <> 'CONSTRUCCION'
                                        )   
        ;


/*
IF (CANT_REGIST_OP = 0) OR (NOREPORT > 0) THEN
   --   EJECUTAR QA_PTT2();
END IF;

0 0 = NO EJECUTA = OK 
1 0 = SI EJECUTA = OK
0 1 = SI EJECUTA = OK
1 1 = SI EJECUTA = OK --ESTA SITUACION NO SE ES POSIBLE

*/
CREATE TABLE QA_TTT2_BRAFO
AS (SELECT * FROM QA_TTT2_REGISTRO);

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='1T06417';


------------------EJECUCION 13/12/2021

EXEC QA_PTT2(TO_DATE('01/12/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/12/2021';


UPDATE QA_TTT2_REGISTRO
SET   TT2_PERIODO_OP=TO_DATE('01/01/2021','DD/MM/YYYY')
WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY');


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY');

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP='01/12/2021';

SELECT ADD_MONTHS(TRUNC(SYSDATE,'MM'),-1) FROM DUAL;



------------------EJECUCION 13/12/2021

EXEC QA_PTT2(TO_DATE('01/12/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY');

SELECT * FROM QA_TTT2_REGISTRO;
SELECT * FROM QA_TTT2_BRAFO;

ALTER TABLE QA_TTT2_TEMP
ADD TT2_ACTIVOCONEXION NUMBER;

SELECT*FROM QA_TTT2_REGISTRO;

DROP TABLE QA_TTT2_REGISTRO_TEMP2;


CREATE TABLE QA_TTT2_ACTIVOCONEXION(
TT2_CODIGOELEMENTO VARCHAR(20)
);


UPDATE QA_TTT2_REGISTRO
SET    TT2_ACTIVOCONEXION = 1
WHERE  TT2_CODIGOELEMENTO IN (SELECT TT2_CODIGOELEMENTO 
                              FROM QA_TTT2_ACTIVOCONEXION);

COMMIT;
--1907  Filas




SELECT * FROM QA_TTT2_REGISTRO
WHERE    TT2_ACTIVOCONEXION = 1
AND  TT2_CODIGOELEMENTO IN (SELECT TT2_CODIGOELEMENTO 
                              FROM QA_TTT2_ACTIVOCONEXION);

SELECT * FROM QA_TTT2_REGISTRO 
WHERE TT2_ACTIVOCONEXION=1;


DESC QA_TTT2_REGISTRO;

ALTER TABLE QA_TTT2_REGISTRO
ADD TT2_ACTIVOPROVISIONAL NUMBER;
         

ALTER TABLE QA_TTT2_BRAFO
ADD TT2_ACTIVOPROVISIONAL NUMBER;             

ALTER TABLE QA_TTT2_OBS
ADD TT2_ACTIVOPROVISIONAL NUMBER;


ALTER TABLE QA_TTT2_TEMP
ADD TT2_ACTIVOPROVISIONAL NUMBER;



        SELECT CON.NODO_TRANSFORM_V  AS TT2_CODIGOELEMENTO
            ,''                      AS TT2_CODE_IUA --GESTIONADO POR PROCEDIMIENTO
            ,TO_CHAR(COM.GRUPO_CALIDAD)       AS TT2_GRUPOCALIDAD
            ,TO_CHAR(COM.ID_MERCADO)          AS TT2_IDMERCADO
            ,TO_NUMBER(CON.CAPACIDAD_NOMINAL)   AS TT2_CAPACIDAD_TRAFO
            ,TO_CHAR(CASE WHEN CPRO.PROPIETARIO_1='CENS'
                          THEN '1'
                          ELSE '0'
                     END)      AS TT2_PROPIEDAD
            ,TO_NUMBER(ET.TIPO_SUBESTACION)     AS TT2_TSUBESTACION
            ,TO_NUMBER(COM.COOR_GPS_LON)        AS TT2_LONGITUD
            ,TO_NUMBER(COM.COOR_GPS_LAT)        AS TT2_LATITUD
            ,TO_NUMBER(COM.COOR_Z)              AS TT2_ALTITUD
            ,(CASE WHEN (COM.ESTADO='CONSTRUCCION') THEN('OPERACION') ELSE(COM.ESTADO) END) AS TT2_ESTADO_PROPIO
            ,DECODE(ET.PROVISIONAL,'SI','CONSTRUCCION',COM.ESTADO) AS TT2_ESTADO_BRA11
            ,'CREG 015'              AS TT2_RESMETODOLOGIA
            ,''                      AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
            ,CON.CIRCUITO            AS TT2_NOMBRE_CIRCUITO
            ,TT1.TT1_CODIGOCIRCUITO  AS TT2_IUL
            ,''                      AS TT2_CODIGOPROYECTO --INDEFINIDO
            ,COM.UC                  AS TT2_UNIDAD_CONSTRUCTIVA
            ,DECODE(CPRO.PROPIETARIO_1,'ESTADO',1,0) AS TT2_RPP
            ,DECODE(COM.SALINIDAD, 'SI', '1', '2') AS TT2_SALINIDAD
            ,(CASE WHEN COM.TIPO_PROYECTO='T4'
                   THEN 'T4'
                   ELSE NULL
                   END)              AS TT2_TIPOPROYECTO -- CONFIGURADO POR PROCEDIMIENTO
            ,2                       AS TT2_REMUNERACION_PENDIENTE 
            ,DECODE(DECODE(ET.PROVISIONAL,'SI','CONSTRUCCION',COM.ESTADO),'CONSTRUCCION','INVA'
                          ,'OPERACION','BRAEN'
                          ,'RETIRADO','BRAFO') AS TT2_ALTERNATIVA_VALORACION 
            ,NULL                    AS TT2_ID_PLAN
            ,0                       AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
            ,COM.FECHA_OPERACION     AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
            ,COM.FECHA_COLOCACION    AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
            ,COM.FECHA_MODIFICACION  AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
            ,COM.USUARIO_COLOCACION  AS TT2_USR_COLOCACION --PERS
            ,COM.USUARIO_MODIFICACION AS TT2_USR_MODFICACION
            --,TRUNC(FECHAOPERACION)    AS TT2_PERIODO_OP
            ,0                        AS TT2_REPORTE
            ,SYSDATE                  AS TT2_FSISTEMA
            ,0                        AS TT2_ACTIVOCONEXION --PENDIENTE TRAER DEL SISTEMA GTECH
            ,ET.PROVISIONAL                    AS TT2_ACTIVOPROVISIONAL --PENDIENTE TRAER DEL SISTEMA
        --BULK COLLECT INTO V_QA_TTT2_REGISTRO
        FROM CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM ON COM.G3E_FID = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET ON ET.G3E_FID = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON CPRO.G3E_FID = CON.G3E_FID
            LEFT OUTER JOIN QA_TTT1_REGISTRO TT1 ON TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
        WHERE COM.G3E_FNO = 20400
        AND ET.PROVISIONAL NOT IN ('SI','NO') ;
        
        
        SELECT * FROM QA_TTT2_ACTIVOCONEXION;
        
        
        ALTER TABLE QA_TTT2_ACTIVOCONEXION 
        RENAME TO QA_TTT2_ACTIVOPROVISIONAL;
        
        SELECT * FROM QA_TTT2_ACTIVOPROVISIONAL;
        
        
        UPDATE QA_TTT2_REGISTRO
        SET TT2_ACTIVOPROVISIONAL = 1
        WHERE TT2_CODIGOELEMENTO IN (SELECT * FROM QA_TTT2_ACTIVOPROVISIONAL);
        
        COMMIT;
        
        UPDATE QA_TTT2_REGISTRO
        SET TT2_ACTIVOPROVISIONAL = 0
        WHERE TT2_ACTIVOPROVISIONAL IS NULL;
        
        COMMIT;
        
        
        SELECT 
        (SELECT 258+22193 FROM DUAL) -
        (SELECT COUNT(TT2_CODIGOELEMENTO) FROM QA_TTT2_REGISTRO) AS ZERO
        FROM DUAL;
        COMMIT;
        
        
        SELECT * FROM QA_TTT2_REGISTRO
        WHERE TT2_ACTIVOPROVISIONAL=1;
        
        
        
        DECLARE
        TODAY DATE DEFAULT SYSDATE;
        BEGIN
        --DISPLAY THE DATE
        DBMS_OUTPUT.PUT_LINE('TODAY IS '|| TODAY);
        END;
        /
        
        
        SELECT * FROM QA_TTT2_REGISTRO;
        
        DROP PROCEDURE QA_PTT2;
        
------------------EJECUCION 27/12/2021

        EXEC QA_PTT2_REGISTRO(TO_DATE('01/12/2021','DD/MM/YYYY'));
        
        SELECT * FROM QA_TTT2_OBS;
        
        SELECT * FROM QA_TTT2_REGISTRO
        WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY')
        AND TT2_TIPOPROYECTO IN (2,4);
        
        SELECT * FROM QA_TTT2_TEMP;
        SELECT * FROM QA_TTT2_BRAFO;
        SELECT * FROM QA_TTT2_OBS;
        SELECT * FROM QA_TTT2_REGISTRO;
        
        SELECT * FROM QA_TTT2_REGISTRO
        WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY')
        AND TT2_ESTADO_BRA11<>'CONSTRUCCION'
        AND TT2_TIPOPROYECTO=2;
        

------------------EJECUCION 28/12/2021

        EXEC QA_PTT2_REGISTRO(TO_DATE('01/12/2021','DD/MM/YYYY'));
        
        SELECT * FROM QA_TTT2_OBS;
        
        SELECT * FROM QA_TTT2_REGISTRO
        WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY')
        AND TT2_TIPOPROYECTO IN (2,4);
        
        SELECT * FROM QA_TTT2_TEMP;
        SELECT * FROM QA_TTT2_BRAFO;
        SELECT * FROM QA_TTT2_OBS;
        SELECT * FROM QA_TTT2_REGISTRO;
        
        SELECT * FROM QA_TTT2_REGISTRO
        WHERE TT2_ESTADO_BRA11='CONSTRUCCION'
        AND TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY');
        
        /
        DECLARE
        
             TYPE T_QA_TTT2_REGISTRO IS TABLE OF QA_TTT2_REGISTRO%ROWTYPE;
             V_QA_TTT2_REGISTRO T_QA_TTT2_REGISTRO;
         
        BEGIN 
        
            SELECT * BULK COLLECT INTO V_QA_TTT2_REGISTRO 
            FROM QA_TTT2_REGISTRO
            WHERE TT2_ESTADO_BRA11='CONSTRUCCION'
            AND TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY');
            
            IF V_QA_TTT2_REGISTRO IS NOT EMPTY THEN
            FOR i IN V_QA_TTT2_REGISTRO.FIRST..V_QA_TTT2_REGISTRO.LAST LOOP
                 DBMS_OUTPUT.PUT_LINE(V_QA_TTT2_REGISTRO(i).TT2_CODIGOELEMENTO||'-'||V_QA_TTT2_REGISTRO(i).TT2_CODE_IUA);
            END LOOP;
     
        END IF;
                
        END;
        /
        
        UPDATE QA_TTT2_REGISTRO
        SET TT2_ESTADO = 'CONSTRUCCION'
        WHERE TT2_ESTADO_BRA11='CONSTRUCCION'
        AND TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY')        
        ;
        
       --Pasar de estado "OPERACION" a estado "CONSTRUCCION" a los activos en "CONSTRUCCION" del periodo actual
        UPDATE QA_TTT2_REGISTRO
        SET    TT2_ESTADO         = 'CONSTRUCCION'
        WHERE  TT2_ESTADO_BRA11   = 'CONSTRUCCION'
        AND    TT2_PERIODO_OP     = FECHAOPERACION;
        COMMIT;

        
        (SELECT '0001' AS MENOS FROM DUAL UNION ALL
         SELECT '0002' FROM DUAL UNION ALL
         SELECT '0001' FROM DUAL UNION ALL
         SELECT '0004' FROM DUAL UNION ALL
         SELECT '0005' FROM DUAL)
        MINUS
        (SELECT '0001' FROM DUAL UNION ALL
         SELECT '0001' FROM DUAL UNION ALL
         SELECT '0003' FROM DUAL UNION ALL
         SELECT '0004' FROM DUAL UNION ALL
         SELECT '0005' FROM DUAL)
        ;

        
  ------------------EJECUCION 28/12/2021
   DELETE FROM QA_TTT2_REGISTRO_ESPEJO;
   COMMIT;
   
   DROP TABLE QA_TTT2_REGISTRO_ESPEJO;
   
   CREATE TABLE QA_TTT2_REGISTRO_ESPEJO AS
   
   SELECT * FROM QA_TTT2_REGISTRO;
   
   SELECT * FROM QA_TTT2_REGISTRO_ESPEJO
   MINUS
   SELECT * FROM QA_TTT2_REGISTRO;
   
   COMMIT;
   
        EXEC QA_PTT2_REGISTRO(TO_DATE('01/12/2021','DD/MM/YYYY'));
        
        SELECT * FROM QA_TTT2_OBS;
        
        SELECT * FROM QA_TTT2_REGISTRO
        WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY')
        AND TT2_TIPOPROYECTO IN (2,4);
        
        SELECT * FROM QA_TTT2_TEMP;
        SELECT * FROM QA_TTT2_BRAFO;
        SELECT * FROM QA_TTT2_OBS;
        SELECT * FROM QA_TTT2_REGISTRO;   
        
        
        
             CON.NODO_TRANSFORM_V                         AS TT2_CODIGOELEMENTO
            ,''                                           AS TT2_CODE_IUA --GESTIONADO POR PROCEDIMIENTO
            ,TO_CHAR(COM.GRUPO_CALIDAD)                   AS TT2_GRUPOCALIDAD
            ,TO_CHAR(COM.ID_MERCADO)                      AS TT2_IDMERCADO
            ,TO_NUMBER(CON.CAPACIDAD_NOMINAL)             AS TT2_CAPACIDAD_TRAFO
            ,TO_CHAR(CASE WHEN (CPRO.PROPIETARIO_1='CENS')AS TT2_PROPIEDAD
            ,TO_NUMBER(ET.TIPO_SUBESTACION)               AS TT2_TSUBESTACION
            ,TO_NUMBER(COM.COOR_GPS_LON)                  AS TT2_LONGITUD
            ,TO_NUMBER(COM.COOR_GPS_LAT)                  AS TT2_LATITUD
            ,TO_NUMBER(COM.COOR_Z)                        AS TT2_ALTITUD
            ,COM.ESTADO                                   AS TT2_ESTADO
            ,(CASE WHEN(ET.PROVISIONAL = 'SI')            AS TT2_ESTADO_BRA11
            ,'CREG 015'                                   AS TT2_RESMETODOLOGIA
            ,''                                           AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
            ,CON.CIRCUITO                                 AS TT2_NOMBRE_CIRCUITO
            ,TT1.TT1_CODIGOCIRCUITO                       AS TT2_IUL
            ,''                                           AS TT2_CODIGOPROYECTO --INDEFINIDO
            ,COM.UC                                       AS TT2_UNIDAD_CONSTRUCTIVA
            ,DECODE(CPRO.PROPIETARIO_1,'ESTADO',1,0)      AS TT2_RPP
            ,DECODE(COM.SALINIDAD, 'SI', '1', '2')        AS TT2_SALINIDAD
            ,(CASE WHEN (COM.TIPO_PROYECTO = 'T4')        AS TT2_TIPOPROYECTO -- CONFIGURADO POR PROCEDIMIENTO
            ,2                                            AS TT2_REMUNERACION_PENDIENTE 
            ,''                                           AS TT2_ALTERNATIVA_VALORACION 
            ,NULL                                         AS TT2_ID_PLAN
            ,0                                            AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
            ,COM.FECHA_OPERACION                          AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
            ,COM.FECHA_COLOCACION                         AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
            ,COM.FECHA_MODIFICACION                       AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
            ,COM.USUARIO_COLOCACION                       AS TT2_USR_COLOCACION --PERS
            ,COM.USUARIO_MODIFICACION                     AS TT2_USR_MODFICACION
            ,TRUNC(FECHAOPERACION)                        AS TT2_PERIODO_OP
            ,0                                            AS TT2_REPORTE
            ,SYSDATE                                      AS TT2_FSISTEMA
            ,0                                            AS TT2_ACTIVOCONEXION --PENDIENTE TRAER DEL SISTEMA GTECH
            ,(CASE WHEN ET.PROVISIONAL='SI'               AS TT2_ACTIVOPROVISIONAL --PENDIENTE TRAER DEL SISTEMA
                
DESC QA_TTT2_REGISTRO;



/
DECLARE
 TYPE T_QA_TTT2_REGISTRO IS TABLE OF QA_TTT2_REGISTRO%ROWTYPE;
  V_QA_TTT2_REGISTRO T_QA_TTT2_REGISTRO;
  FECHAOPERACION DATE;
  
  CURSOR QA_CTT2_REGISTRO IS
            SELECT  SUBSTR(CON.NODO_TRANSFORM_V,1,20)                     AS TT2_CODIGOELEMENTO
            ,NULL                                         AS TT2_CODE_IUA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(COM.GRUPO_CALIDAD,1,2)                   AS TT2_GRUPOCALIDAD
            ,SUBSTR(COM.ID_MERCADO,1,20)                      AS TT2_IDMERCADO
            ,TO_NUMBER(CON.CAPACIDAD_NOMINAL)             AS TT2_CAPACIDAD_TRAFO
            ,(CASE WHEN (CPRO.PROPIETARIO_1='CENS')
                   THEN ('1'                      )
                   ELSE ('0'                      )
             END)                                         AS TT2_PROPIEDAD
            ,TO_NUMBER(ET.TIPO_SUBESTACION)               AS TT2_TSUBESTACION
            ,TO_NUMBER(COM.COOR_GPS_LON)                  AS TT2_LONGITUD
            ,TO_NUMBER(COM.COOR_GPS_LAT)                  AS TT2_LATITUD
            ,TO_NUMBER(COM.COOR_Z)                        AS TT2_ALTITUD
            ,SUBSTR(COM.ESTADO,1,20)                        AS TT2_ESTADO
            /*,(CASE WHEN (COM.ESTADO = 'CONSTRUCCION') 
                   THEN (   'OPERACION'             ) 
                   ELSE (COM.ESTADO                 ) 
              END)                                        AS TT2_ESTADO*/
            ,(CASE WHEN(ET.PROVISIONAL = 'SI') 
                   THEN('CONSTRUCCION'       ) 
                   ELSE(COM.ESTADO           ) 
              END)                                        AS TT2_ESTADO_BRA11
            ,'CREG 015'                                   AS TT2_RESMETODOLOGIA
            ,NULL                                         AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(CON.CIRCUITO,1,20)                                 AS TT2_NOMBRE_CIRCUITO
            ,SUBSTR(TT1.TT1_CODIGOCIRCUITO,1,5)                       AS TT2_IUL
            ,NULL                                         AS TT2_CODIGOPROYECTO --INDEFINIDO
            ,SUBSTR(COM.UC,1,20)                                       AS TT2_UNIDAD_CONSTRUCTIVA
            ,DECODE(CPRO.PROPIETARIO_1,'ESTADO',1,0)      AS TT2_RPP
            ,DECODE(COM.SALINIDAD, 'SI', '1', '2')        AS TT2_SALINIDAD
            ,(CASE WHEN (COM.TIPO_PROYECTO = 'T4')
                   THEN ('T4'                    )
                   ELSE (NULL                    ) 
              END)                                        AS TT2_TIPOPROYECTO -- CONFIGURADO POR PROCEDIMIENTO
            ,2                                            AS TT2_REMUNERACION_PENDIENTE 
            ,DECODE
              (DECODE(ET.PROVISIONAL
                          ,'SI','CONSTRUCCION'
                          ,COM.ESTADO
                      ),'CONSTRUCCION','INVA'
                       ,'OPERACION','BRAEN'
                       ,'RETIRADO','BRAFO'
               )                                          AS TT2_ALTERNATIVA_VALORACION 
            ,NULL                                         AS TT2_ID_PLAN
            ,0                                            AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
            ,COM.FECHA_OPERACION                          AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
            ,COM.FECHA_COLOCACION                         AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
            ,COM.FECHA_MODIFICACION                       AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
            ,COM.USUARIO_COLOCACION                       AS TT2_USR_COLOCACION --PERS
            ,COM.USUARIO_MODIFICACION                     AS TT2_USR_MODFICACION
            ,TRUNC(SYSDATE,'MM')                          AS TT2_PERIODO_OP
            ,0                                            AS TT2_REPORTE
            ,SYSDATE                                      AS TT2_FSISTEMA
            ,0                                            AS TT2_ACTIVOCONEXION --PENDIENTE TRAER DEL SISTEMA GTECH
            ,(CASE WHEN ET.PROVISIONAL='SI'
                   THEN 1 
                   ELSE 0 
              END)                                        AS TT2_ACTIVOPROVISIONAL --PENDIENTE TRAER DEL SISTEMA
        BULK COLLECT INTO   V_QA_TTT2_REGISTRO
        FROM                CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
            LEFT OUTER JOIN QA_TTT1_REGISTRO       TT1  ON  TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
        WHERE               COM.G3E_FNO = 20400
        ;--AND ROWNUM <= 10 ;
  
BEGIN

--BORRADO DE LA TABLA QA_TTT2_TEMP;
  DELETE FROM QA_TTT2_TEMP;
  COMMIT;


 DBMS_OU    TPUT.PUT_LINE('APERTURA DEL CURSOR');
      OPEN QA_CTT2_REGISTRO;
          FETCH QA_CTT2_REGISTRO BULK COLLECT INTO V_QA_TTT2_REGISTRO;         
          FORALL i IN V_QA_TTT2_REGISTRO.FIRST .. V_QA_TTT2_REGISTRO.LAST
          -- INSERTA LOS VALORES EN LA TABLA QA_TTT2_REGISTRO
          --DBMS_OUTPUT.PUT_LINE(i);
          INSERT INTO BRAE.QA_TTT2_TEMP
          VALUES V_QA_TTT2_REGISTRO(i);
          
      CLOSE QA_CTT2_REGISTRO; 
      COMMIT;
       
        
END;
/

SELECT * FROM QA_TTT2_TEMP;
SELECT * FROM QA_TTT2_REGISTRO;



SELECT SUBSTR('PEPE PEREZ',1,20) FROM DUAL; 


------------------EJECUCION 29/12/2021
-->NO REPORTAR EN TT2 LOS ACTIVO DE CONSTRUCCION - ESTOS SOLO SERIAN VISTOS EN BRA11 COMO INVA - PLANEACION
-->SE GARANTIZA QUE LAS REOPSICIONES NO SEAN REALIZADAS A LOS ACTIVOS DE 
---CONEXION, PROVISIONALES, Y EN CONSTRUCCION (INVA)


DELETE FROM QA_TTT2_REGISTRO;
COMMIT;

INSERT INTO QA_TTT2_REGISTRO
SELECT * FROM QA_TTT2_REGISTRO_ESPEJO;
COMMIT;

EXEC QA _PTT2_REGISTRO(TO_DATE('01/12/2021','DD/MM/YYYY'));
     
SELECT * FRO    M    QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP = TO_DATE('01/12/2021','DD/MM/YYYY');
 
 
SELECT * FROM QA_TTT2_REGISTRO;


SELECT CON.NODO_TRANSFORM_V,SUM(LUM.POTENCIA) AS POTENCIA_INSTALADA0
FROM CCONECTIVIDAD_E@GTECH CON
JOIN CCOMUN@GTECH COM ON CON.G3E_FID=COM.G3E_FID
JOIN ELUMINAR_AT@GTECH LUM ON  LUM.G3E_FID = CON.G3E_FID
WHERE CON.G3E_FNO = 21400
GROUP BY CON.NODO_TRANSFORM_V; 

SELECT POTENCIA 
FROM ELUMINAR_AT@GTECH
;
TT2_AP_POTENCIA
TT2_CODIGOCALP



  --CARGAR DATOS DE TRANSFERENCIA DE GTECH A BRAE 
        --V_QA_TTT2_REGISTRO.DELETE;
        SELECT SUBSTR(CON.NODO_TRANSFORM_V,1,20)          AS TT2_CODIGOELEMENTO
            ,NULL                                         AS TT2_CODE_IUA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(COM.GRUPO_CALIDAD,1,2)                AS TT2_GRUPOCALIDAD
            ,SUBSTR(COM.ID_MERCADO,1,20)                  AS TT2_IDMERCADO
            ,TO_NUMBER(CON.CAPACIDAD_NOMINAL)             AS TT2_CAPACIDAD_TRAFO
            ,TO_CHAR(CASE WHEN (CPRO.PROPIETARIO_1='CENS')
                          THEN ('1'                      )
                          ELSE ('0'                      )
             END)                                         AS TT2_PROPIEDAD
            ,TO_NUMBER(ET.TIPO_SUBESTACION)               AS TT2_TSUBESTACION
            ,TO_NUMBER(COM.COOR_GPS_LON)                  AS TT2_LONGITUD
            ,TO_NUMBER(COM.COOR_GPS_LAT)                  AS TT2_LATITUD
            ,TO_NUMBER(COM.COOR_Z)                        AS TT2_ALTITUD
            ,SUBSTR(COM.ESTADO,1,20)                      AS TT2_ESTADO
            /*,(CASE WHEN (COM.ESTADO = 'CONSTRUCCION') 
                   THEN (   'OPERACION'             ) 
                   ELSE (COM.ESTADO                 ) 
              END)                                        AS TT2_ESTADO*/
            ,(CASE WHEN(ET.PROVISIONAL = 'SI') 
                   THEN('CONSTRUCCION'       ) 
                   ELSE(COM.ESTADO           ) 
              END)                                        AS TT2_ESTADO_BRA11
            ,'CREG 015'                                   AS TT2_RESMETODOLOGIA
            ,NULL                                         AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(CON.CIRCUITO,1,20)                    AS TT2_NOMBRE_CIRCUITO
            ,SUBSTR(TT1.TT1_CODIGOCIRCUITO,1,5)           AS TT2_IUL
            ,NULL                                         AS TT2_CODIGOPROYECTO --INDEFINIDO
            ,SUBSTR(COM.UC,1,20)                          AS TT2_UNIDAD_CONSTRUCTIVA
            ,DECODE(CPRO.PROPIETARIO_1,'ESTADO',1,0)      AS TT2_RPP
            ,DECODE(COM.SALINIDAD, 'SI', '1', '2')        AS TT2_SALINIDAD
            ,(CASE WHEN (COM.TIPO_PROYECTO = 'T4')
                   THEN ('T4'                    )
                   ELSE (NULL                    ) 
              END)                                        AS TT2_TIPOPROYECTO -- CONFIGURADO POR PROCEDIMIENTO
            ,2                                            AS TT2_REMUNERACION_PENDIENTE 
            ,DECODE
              (DECODE(ET.PROVISIONAL
                          ,'SI','CONSTRUCCION'
                          ,COM.ESTADO
                      ),'CONSTRUCCION','INVA'
                       ,'OPERACION','BRAEN'
                       ,'RETIRADO','BRAFO'
               )                                          AS TT2_ALTERNATIVA_VALORACION 
            ,NULL                                         AS TT2_ID_PLAN
            ,0                                            AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
            ,COM.FECHA_OPERACION                          AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
            ,COM.FECHA_COLOCACION                         AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
            ,COM.FECHA_MODIFICACION                       AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
            ,COM.USUARIO_COLOCACION                       AS TT2_USR_COLOCACION --PERS
            ,COM.USUARIO_MODIFICACION                     AS TT2_USR_MODFICACION
            --,TRUNC(FECHAOPERACION)                        AS TT2_PERIODO_OP
            ,0                                            AS TT2_REPORTE
            ,SYSDATE                                      AS TT2_FSISTEMA
            ,0                                            AS TT2_ACTIVOCONEXION --PENDIENTE TRAER DEL SISTEMA GTECH
            ,(CASE WHEN ET.PROVISIONAL='SI'
                   THEN 1 
                   ELSE 0 
              END)                                        AS TT2_ACTIVOPROVISIONAL --PENDIENTE TRAER DEL SISTEMA
        --BULK COLLECT INTO   V_QA_TTT2_REGISTRO
        FROM                CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
            LEFT OUTER JOIN ELUMINAR_AT@GTECH      LUM  ON  LUM.G3E_FID            = CON.G3E_FID
            LEFT OUTER JOIN QA_TTT1_REGISTRO       TT1  ON  TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
        WHERE               COM.G3E_FNO = 20400;

  
       
------------------EJECUCION 04/01/2022 
EXEC QA_PTT2_REGISTRO(TO_DATE('01/12/2021','DD/MM/YYYY'));

SELECT DISTINCT TT2_CODIGOELEMENTO
FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY')
AND TT2_TIPOPROYECTO IN (1,3)

INTERSECT 
  
SELECT DISTINCT FDD_CODIGOELEMENTO 
FROM QA_TFDDREGISTRO
WHERE FDD_FINICIAL >= TO_dATE('01/01/2022','DD/MM/YYYY');

  
----------------------

SELECT CON.NODO_TRANSFORM_V,SUM(LUM.POTENCIA) AS POTENCIA_INSTALADA0
FROM CCONECTIVIDAD_E@GTECH CON
JOIN CCOMUN@GTECH COM ON CON.G3E_FID=COM.G3E_FID
JOIN ELUMINAR_AT@GTECH LUM ON  LUM.G3E_FID = CON.G3E_FID
WHERE CON.G3E_FNO = 21400
GROUP BY CON.NODO_TRANSFORM_V; 

SELECT POTENCIA 
FROM ELUMINAR_AT@GTECH
;
--TT2_AP_POTENCIA
--TT2_CODIGOCALP  
  
  
SELECT * FROM QA_TTT2_OBS;
  
SELECT * FROM QA_TTT2_REGISTRO_ESPEJO
WHERE TT2_CODIGOELEMENTO='1T13060';


EXEC QA_PTT2_REGISTRO(TO_DATE('01/12/2021','DD/MM/YYYY'));

--CONFIRMACION DE QUE LA SENTENCIA MINUS ELIMINA DUPLICADOS
SELECT 1 FROM DUAL UNION ALL
SELECT 1 FROM DUAL
MINUS
SELECT 2 FROM DUAL;

SELECT * FROM QA_TTT2_temp
WHERE TT2_CODIGOELEMENTO='1T13060';



        SELECT SUBSTR(CON.NODO_TRANSFORM_V,1,20)          AS TT2_CODIGOELEMENTO
            ,NULL                                         AS TT2_CODE_IUA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(COM.GRUPO_CALIDAD,1,2)                AS TT2_GRUPOCALIDAD
            ,SUBSTR(COM.ID_MERCADO,1,20)                  AS TT2_IDMERCADO
            ,TO_NUMBER(CON.CAPACIDAD_NOMINAL)             AS TT2_CAPACIDAD_TRAFO
            ,TO_CHAR(CASE WHEN (CPRO.PROPIETARIO_1='CENS')
                          THEN ('1'                      )
                          ELSE ('0'                      )
             END)                                         AS TT2_PROPIEDAD
            ,TO_NUMBER(ET.TIPO_SUBESTACION)               AS TT2_TSUBESTACION
            ,TO_NUMBER(COM.COOR_GPS_LON)                  AS TT2_LONGITUD
            ,TO_NUMBER(COM.COOR_GPS_LAT)                  AS TT2_LATITUD
            ,TO_NUMBER(COM.COOR_Z)                        AS TT2_ALTITUD
            ,SUBSTR(COM.ESTADO,1,20)                      AS TT2_ESTADO
            /*,(CASE WHEN (COM.ESTADO = 'CONSTRUCCION') 
                   THEN (   'OPERACION'             ) 
                   ELSE (COM.ESTADO                 ) 
              END)                                        AS TT2_ESTADO*/
            ,(CASE WHEN(ET.PROVISIONAL = 'SI') 
                   THEN('CONSTRUCCION'       ) 
                   ELSE(COM.ESTADO           ) 
              END)                                        AS TT2_ESTADO_BRA11
            ,'CREG 015'                                   AS TT2_RESMETODOLOGIA
            ,NULL                                         AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(CON.CIRCUITO,1,20)                    AS TT2_NOMBRE_CIRCUITO
            ,SUBSTR(TT1.TT1_CODIGOCIRCUITO,1,5)           AS TT2_IUL
            ,NULL                                         AS TT2_CODIGOPROYECTO --INDEFINIDO
            ,SUBSTR(COM.UC,1,20)                          AS TT2_UNIDAD_CONSTRUCTIVA
            ,DECODE(CPRO.PROPIETARIO_1,'ESTADO',1,0)      AS TT2_RPP
            ,DECODE(COM.SALINIDAD, 'SI', '1', '2')        AS TT2_SALINIDAD
            ,(CASE WHEN (COM.TIPO_PROYECTO = 'T4')
                   THEN ('T4'                    )
                   ELSE (NULL                    ) 
              END)                                        AS TT2_TIPOPROYECTO -- CONFIGURADO POR PROCEDIMIENTO
            ,2                                            AS TT2_REMUNERACION_PENDIENTE 
            ,DECODE
              (DECODE(ET.PROVISIONAL
                          ,'SI','CONSTRUCCION'
                          ,COM.ESTADO
                      ),'CONSTRUCCION','INVA'
                       ,'OPERACION','BRAEN'
                       ,'RETIRADO','BRAFO'
               )                                          AS TT2_ALTERNATIVA_VALORACION 
            ,NULL                                         AS TT2_ID_PLAN
            ,0                                            AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
            ,COM.FECHA_OPERACION                          AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
            ,COM.FECHA_COLOCACION                         AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
            ,COM.FECHA_MODIFICACION                       AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
            ,COM.USUARIO_COLOCACION                       AS TT2_USR_COLOCACION --PERS
            ,COM.USUARIO_MODIFICACION                     AS TT2_USR_MODFICACION
            --,TRUNC(FECHAOPERACION)                        AS TT2_PERIODO_OP
            ,0                                            AS TT2_REPORTE
            ,SYSDATE                                      AS TT2_FSISTEMA
            ,0                                            AS TT2_ACTIVOCONEXION --PENDIENTE TRAER DEL SISTEMA GTECH
            ,(CASE WHEN ET.PROVISIONAL='SI'
                   THEN 1 
                   ELSE 0 
              END)                                        AS TT2_ACTIVOPROVISIONAL --PENDIENTE TRAER DEL SISTEMA
        --BULK COLLECT INTO   V_QA_TTT2_REGISTRO
        FROM                CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
            LEFT OUTER JOIN QA_TTT1_REGISTRO       TT1  ON  TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
        WHERE               COM.G3E_FNO = 20400
        AND SUBSTR(CON.NODO_TRANSFORM_V,1,20) IN ('5T02995',
'5T02997',
'1T13204',
'1T13208',
'1T13209',
'1T13205',
'1T13206',
'1T13207',
'1T13231',
'1T13213');
     
SELECT * FROM QA_TTT2_REGISTRO 
WHERE TT2_CODIGOELEMENTO IN ('1T13061',
'1T13067',
'1T13078',
'1T13081',
'1T13132',
'1T13181',
'1T13194',
'1T13203',
'3T04900',
'5T02986'
);


SELECT * FROM QA_TTT2_OBS; 


EXEC QA_PTT2_REGISTRO(TO_DATE('01/12/2021','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO WHERE TT2_CODE_IUA IS NULL;

/

BEGIN
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='100ID0009Z' WHERE TT2_CODIGOELEMENTO='1T05061';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='100HOU009Z' WHERE TT2_CODIGOELEMENTO='1T06410';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='10078F0001' WHERE TT2_CODIGOELEMENTO='1T04873';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='100IOS009Z' WHERE TT2_CODIGOELEMENTO='1T06417';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='100HNH0102' WHERE TT2_CODIGOELEMENTO='1T04916';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='100FUK010C' WHERE TT2_CODIGOELEMENTO='5T00457';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='100BZZ0001' WHERE TT2_CODIGOELEMENTO='3T02405';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='100DK10001' WHERE TT2_CODIGOELEMENTO='3T04453';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1007F00001' WHERE TT2_CODIGOELEMENTO='1T06198';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1007C20001' WHERE TT2_CODIGOELEMENTO='1T05088';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1000JT0001' WHERE TT2_CODIGOELEMENTO='1T01443';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='10062F0001' WHERE TT2_CODIGOELEMENTO='1T00819';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1003UD0001' WHERE TT2_CODIGOELEMENTO='3T00621';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1006UI0001' WHERE TT2_CODIGOELEMENTO='1T03719';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1009XW0001' WHERE TT2_CODIGOELEMENTO='1T09663';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='100G5B0101' WHERE TT2_CODIGOELEMENTO='1T07408';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='100HNZ0102' WHERE TT2_CODIGOELEMENTO='1T03341';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1006SU0001' WHERE TT2_CODIGOELEMENTO='1T03607';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1006RH0001' WHERE TT2_CODIGOELEMENTO='1T03533';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='100A0U0001' WHERE TT2_CODIGOELEMENTO='1T09792';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='100HYP0102' WHERE TT2_CODIGOELEMENTO='1T12592';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='10017W0001' WHERE TT2_CODIGOELEMENTO='1T03384';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1007J40001' WHERE TT2_CODIGOELEMENTO='1T06450';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1007JZ0001' WHERE TT2_CODIGOELEMENTO='1T06503';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1007J00001' WHERE TT2_CODIGOELEMENTO='1T06444';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1000DR0001' WHERE TT2_CODIGOELEMENTO='1T01000';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='10084E0001' WHERE TT2_CODIGOELEMENTO='2T00636';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='10030B0001' WHERE TT2_CODIGOELEMENTO='2T00638';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='10037P0001' WHERE TT2_CODIGOELEMENTO='2T01075';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1002VH0001' WHERE TT2_CODIGOELEMENTO='2T00404';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1007MQ0001' WHERE TT2_CODIGOELEMENTO='1T06804';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1002ZA0001' WHERE TT2_CODIGOELEMENTO='2T00586';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1006C90001' WHERE TT2_CODIGOELEMENTO='1T01932';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1002OO0001' WHERE TT2_CODIGOELEMENTO='1TB0050';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1001110097' WHERE TT2_CODIGOELEMENTO='1T12652';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1002080101' WHERE TT2_CODIGOELEMENTO='2T01544';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1000050091' WHERE TT2_CODIGOELEMENTO='1T00725';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_IUA='1001060103' WHERE TT2_CODIGOELEMENTO='5T02685';
END;
/
COMMIT;

  
EXEC QA_PTT2_REGISTRO(TO_DATE('01/12/2021','DD/MM/YYYY'));   

SELECT * FROM QA_TTT2_REGISTRO WHERE TT2_CODIGOELEMENTO='1T05061';

SELECT * FROM QA_TTT2_REGISTRO;


SELECT * FROM QA_TTC1 
WHERE TC1_PERIODO=202111
AND TC1_CODCONEX='4T01424';



SELECT * FROM QA_TTT2_REGISTRO;



--CARGAR DATOS DE TRANSFERENCIA DE GTECH A BRAE 
        --V_QA_TTT2_REGISTRO.DELETE;
WITH INFO_AP AS (
SELECT CON.NODO_TRANSFORM_V,SUM(LUM.POTENCIA) AS POTENCIA_INSTALADA
FROM CCONECTIVIDAD_E@GTECH CON
JOIN CCOMUN@GTECH COM ON CON.G3E_FID=COM.G3E_FID
JOIN ELUMINAR_AT@GTECH LUM ON  LUM.G3E_FID = CON.G3E_FID
WHERE CON.G3E_FNO = 21400
GROUP BY CON.NODO_TRANSFORM_V
)
(       SELECT SUBSTR(CON.NODO_TRANSFORM_V,1,20)          AS TT2_CODIGOELEMENTO
            ,NULL                                         AS TT2_CODE_IUA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(COM.GRUPO_CALIDAD,1,2)                AS TT2_GRUPOCALIDAD
            ,SUBSTR(COM.ID_MERCADO,1,20)                  AS TT2_IDMERCADO
            ,TO_NUMBER(CON.CAPACIDAD_NOMINAL)             AS TT2_CAPACIDAD_TRAFO
            ,TO_CHAR(CASE WHEN (CPRO.PROPIETARIO_1='CENS')
                          THEN ('1'                      )
                          ELSE ('0'                      )
             END)                                         AS TT2_PROPIEDAD
            ,TO_NUMBER(ET.TIPO_SUBESTACION)               AS TT2_TSUBESTACION
            ,TO_NUMBER(COM.COOR_GPS_LON)                  AS TT2_LONGITUD
            ,TO_NUMBER(COM.COOR_GPS_LAT)                  AS TT2_LATITUD
            ,TO_NUMBER(COM.COOR_Z)                        AS TT2_ALTITUD
            ,SUBSTR(COM.ESTADO,1,20)                      AS TT2_ESTADO
            /*,(CASE WHEN (COM.ESTADO = 'CONSTRUCCION') 
                   THEN (   'OPERACION'             ) 
                   ELSE (COM.ESTADO                 ) 
              END)                                        AS TT2_ESTADO*/
            ,(CASE WHEN(ET.PROVISIONAL = 'SI') 
                   THEN('CONSTRUCCION'       ) 
                   ELSE(COM.ESTADO           ) 
              END)                                        AS TT2_ESTADO_BRA11
            ,'CREG 015'                                   AS TT2_RESMETODOLOGIA
            ,NULL                                         AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(CON.CIRCUITO,1,20)                    AS TT2_NOMBRE_CIRCUITO
            ,SUBSTR(TT1.TT1_CODIGOCIRCUITO,1,5)           AS TT2_IUL
            ,NULL                                         AS TT2_CODIGOPROYECTO --INDEFINIDO
            ,SUBSTR(COM.UC,1,20)                          AS TT2_UNIDAD_CONSTRUCTIVA
            ,DECODE(CPRO.PROPIETARIO_1,'ESTADO',1,0)      AS TT2_RPP
            ,DECODE(COM.SALINIDAD, 'SI', '1', '2')        AS TT2_SALINIDAD
            ,(CASE WHEN (COM.TIPO_PROYECTO = 'T4')
                   THEN ('T4'                    )
                   ELSE (NULL                    ) 
              END)                                        AS TT2_TIPOPROYECTO -- CONFIGURADO POR PROCEDIMIENTO
            ,2                                            AS TT2_REMUNERACION_PENDIENTE 
            ,DECODE
              (DECODE(ET.PROVISIONAL
                          ,'SI','CONSTRUCCION'
                          ,COM.ESTADO
                      ),'CONSTRUCCION','INVA'
                       ,'OPERACION','BRAEN'
                       ,'RETIRADO','BRAFO'
               )                                          AS TT2_ALTERNATIVA_VALORACION 
            ,NULL                                         AS TT2_ID_PLAN
            ,0                                            AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
            ,COM.FECHA_OPERACION                          AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
            ,COM.FECHA_COLOCACION                         AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
            ,COM.FECHA_MODIFICACION                       AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
            ,COM.USUARIO_COLOCACION                       AS TT2_USR_COLOCACION --PERS
            ,COM.USUARIO_MODIFICACION                     AS TT2_USR_MODFICACION
            --,TRUNC(FECHAOPERACION)                        AS TT2_PERIODO_OP
            ,0                                            AS TT2_ESTADOREPORTE
            ,SYSDATE                                      AS TT2_FSISTEMA
            ,0                                            AS TT2_ACTIVOCONEXION --PENDIENTE TRAER DEL SISTEMA GTECH
            ,(CASE WHEN ET.PROVISIONAL='SI'
                   THEN 1 
                   ELSE 0 
              END)                                        AS TT2_ACTIVOPROVISIONAL --PENDIENTE TRAER DEL SISTEMA
            ,NVL(AP.POTENCIA_INSTALADA,0)                 AS TT2_AP_POTENCIA
            ,0                                            AS TT2_CODE_CALP
        --BULK COLLECT INTO   V_QA_TTT2_REGISTRO
        FROM                CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
            LEFT OUTER JOIN QA_TTT1_REGISTRO       TT1  ON  TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
            LEFT OUTER JOIN INFO_AP                AP   ON AP.NODO_TRANSFORM_V     = SUBSTR(CON.NODO_TRANSFORM_V,1,20)
        WHERE               COM.G3E_FNO = 20400
);

--22.833  Filas


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;

--ALTER TABLE PARA AGREGAR DOS CAMPOS DE MARCACION DE AP (CALP) 10-01-2022

ALTER TABLE QA_TTT2_REGISTRO
ADD TT2_CODE_CALP VARCHAR2(20);
         
ALTER TABLE QA_TTT2_BRAFO
ADD TT2_CODE_CALP VARCHAR2(20);          

ALTER TABLE QA_TTT2_OBS
ADD TT2_CODE_CALP VARCHAR2(20);

ALTER TABLE QA_TTT2_TEMP
ADD TT2_CODE_CALP VARCHAR2(20);

ALTER TABLE QA_TTT2_REGISTRO_ESPEJO
ADD TT2_CODE_CALP VARCHAR2(20);

SELECT * FROM QA_TTT2_REGISTRO;

--CAMPOS AGRAGADOS SATISFACTORIAMENTE 10-01-2022

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN (SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO
                             WHERE TT2_PERIODO_OP = TO_DATE('01/12/2021','DD/MM/YYYY')
                             AND TT2_TIPOPROYECTO IN (2,4)
                             );

SELECT *
FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP = TO_DATE('01/12/2021','DD/MM/YYYY')
AND TT2_TIPOPROYECTO IN (2,4);

SELECT TT2_CODIGOELEMENTO,TT2_LONGITUD,TT2_LATITUD FROM QA_TTT2_REGISTRO
WHERE TT2_LONGITUD<(-100);

--MARCAR LOS REGISTROS DEL PERIODO 01-12-2021 COMO REPORTADOS
--ASIGNANDO UN VALOR DE "1" AL CAMPO TT2_ESTADOREPORTE;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;

UPDATE QA_TTT2_REGISTRO
SET TT2_ESTADOREPORTE=1
WHERE TT2_ESTADOREPORTE=0;
--189 FILAS ACTUALIZADAS

--COMMIT;

SELECT * FROM QA_TTT2_BRAFO; --CERO REGISTROS

--CORRER EL PROECEDIMIENTO QA_PTT2_REGISTRO() PARA QUE SEAN ALMACENADOS
--LOS BRAFOS EN LA TABLA QA_TTT2_BRAFO, periodo 01/01/2022

SELECT * FROM QA_TTT2_REGISTRO_ESPEJO;

DROP TABLE QA_TTT2_REGISTRO_ESPEJO;

CREATE TABLE QA_TTT2_BACKUP
AS 
SELECT * FROM QA_TTT2_REGISTRO;

--COMMIT;

SELECT * FROM QA_TTT2_BACKUP;

EXEC QA_PTT2_REGISTRO(TO_DATE('01/01/2022','DD/MM/YYYY'));

--SE VERFICA EN ESTE CASO LA INSERSION DE LOS ELEMENTOS BRAFO DENTRO DE LA
--ESTRAUCUTRA DE LA TABLA QA_TTT2_BRAFO.
SELECT * FROM QA_TTT2_BRAFO;--CANTIDAD DE 131 REGISTROS ELIMINADOS DE QA_TTT2_REGISTRO

SELECT * FROM QA_TTT2_REGISTRO 
WHERE TT2_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY')
AND TT2_TIPOPROYECTO IN (2,4);--2 REGISTROS DE EXPANSION

--ASIGNACION EN EL VALOR DE POTENCIA DE ALUMBRADO PUBLICO A LA INFORAMCION HISTORICA
--CAMPO TT2_AP_POTENCIA

--EXPORTAMOS LA SIGUIENTE INFORMACION, ASIGNAMOS EL CODIGO CALP ACTUAL DEL TC1
--SI NO TIENE CALP SE GENERA MANUALMENTE Y SE ACTUALIZAN LOS VALORES PARA LOS PERIODOS
--ANTERIORES AL ACTUAL, Y EL ACTUAL SE DEJA PARA LLENADO DESDE EL PROCEDIMIENTO

SELECT CON.NODO_TRANSFORM_V,SUM(LUM.POTENCIA) AS POTENCIA_INSTALADA
FROM CCONECTIVIDAD_E@GTECH CON
JOIN CCOMUN@GTECH COM ON CON.G3E_FID=COM.G3E_FID
JOIN ELUMINAR_AT@GTECH LUM ON  LUM.G3E_FID = CON.G3E_FID
WHERE CON.G3E_FNO = 21400
GROUP BY CON.NODO_TRANSFORM_V;

--IMPORTAMOS EL CONSOLIDADO "QA_TT2_AP" CON LOS CAMPOS ELEMENTO, CALP, POTENCIA
--CREAMOS LA TABLA TEMPORAL QA_TTT2_AP_TEMP

CREATE TABLE QA_TTT2_AP_TEMP(
ELEMENTO VARCHAR2(20),
CALP     VARCHAR2(20),
POTENCIA NUMBER
);
--Table QA_TTT2_AP_TEMP creado.

--IMPORTAMOS LA INFORMACION CONSOLIDADA EN EXCEL CONTRASTADA CON TC1 ACTUAL
SELECT * FROM QA_TTT2_AP_TEMP;

--REALIZAMOS ACTUALIZACION A LA TABLA QA_TTT2_REGISTRO,
--CON RESPECTO A LOS VALORES DE PONTENICA Y CALP DE LOS TRANSFORMASORES CON AP

UPDATE QA_TTT2_REGISTRO R
SET TT2_AP_POTENCIA = (SELECT POTENCIA FROM QA_TTT2_AP_TEMP WHERE ELEMENTO = R.TT2_CODIGOELEMENTO)
WHERE TT2_CODIGOELEMENTO IN (SELECT ELEMENTO FROM QA_TTT2_AP_TEMP);

UPDATE QA_TTT2_REGISTRO R
SET TT2_CODE_CALP = (SELECT CALP FROM QA_TTT2_AP_TEMP WHERE ELEMENTO = R.TT2_CODIGOELEMENTO)
WHERE TT2_CODIGOELEMENTO IN (SELECT ELEMENTO FROM QA_TTT2_AP_TEMP);

--6.328 filas actualizadas.
--6.328 filas actualizadas.
COMMIT;

UPDATE QA_TTT2_REGISTRO
SET TT2_AP_POTENCIA=0
   ,TT2_CODE_CALP = 0
WHERE TT2_AP_POTENCIA IS NULL;   

COMMIT;

SELECT TT2_CODIGOELEMENTO,TT2_AP_POTENCIA,TT2_CODE_CALP FROM QA_TTT2_REGISTRO
;

--REVISAR SI SE ACTUALIZARON TRANSFORAMDORES PENDIENES DE REPORTES Y ELIMNAR ACTUALIZACION AP

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY')
AND TT2_TIPOPROYECTO IN (1,3);

--VERFICADO

--BORRADO DE LAS TABLAS TEMPORALES USASDAS PARA ACTUALIZACION DE INFORMACION
--QA_TTT2_AP_TEMP
--QA_TTT2_ACTIVOPROVISIONAL

DROP TABLE QA_TTT2_AP_TEMP;
DROP TABLE QA_TTT2_ACTIVOPROVISIONAL;

--CREAR EN EL PROCEDIMIENTO EL MODULO QUE ACTUALICE LOS VALORES CALP Y POTENCIA

UPDATE QA_TTT2_REGISTRO R
SET   TT2_AP_POTENCIA = (SELECT TT2_AP_POTENCIA 
                         FROM QA_TTT2_TEMP 
                         WHERE TT2_CODIGOELEMENTO = R.TT2_CODIGOELEMENTO
                        )
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT TT2_CODIGOELEMENTO 
                            FROM QA_TTT2_TEMP
                            WHERE TT2_AP_POTENCIA <> 0
                            )
;


        --Borrar codigo CALP a los que tengan potenica CERO y CALP asignada
        
        DELETE FROM QA_TTT2_REGISTRO
        WHERE  TT2_AP_POTENCIA = 0
        AND    TT2_CODE_CALP  <> 0;
    

        --Asignar CALP a los que tengan potencia mayor a CERO y CALP igual a CERO
        
        SELECT DISTINCT TT2_CODIGOELEMENTO
        FROM   QA_TTT2_REGISTRO
        WHERE  TT2_AP_POTENCIA >  0
        AND    TT2_CODE_CALP   = '0';

        --Identificar el maximo valor numerico del codigo CALP actual
        SELECT MAX(TO_NUMBER(SUBSTR(TT2_CODE_CALP,5,20))) MAX_CONSECUTIVO_CALP
        --INTO MAX_CONSECUTIVO_CALP
        FROM BRAE.QA_TTT2_REGISTRO
        WHERE TT2_AP_POTENCIA >  0
        AND   TT2_CODE_CALP  <> '0';
        

SELECT 'CALP'|| LPAD((6023 + 1),9,0) FROM DUAL;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_CALP<>'0';





---------EJECUCION 24-02-2022


SELECT * FROM QA_TTT2_BACKUP;
DELETE FROM QA_TTT2_BACKUP;

COMMIT;

INSERT INTO QA_TTT2_BACKUP
SELECT * FROM QA_TTT2_REGISTRO;
COMMIT;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;

EXEC QA_PTT2_REGISTRO(TO_DATE('01/12/2021','DD/MM/YYYY'));

SELECT ADD_MONTHS(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'),-1) FROM DUAL;
SELECT TRUNC(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY')-1) FROM DUAL;


EXEC QA_PTT2_REGISTRO(TO_DATE('01/01/2022','DD/MM/YYYY'));

SELECT * 
FROM QA_TTT2_REGISTRO
WHERE TT2_AP_POTENCIA > 0
AND TT2_ESTADO='OPERACION';

SELECT *
FROM  QA_TTT2_REGISTRO
WHERE TT2_ESTADO='OPERACION'
AND   TT2_CODE_CALP LIKE 'CALP%'
;--AND   TT2_AP_POTENCIA > 0;

SELECT TT2_CODIGOELEMENTO,TT2_CODE_CALP,TT2_AP_POTENCIA
FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='OPERACION'
AND   TT2_CODE_CALP LIKE 'CALP%';

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='3T00222';

UPDATE QA_TTT2_REGISTRO
SET TT2_AP_POTENCIA = 733
WHERE TT2_CODIGOELEMENTO='3T00222';

COMMIT;

--733	CALP000005333

EXEC QA_PTT2_REGISTRO(TO_DATE('01/01/2022','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_TEMP;


ALTER TABLE QA_TTT2_REGISTRO
ADD TT2_POBLACION VARCHAR2(10);
         
ALTER TABLE QA_TTT2_BRAFO
ADD TT2_POBLACION VARCHAR2(10);

ALTER TABLE QA_TTT2_OBS
ADD TT2_POBLACION VARCHAR2(10);

ALTER TABLE QA_TTT2_TEMP
ADD TT2_POBLACION VARCHAR2(10);

ALTER TABLE QA_TTT2_BACKUP
ADD TT2_POBLACION VARCHAR2(10);


EXEC QA_PTT2_REGISTRO(TO_DATE('01/01/2022','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_TEMP;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY')
AND TT2_FASES IS NOT NULL
--AND TT2_TIPOPROYECTO IN (2,4)
;

            UPDATE BRAE.QA_TTT2_REGISTRO
            SET    TT2_PERIODO_OP             =  ADD_MONTHS(TRUNC(TT2_FSISTEMA,'MM'),-1),
                   TT2_ALTERNATIVA_VALORACION = 'BRAEN',
                   TT2_ESTADO                 = 'OPERACION',
                   TT2_ESTADO_BRA11           = 'OPERACION',
                   TT2_FESTADO                =  ADD_MONTHS(LAST_DAY(TT2_FSISTEMA),-1),
                   TT2_TIPOPROYECTO           = '2'
            WHERE  TT2_ESTADOREPORTE          =  1
            AND    TT2_TIPOPROYECTO IN ('1','3')
            AND    TT2_PERIODO_OP = TO_DATE('01/01/2022','DD/MM/YYYY');
            COMMIT;
            
            --ELIMINO LOS NUEVOS DE EXPANSION Y LOS NUEVOS DE REPOSICION
            DELETE 
            FROM  QA_TTT2_REGISTRO
            WHERE TT2_ESTADOREPORTE    = 0
            AND   TT2_PERIODO_OP = TO_DATE('01/01/2022','DD/MM/YYYY');           
            COMMIT;
            
SELECT * FROM QA_TTT2_REGISTRO;     

UPDATE QA_TTT2_REGISTRO R
SET TT2_FASES    =(SELECT DISTINCT TT2_FASES     FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO = R.TT2_CODIGOELEMENTO AND TT2_ESTADO='OPERACION')
   ,TT2_POBLACION=(SELECT DISTINCT TT2_POBLACION FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO = R.TT2_CODIGOELEMENTO AND TT2_ESTADO='OPERACION')            
;

COMMIT;

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO
                            WHERE TT2_POBLACION IS NULL
                            OR    TT2_FASES     IS NULL
                            );
                            

SELECT * 
FROM QA_TTT2_REGISTRO
WHERE TT2_POBLACION IS NULL
OR    TT2_FASES     IS NULL                           
;


UPDATE QA_TTT2_REGISTRO R
SET TT2_FASES    =(SELECT DISTINCT TT2_FASES     FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO = R.TT2_CODIGOELEMENTO)
   ,TT2_POBLACION=(SELECT DISTINCT TT2_POBLACION FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO = R.TT2_CODIGOELEMENTO)            
WHERE R.TT2_CODIGOELEMENTO IN (
                            SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO
                            WHERE TT2_POBLACION IS NULL
                            OR    TT2_FASES     IS NULL
                            );
                            
UPDATE QA_TTT2_REGISTRO 
SET TT2_FASES    =(SELECT DISTINCT TT2_FASES     FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO IN ('1T13231'))
   ,TT2_POBLACION=(SELECT DISTINCT TT2_POBLACION FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO IN ('1T13231'))            
WHERE TT2_CODIGOELEMENTO IN ('1T13231');

SELECT * FROM QA_TTT2_REGISTRO WHERE TT2_CODIGOELEMENTO IN ('1T13231');
SELECT * FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO IN ('1T13231');

COMMIT;
SELECT * FROM (
SELECT TT2_CODIGOELEMENTO,TT2_UNIDAD_CONSTRUCTIVA, 
(CASE
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T9'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	20	THEN'N1T10'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T11'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T12'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T13'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T14'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T15'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T14'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	125	THEN'N1T15'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	200	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1400	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T11'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T46'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	20	THEN'N1T47'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T48'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T49'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T50'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T51'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T52'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T47'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T49'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	315	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	450	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	930	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1500	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	3000	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	2600	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1200	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	650	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T46'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T1'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	7.5	THEN'N1T2'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T3'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T4'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T5'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T7'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T8'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T5'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T8'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T8'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T38'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	7.5	THEN'N1T39'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T40'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T41'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T42'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T44'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T45'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	3	THEN'N1T38'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T42'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T40'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T38'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T17'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T18'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T19'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T20'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T21'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T22'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T23'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T24'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T25'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T20'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2500	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	750	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T54'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T55'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T56'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T57'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T58'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T59'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T60'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T61'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T62'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T63'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T54'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T57'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T62'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T63'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T54'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T27'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T28'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T29'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T30'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T32'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T33'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T27'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T28'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	125	THEN'N1T29'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	160	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	200	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	240	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	315	THEN'N1T33'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	262.5	THEN'N1T33'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	450	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	337.5	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	342.5	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	412.5	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	462.5	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	475	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	600	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	525	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	550	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	575	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	675	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	750	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	930	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1500	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1400	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1630	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2000	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2400	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2500	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T64'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T65'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T66'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T67'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T68'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T69'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T70'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T71'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T72'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T73'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T74'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T64'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	160	THEN'N1T67'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T73'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	2000	THEN'N1T74'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T74'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T74'
END) UC_PAR_LUIS
FROM QA_TTT2_REGISTRO)
WHERE TT2_UNIDAD_CONSTRUCTIVA <> UC_PAR_LUIS;
--WHERE UC_PAR_LUIS IS NULL;
--WHERE TT2_UNIDAD_CONSTRUCTIVA IS NULL;

SELECT * FROM QA_TTT2_REGISTRO;

COMMIT;





SELECT JOB_MODIFICACION, JOB_COLOCACION, USUARIO_COLOCACION, USUARIO_MODIFICACION,
       FECHA_COLOCACION, CONTRATO_INSTALACION
FROM CCOMUN 
WHERE CODIGO_OPERATIVO='1T13102';


UPDATE QA_TTT2_REGISTRO
SET TT2_UNIDAD_CONSTRUCTIVA = (
(CASE
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T9'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	20	THEN'N1T10'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T11'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T12'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T13'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T14'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T15'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T14'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	125	THEN'N1T15'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	200	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1400	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T11'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T46'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	20	THEN'N1T47'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T48'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T49'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T50'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T51'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T52'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T47'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T49'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	315	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	450	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	930	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1500	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	3000	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	2600	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1200	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	650	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T46'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T1'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	7.5	THEN'N1T2'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T3'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T4'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T5'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T7'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T8'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T5'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T8'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T8'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T38'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	7.5	THEN'N1T39'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T40'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T41'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T42'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T44'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T45'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	3	THEN'N1T38'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T42'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T40'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T38'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T17'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T18'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T19'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T20'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T21'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T22'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T23'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T24'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T25'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T20'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2500	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	750	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T54'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T55'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T56'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T57'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T58'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T59'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T60'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T61'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T62'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T63'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T54'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T57'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T62'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T63'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T54'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T27'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T28'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T29'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T30'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T32'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T33'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T27'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T28'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	125	THEN'N1T29'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	160	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	200	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	240	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	315	THEN'N1T33'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	262.5	THEN'N1T33'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	450	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	337.5	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	342.5	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	412.5	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	462.5	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	475	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	600	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	525	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	550	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	575	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	675	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	750	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	930	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1500	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1400	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1630	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2000	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2400	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2500	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T64'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T65'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T66'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T67'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T68'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T69'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T70'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T71'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T72'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T73'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T74'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T64'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	160	THEN'N1T67'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T73'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	2000	THEN'N1T74'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T74'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T74'
END)
)
WHERE TT2_CODIGOELEMENTO IN (                            
                            SELECT TT2_CODIGOELEMENTO FROM (
                            SELECT TT2_CODIGOELEMENTO,TT2_UNIDAD_CONSTRUCTIVA, 
                            (CASE
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T9'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	20	THEN'N1T10'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T11'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T12'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T13'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T14'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T15'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T16'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T14'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	125	THEN'N1T15'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	200	THEN'N1T16'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T16'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T16'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T16'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T16'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T16'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T16'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1400	THEN'N1T16'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T16'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T16'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T11'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T46'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	20	THEN'N1T47'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T48'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T49'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T50'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T51'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T52'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T47'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T49'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	315	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	450	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	930	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1500	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	3000	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	2600	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1200	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	650	THEN'N1T53'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T46'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T1'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	7.5	THEN'N1T2'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T3'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T4'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T5'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T7'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T8'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T5'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T6'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T8'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T8'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T38'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	7.5	THEN'N1T39'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T40'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T41'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T42'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T44'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T45'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	3	THEN'N1T38'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T42'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T43'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T40'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T38'
                            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T17'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T18'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T19'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T20'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T21'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T22'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T23'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T24'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T25'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T26'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T20'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T26'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T26'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T26'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2500	THEN'N1T26'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	750	THEN'N1T26'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T54'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T55'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T56'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T57'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T58'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T59'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T60'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T61'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T62'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T63'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T54'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T57'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T62'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T63'
                            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T54'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T27'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T28'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T29'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T30'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T31'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T32'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T33'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T34'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T35'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T36'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T37'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T27'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T28'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	125	THEN'N1T29'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	160	THEN'N1T31'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	200	THEN'N1T31'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	240	THEN'N1T31'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	315	THEN'N1T33'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	262.5	THEN'N1T33'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	450	THEN'N1T34'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	337.5	THEN'N1T34'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	342.5	THEN'N1T34'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	412.5	THEN'N1T35'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	462.5	THEN'N1T35'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	475	THEN'N1T35'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	600	THEN'N1T35'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T36'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	525	THEN'N1T36'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	550	THEN'N1T36'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	575	THEN'N1T36'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	675	THEN'N1T36'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	750	THEN'N1T36'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	930	THEN'N1T36'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1500	THEN'N1T37'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T37'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1400	THEN'N1T37'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T37'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1630	THEN'N1T37'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2000	THEN'N1T37'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2400	THEN'N1T37'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2500	THEN'N1T37'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T64'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T65'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T66'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T67'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T68'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T69'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T70'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T71'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T72'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T73'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T74'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T64'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	160	THEN'N1T67'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T73'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	2000	THEN'N1T74'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T74'
                            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T74'
                            END) UC_PAR_LUIS
                            FROM QA_TTT2_REGISTRO)
                            WHERE TT2_UNIDAD_CONSTRUCTIVA <> UC_PAR_LUIS);


SELECT TT2_CODIGOELEMENTO
      ,TT2_TSUBESTACION
      ,TT2_FASES
      ,TT2_POBLACION
      ,TT2_CAPACIDAD_TRAFO
      ,TT2_UNIDAD_CONSTRUCTIVA
FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO 
                            WHERE TT2_UNIDAD_CONSTRUCTIVA IS NULL
                          );
                          
/
BEGIN
UPDATE QA_TTT2_REGISTRO SET TT2_UNIDAD_CONSTRUCTIVA='N1T43' WHERE TT2_CODIGOELEMENTO = '1T13026';
UPDATE QA_TTT2_REGISTRO SET TT2_UNIDAD_CONSTRUCTIVA='N1T16' WHERE TT2_CODIGOELEMENTO = '5T00270';
UPDATE QA_TTT2_REGISTRO SET TT2_UNIDAD_CONSTRUCTIVA='N1T27' WHERE TT2_CODIGOELEMENTO = '1T00784';
UPDATE QA_TTT2_REGISTRO SET TT2_UNIDAD_CONSTRUCTIVA='N1T27' WHERE TT2_CODIGOELEMENTO = '1T12741';
UPDATE QA_TTT2_REGISTRO SET TT2_UNIDAD_CONSTRUCTIVA='NA' WHERE TT2_CODIGOELEMENTO = '1T06765';
UPDATE QA_TTT2_REGISTRO SET TT2_UNIDAD_CONSTRUCTIVA='NA' WHERE TT2_CODIGOELEMENTO = '1T06685';
UPDATE QA_TTT2_REGISTRO SET TT2_UNIDAD_CONSTRUCTIVA='NA' WHERE TT2_CODIGOELEMENTO = '1T12869';
UPDATE QA_TTT2_REGISTRO SET TT2_UNIDAD_CONSTRUCTIVA='N1T27' WHERE TT2_CODIGOELEMENTO = '1T02041';
UPDATE QA_TTT2_REGISTRO SET TT2_UNIDAD_CONSTRUCTIVA='N1T43' WHERE TT2_CODIGOELEMENTO = '1T04374';
END;
/

COMMIT;

SELECT R.TT2_CODIGOELEMENTO
      ,R.TT2_CAPACIDAD_TRAFO AS REG
      ,T.TT2_CAPACIDAD_TRAFO AS TEMP
FROM QA_TTT2_REGISTRO R
LEFT OUTER JOIN (
                 SELECT TT2_CODIGOELEMENTO
                       ,TT2_CAPACIDAD_TRAFO
                 FROM QA_TTT2_TEMP
                 WHERE TT2_ESTADO = 'OPERACION'
                 ) T ON T.TT2_CODIGOELEMENTO=R.TT2_CODIGOELEMENTO
WHERE R.TT2_CAPACIDAD_TRAFO<>T.TT2_CAPACIDAD_TRAFO;
         


UPDATE QA_TTT2_REGISTRO R1
SET TT2_CAPACIDAD_TRAFO = (SELECT TT2_CAPACIDAD_TRAFO FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO=R1.TT2_CODIGOELEMENTO AND TT2_ESTADO='OPERACION')
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT R.TT2_CODIGOELEMENTO
                            FROM QA_TTT2_REGISTRO R
                            LEFT OUTER JOIN (
                                             SELECT TT2_CODIGOELEMENTO
                                                   ,TT2_CAPACIDAD_TRAFO
                                             FROM QA_TTT2_TEMP
                                             WHERE TT2_ESTADO = 'OPERACION'
                                             ) T ON T.TT2_CODIGOELEMENTO=R.TT2_CODIGOELEMENTO
                            WHERE R.TT2_CAPACIDAD_TRAFO<>T.TT2_CAPACIDAD_TRAFO     
                            );
         
                 
COMMIT;


            UPDATE BRAE.QA_TTT2_REGISTRO
            SET TT2_UNIDAD_CONSTRUCTIVA = (
            (CASE
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T9'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	20	THEN'N1T10'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T11'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T12'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T13'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T14'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T15'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T16'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T14'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	125	THEN'N1T15'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	200	THEN'N1T16'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T16'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T16'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T16'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T16'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T16'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T16'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1400	THEN'N1T16'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T16'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T16'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T11'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T46'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	20	THEN'N1T47'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T48'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T49'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T50'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T51'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T52'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T47'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T49'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	315	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	450	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	930	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1500	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	3000	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	2600	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1200	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	650	THEN'N1T53'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T46'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T1'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	7.5	THEN'N1T2'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T3'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T4'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T5'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T7'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T8'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T5'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T6'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T8'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T8'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T38'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	7.5	THEN'N1T39'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T40'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T41'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T42'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T44'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T45'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	3	THEN'N1T38'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T42'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T43'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T40'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T38'
            WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T17'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T18'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T19'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T20'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T21'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T22'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T23'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T24'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T25'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T26'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T20'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T26'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T26'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T26'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2500	THEN'N1T26'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	750	THEN'N1T26'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T54'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T55'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T56'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T57'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T58'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T59'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T60'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T61'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T62'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T63'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T54'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T57'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T62'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T63'
            WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T54'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T27'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T28'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T29'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T30'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T31'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T32'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T33'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T34'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T35'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T36'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T37'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T27'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T28'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	125	THEN'N1T29'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	160	THEN'N1T31'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	200	THEN'N1T31'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	240	THEN'N1T31'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	315	THEN'N1T33'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	262.5	THEN'N1T33'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	450	THEN'N1T34'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	337.5	THEN'N1T34'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	342.5	THEN'N1T34'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	412.5	THEN'N1T35'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	462.5	THEN'N1T35'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	475	THEN'N1T35'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	600	THEN'N1T35'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T36'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	525	THEN'N1T36'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	550	THEN'N1T36'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	575	THEN'N1T36'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	675	THEN'N1T36'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	750	THEN'N1T36'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	930	THEN'N1T36'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1500	THEN'N1T37'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T37'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1400	THEN'N1T37'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T37'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1630	THEN'N1T37'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2000	THEN'N1T37'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2400	THEN'N1T37'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2500	THEN'N1T37'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T64'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T65'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T66'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T67'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T68'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T69'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T70'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T71'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T72'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T73'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T74'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T64'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	160	THEN'N1T67'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T73'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	2000	THEN'N1T74'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T74'
            WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T74'
            END)
            )
            WHERE TT2_UNIDAD_CONSTRUCTIVA IS NULL;
            
            
EXEC QA_PTT2_REGISTRO(TO_DATE('01/01/2022','DD/MM/YYYY'));   


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY');

SELECT * FROM QA_TTT2_OBS;



SELECT TT2_CODIGOELEMENTO,TT2_UNIDAD_CONSTRUCTIVA, 
(CASE
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T9'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	20	THEN'N1T10'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T11'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T12'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T13'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T14'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T15'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T14'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	125	THEN'N1T15'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	200	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1400	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T16'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T11'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T46'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	20	THEN'N1T47'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T48'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T49'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T50'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T51'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T52'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T47'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T49'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	315	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	450	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	930	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1500	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	3000	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	2600	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1200	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	650	THEN'N1T53'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T46'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T1'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	7.5	THEN'N1T2'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T3'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T4'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T5'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T7'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T8'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T5'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T8'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T8'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T6'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T38'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	7.5	THEN'N1T39'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T40'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	15	THEN'N1T41'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	25	THEN'N1T42'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T44'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T45'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	3	THEN'N1T38'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T42'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	10	THEN'N1T40'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	5	THEN'N1T38'
WHEN	TT2_TSUBESTACION	=	9	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	37.5	THEN'N1T43'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T17'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T18'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T19'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T20'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T21'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T22'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T23'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T24'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T25'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T20'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2500	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	750	THEN'N1T26'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T54'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T55'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T56'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T57'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T58'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T59'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T60'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T61'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T62'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T63'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T54'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T57'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T62'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T63'
WHEN	TT2_TSUBESTACION	=	6	AND	TT2_FASES	IN	('RN','RS','RSN','RT','S','SN','SR','ST','TN','TR','TS')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	30	THEN'N1T54'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T27'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T28'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T29'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T30'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T32'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T33'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T27'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	100	THEN'N1T28'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	125	THEN'N1T29'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	160	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	200	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	240	THEN'N1T31'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	315	THEN'N1T33'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	262.5	THEN'N1T33'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	450	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	337.5	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	342.5	THEN'N1T34'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	412.5	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	462.5	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	475	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	600	THEN'N1T35'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	525	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	550	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	575	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	675	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	750	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	930	THEN'N1T36'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1500	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1400	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	1630	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2000	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2400	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'URBANO'	AND	TT2_CAPACIDAD_TRAFO	=	2500	THEN'N1T37'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	45	THEN'N1T64'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	75	THEN'N1T65'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	112.5	THEN'N1T66'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	150	THEN'N1T67'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	225	THEN'N1T68'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	250	THEN'N1T69'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	300	THEN'N1T70'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	400	THEN'N1T71'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	500	THEN'N1T72'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	630	THEN'N1T73'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1000	THEN'N1T74'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	50	THEN'N1T64'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	160	THEN'N1T67'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	800	THEN'N1T73'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	2000	THEN'N1T74'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1250	THEN'N1T74'
WHEN	TT2_TSUBESTACION	=	5	AND	TT2_FASES	IN	('RST','RSTN','RTS','SRT','STR','TRS','TSR')	AND	TT2_POBLACION	=	'RURAL'	AND	TT2_CAPACIDAD_TRAFO	=	1600	THEN'N1T74'
END) UC_PAR_LUIS
FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_OBS;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN (SELECT TT2_CODIGOELEMENTO FROM QA_TTT2_OBS);

---EJECUCION 26/01/2022

EXEC QA_PTT2_REGISTRO(TO_DATE('01/01/2022','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY');

SELECT *
        FROM                CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
            LEFT OUTER JOIN QA_TTT1_REGISTRO       TT1  ON  TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
        WHERE               COM.G3E_FNO = 20400
;


SELECT * FROM ALL_TABLES
WHERE OWNER='BRAE';

SELECT * FROM QA_TTT2_CODIGO_UC;


CREATE TABLE VAL_UC_TEMP(
UC VARCHAR2(20),
COSTO NUMBER
);

SELECT * FROM QA_TTT2_CODIGO_UC;

ALTER TABLE QA_TTT2_CODIGO_UC
ADD TT2_VALOR_UC NUMBER;


UPDATE QA_TTT2_CODIGO_UC U
SET TT2_VALOR_UC = (SELECT COSTO FROM VAL_UC_TEMP WHERE UC=U.TT2_UNIDAD_CONSTRUCTIVA);

COMMIT;

DELETE FROM QA_TTT2_CODIGO_UC
WHERE TT2_UNIDAD_CONSTRUCTIVA IN ('N1T6_');

DROP TABLE VAL_UC_TEMP;

SELECT * FROM QA_TTT2_CODIGO_UC;

SELECT * FROM QA_TTT2_REGISTRO;

--ADICION DEL CAMPO DE VALORIZACION DE LA UNIDAD CONSTRUCTIVA

ALTER TABLE QA_TTT2_REGISTRO
ADD TT2_VALOR_UC NUMBER;
         
ALTER TABLE QA_TTT2_BRAFO
ADD TT2_VALOR_UC NUMBER;

ALTER TABLE QA_TTT2_OBS
ADD TT2_VALOR_UC NUMBER;

ALTER TABLE QA_TTT2_TEMP
ADD TT2_VALOR_UC NUMBER;

ALTER TABLE QA_TTT2_BACKUP
ADD TT2_VALOR_UC NUMBER;

--ACTUALIZAR EL CAMPO TT2_VALOR_UC PARA TODOS LOS REGISTROS HASTA EL MOMENTO

SELECT * FROM QA_TTT2_REGISTRO;

UPDATE QA_TTT2_REGISTRO R
SET TT2_VALOR_UC=(SELECT TT2_VALOR_UC FROM QA_TTT2_CODIGO_UC WHERE TT2_UNIDAD_CONSTRUCTIVA=R.TT2_UNIDAD_CONSTRUCTIVA);


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_VALOR_UC =0;

COMMIT;

UPDATE QA_TTT2_REGISTRO
SET TT2_VALOR_UC=0
WHERE TT2_UNIDAD_CONSTRUCTIVA='NA';


--EJECUCION DEL PROCEDIMIENTO PARA PROBAR FUCIONAMIENTO DE VALORIZACION DE UCS

EXEC QA_PTT2_REGISTRO(TO_DATE('01/01/2022','DD/MM/YYYY'));

SELECT SUM(TT2_VALOR_UC) 
FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY')
AND   TT2_ESTADO='OPERACION'
AND   TT2_TIPOPROYECTO IN (2,4);

SELECT * FROM QA_TTT2_BRAFO
WHERE TT2_PERIODO_OP=TO_DATE('01/12/2021','DD/MM/YYYY');


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='1T12561';


SELECT * FROM QA_TTT2_REGISTRO;

ALTER TABLE QA_TTT2_REGISTRO
RENAME COLUMN TT2_CAPACIDAD_TRAFO TO TT2_CAPACIDAD;
       
ALTER TABLE QA_TTT2_BRAFO
RENAME COLUMN TT2_CAPACIDAD_TRAFO TO TT2_CAPACIDAD;

ALTER TABLE QA_TTT2_OBS
RENAME COLUMN TT2_CAPACIDAD_TRAFO TO TT2_CAPACIDAD;

ALTER TABLE QA_TTT2_TEMP
RENAME COLUMN TT2_CAPACIDAD_TRAFO TO TT2_CAPACIDAD;

ALTER TABLE QA_TTT2_BACKUP
RENAME COLUMN TT2_CAPACIDAD_TRAFO TO TT2_CAPACIDAD;


SELECT DISTINCT TT2_PERIODO_OP FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;



--EJECUCION DEL PROCEDIMIENTO PARA AJUSTES DEL MES DE ENERO 2022 - 02/02/2022

EXEC QA_PTT2_REGISTRO(TO_DATE('01/01/2022','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY')
AND TT2_TIPOPROYECTO=2
AND TT2_ESTADO='OPERACION'
AND TT2_ESTADO_BRA11='CONSTRUCCION';

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_LATITUD IS NULL;

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO = '1T04933'
AND   TT2_CODE_IUA='100J0I0101';



DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO = '1T04933'
AND   TT2_CODE_IUA='100J0I0101';

COMMIT;

UPDATE QA_TTT2_REGISTRO R
SET    TT2_LONGITUD = (SELECT DISTINCT TT2_LONGITUD FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO=R.TT2_CODIGOELEMENTO AND TT2_ESTADO IN ('OPERACION','CONSTRUCCION'))
      ,TT2_LATITUD  = (SELECT DISTINCT TT2_LATITUD  FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO=R.TT2_CODIGOELEMENTO AND TT2_ESTADO IN ('OPERACION','CONSTRUCCION'))
      

/
DECLARE
    CANTIDAD NUMBER;
BEGIN
    SELECT COUNT(*) INTO CANTIDAD
    FROM QA_TTT2_REGISTRO;
    DBMS_OUTPUT.PUT_LINE(CANTIDAD);
END;
/

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY')
AND   TT2_ESTADO='CONSTRUCCION';

desc QA_TTC1;

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='3T00320';




SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_dATE('01/01/2022','DD/MM/YYYY');


DESC QA_TTT2_REGISTRO;


ALTER TABLE QA_TTT2_REGISTRO
RENAME COLUMN TT2_TIPOPROYECTO TO TT2_TIPOINVERSION;
       
ALTER TABLE QA_TTT2_BRAFO
RENAME COLUMN TT2_TIPOPROYECTO TO TT2_TIPOINVERSION;

ALTER TABLE QA_TTT2_OBS
RENAME COLUMN TT2_TIPOPROYECTO TO TT2_TIPOINVERSION;

ALTER TABLE QA_TTT2_TEMP
RENAME COLUMN TT2_TIPOPROYECTO TO TT2_TIPOINVERSION;

ALTER TABLE QA_TTT2_BACKUP
RENAME COLUMN TT2_TIPOPROYECTO TO TT2_TIPOINVERSION;

----AGREGAR CAMPO

ALTER TABLE QA_TTT2_REGISTRO
ADD TT2_OBSERVACIONES VARCHAR2(400);
       
ALTER TABLE QA_TTT2_BRAFO
ADD TT2_OBSERVACIONES VARCHAR2(400);

ALTER TABLE QA_TTT2_OBS
ADD TT2_OBSERVACIONES VARCHAR2(400);

ALTER TABLE QA_TTT2_TEMP
ADD TT2_OBSERVACIONES VARCHAR2(400);

ALTER TABLE QA_TTT2_BACKUP
ADD TT2_OBSERVACIONES VARCHAR2(400);

---GENEARCION DEL REPORTE BRA11

SELECT   TT2_CODIGOPROYECTO
        ,TT2_IUL
        ,(CASE WHEN(TT2_ESTADO_BRA11<>'CONSTRUCCION') THEN(TT2_CODE_IUA) ELSE(NULL)  END) AS TT2_CODE_IUA
        ,(CASE WHEN(TT2_ESTADO_BRA11 ='CONSTRUCCION') THEN(TT2_CODE_IUA) ELSE(NULL)  END) AS TT2_CODE_IUA_PRO
        ,TT2_UNIDAD_CONSTRUCTIVA
        ,TT2_RPP
        ,TT2_SALINIDAD
        ,TT2_TIPOINVERSION
        ,TT2_OBSERVACIONES
        ,TO_CHAR(TT2_FESTADO,'YYYY') AS TT2_FESTADO
        ,TT2_REMUNERACION_PENDIENTE
        ,(CASE WHEN(TT2_ESTADO_BRA11 = 'OPERACION'   ) THEN(2)
               WHEN(TT2_ESTADO_BRA11 = 'RETIRADO'    ) THEN(3)
               WHEN(TT2_ESTADO_BRA11 = 'CONSTRUCCION') THEN(1)
          END)   AS TT2_ESTADO_BRA11
        ,TT2_RESMETODOLOGIA
        ,(CASE WHEN(TT2_ALTERNATIVA_VALORACION='BRAEN') THEN(6) 
               WHEN(TT2_ALTERNATIVA_VALORACION='BRAFO') THEN(3)
               WHEN(TT2_ALTERNATIVA_VALORACION='INVA' ) THEN(5) 
          END) AS TT2_ALTERNATIVA_VALORACION
        ,TT2_ID_PLAN
        ,(CASE WHEN(TT2_ESTADO_BRA11 = 'OPERACION'   ) THEN(1)
               WHEN(TT2_ESTADO_BRA11 = 'RETIRADO'    ) THEN(1)
               WHEN(TT2_ESTADO_BRA11 = 'CONSTRUCCION') THEN(0)
          END) AS TT2_CANTIDAD_REPOSICIONES
        ,TT2_IDMERCADO
FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/02/2022','DD/MM/YYYY');

--GENEARCION DEL FORMATO TT2
SELECT TT2_CODE_IUA
      ,TT2_GRUPOCALIDAD
      ,TT2_IDMERCADO
      ,TT2_CAPACIDAD_TRAFO
      ,TT2_PROPIEDAD
      ,TT2_TSUBESTACION
      ,LPAD(TT2_LONGITUD,10) AS TT2_LONGITUD
      ,LPAD(TT2_LATITUD,10) AS TT2_LATITUD
      ,TRUNC(TT2_ALTITUD,0)
      ,TT2_ESTADO
      ,TO_CHAR(TT2_FESTADO,'DD-MM-YYYY')
      ,TT2_RESMETODOLOGIA
FROM QA_TTT2_REPORTE
WHERE TT2_PERIODO_OP =  TO_DATE(:PERIODO,'DD/MM/YYYY')
;

SELECT * FROM QA_TTT2_REPORTE;

---------------------------------------------------------------------------------------------
SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='3T00222'
;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ALTITUD IS NULL;

        SELECT * 
        --BULK  COLLECT INTO V_QA_TTT2_REGISTRO
        FROM  QA_TTT2_REGISTRO
        WHERE TO_CHAR(TT2_PERIODO_OP,'DD/MM/YYYY') ='01/01/2022'
        --WHERE TT2_PERIODO_OP = FECHAOPERACION
        AND(	TT2_GRUPOCALIDAD	    IS NULL
            OR	TT2_IDMERCADO	        IS NULL
            OR	TT2_CAPACIDAD    	    IS NULL
            OR	TT2_PROPIEDAD	        IS NULL
            OR	TT2_TSUBESTACION	    IS NULL
            OR	TT2_LONGITUD	        IS NULL
            OR	TT2_LATITUD	            IS NULL
            OR	TT2_ALTITUD	            IS NULL
            OR	TT2_ESTADO	            IS NULL
            OR	TT2_ESTADO_BRA11	    IS NULL
            OR	TT2_NOMBRE_CIRCUITO	    IS NULL
            OR	TT2_IUL	                IS NULL
            );
        AND TT2_CODE_IUA                IS NULL;
        
        
        
        SELECT * 
        --BULK  COLLECT INTO V_QA_TTT2_REGISTRO
        FROM  QA_TTT2_REGISTRO
        WHERE TO_CHAR(TT2_PERIODO_OP,'DD/MM/YYYY') ='01/01/2022'
        --WHERE TT2_PERIODO_OP = FECHAOPERACION
        AND(TT2_ALTITUD	            IS NULL)
        AND TT2_CODE_IUA                IS NULL;
        
        
        SELECT * FROM QA_TTT2_OBS;
        
        
        UPDATE QA_TTT2_REGISTRO
        SET TT2_ESTADOREPORTE=0
        WHERE TT2_ESTADO='CONSTRUCCION';
      ALTER  
--COMMIT;        
UPDATE QA_TTT2_REGISTRO
SET TT2_ALTITUD=1202
WHERE TT2_CODIGOELEMENTO='3T00222'
AND TT2_ALTITUD IS NULL;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='3T00222';
--COMMIT;
  
SELECT * FROM QA_TTT2_REGISTRO
WHERE MOD(TT2_ALTITUD,1)<> 0
;  



SELECT MOD(12,5) FROM DUAL;
        
SELECT CODE,MUNICIPIO FROM SPARD.TRANSFOR;        

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY')
AND TT2_TIPOINVERSION IN (2,4);

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;


UPDATE QA_TTT2_REGISTRO
SET        TT2_ESTADOREPORTE = 1
WHERE      TT2_ESTADOREPORTE = 0;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;

COMMIT;

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_PROPIEDAD <> 0;

SELECT DISTINCT TT2_CODIGOELEMENTO 
FROM QA_TTT2_REGISTRO
WHERE TT2_PROPIEDAD = 0;
;


UPDATE QA_TTT2_REGISTRO R
SET TT2_PROPIEDAD = (
                    SELECT DISTINCT     CPRO.PROPIETARIO_1
                    FROM                CCONECTIVIDAD_E@GTECH  CON
                        LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
                        LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
                    WHERE               COM.G3E_FNO = 20400
                    AND CON.NODO_TRANSFORM_V = R.TT2_CODIGOELEMENTO
                    AND COM.ESTADO = 'OPERACION'
                    )
;
--22470


SELECT CON.NODO_TRANSFORM_V,CPRO.PROPIETARIO_1
FROM                CCONECTIVIDAD_E@GTECH  CON
    LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
    LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
WHERE               COM.G3E_FNO = 20400
AND COM.ESTADO = 'OPERACION'
;

CREATE TABLE QA_TEMP(
ELEMENTO  VARCHAR2(20),
PROPIEDAD VARCHAR2(20)
);


DELETE FROM QA_TEMP;
COMMIT;


SELECT * FROM QA_TEMP;

UPDATE QA_TTT2_REGISTRO R
SET TT2_PROPIEDAD = (SELECT PROPIEDAD FROM QA_TEMP WHERE ELEMENTO= R.TT2_CODIGOELEMENTO);

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PROPIEDAD IS NULL;

DROP TABLE QA_TEMP;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY');


SELECT * FROM QA_TTT2_REGISTRO;

SELECT * FROM QA_TFDDREPORTE
WHERE FDR_CODIGOEVENTO <>'NA';

SELECT DISTINCT TT2_PERIODO_OP FROM QA_TTT2_REPORTE;

SELECT * FROM QA_TTT2_REPORTE WHERE TT2_CODE_IUA='100IZG009B'; --554670  Filas --577185  Filas

SELECT DISTINCT TT2_PERIODO_OP FROM QA_TTT2_REPORTE ORDER BY 1;





--GENEARCION DEL FORMATO TT2 ENERO 2022 E INSERSION A TABLA QA_TTT2_REPORTE
INSERT INTO QA_TTT2_REPORTE
SELECT TO_DATE('01/01/2022','DD/MM/YYYY') AS TT2_PERIODO_OP
      ,TT2_CODIGOELEMENTO 
      ,TT2_CODE_IUA
      ,TO_NUMBER(TT2_GRUPOCALIDAD) AS TT2_GRUPOCALIDAD
      ,TO_NUMBER(TT2_IDMERCADO) AS TT2_IDMERCADO
      ,TT2_CAPACIDAD
      ,(CASE WHEN TT2_PROPIEDAD ='CENS'
             THEN 1
             ELSE 2
        END) AS TT2_PROPIEDAD
      ,TT2_TSUBESTACION
      ,TT2_LONGITUD
      ,TT2_LATITUD
      ,TT2_ALTITUD
      ,(CASE WHEN(TT2_ESTADO='OPERACION')    THEN(2) 
             WHEN(TT2_ESTADO='RETIRADO' )    THEN(3)
             WHEN(TT2_ESTADO='CONSTRUCCION') THEN(2)
        END)AS TT2_ESTADO
      ,TT2_FESTADO
      ,TT2_RESMETODOLOGIA
FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO NOT IN(SELECT DISTINCT TT2_CODIGOELEMENTO 
                                FROM QA_TTT2_REGISTRO
                                WHERE   TT2_ESTADO='CONSTRUCCION')
;

SELECT DISTINCT TT2_PERIODO_OP FROM QA_TTT2_REPORTE ORDER BY 1;

SELECT * FROM QA_TTT2_REPORTE WHERE TT2_PERIODO_OP='01/01/2022';
--COMMIT;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO = 'CONSTRUCCION';

SELECT * FROM QA_TFDDREFERENCIA;

ALTER TABLE QA_TFDDREFERENCIA
ADD FDD_CONSUMO NUMBER DEFAULT 0;

ALTER TABLE QA_TFDDREFERENCIA
DROP COLUMN FDD_TIPOCONEXION;

ALTER TABLE QA_TFDDREFERENCIA
DROP COLUMN FDD_CANTIDAD_USRS;

ALTER TABLE QA_TFDDREFERENCIA
ADD  FDD_CANTIDAD_USRS NUMBER DEFAULT 0;

DESC QA_TFDDREFERENCIA;


--GENERACION DE FORMATO TT2 FEB 2022

EXEC QA_PTT2_REGISTRO(TO_DATE('01/02/2022','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO;

SELECT * FROM QA_TFDDREFERENCIA
WHERE FDD_PERIODO_OP=TO_DATE('01/02/2022','DD/MM/YYYY');

SELECT * FROM QA_TTT2_OBS;

SELECT CODE, FPARENT FROM SPARD.TRANSFOR;
SELECT * FROM QA_TMUNDANE;

DELETE FROM QA_TTC1_TEMP;
--COMMIT ;

DESC QA_TTC1;

SELECT * FROM QA_TTT2_REGISTRO;
/
DECLARE
BEGIN
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005374' WHERE TT2_CODIGOELEMENTO='3T00226';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005208' WHERE TT2_CODIGOELEMENTO='3T00289';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005324' WHERE TT2_CODIGOELEMENTO='3T00205';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000002304' WHERE TT2_CODIGOELEMENTO='1T01556';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000003780' WHERE TT2_CODIGOELEMENTO='4T00009';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005853' WHERE TT2_CODIGOELEMENTO='5T01711';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000003824' WHERE TT2_CODIGOELEMENTO='4T00688';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000004656' WHERE TT2_CODIGOELEMENTO='2T00205';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005169' WHERE TT2_CODIGOELEMENTO='3T00321';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000004091' WHERE TT2_CODIGOELEMENTO='1T04766';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000002069' WHERE TT2_CODIGOELEMENTO='1T01072';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000002780' WHERE TT2_CODIGOELEMENTO='1T07142';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005361' WHERE TT2_CODIGOELEMENTO='3T00225';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000000172' WHERE TT2_CODIGOELEMENTO='1T07655';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000000887' WHERE TT2_CODIGOELEMENTO='1T00278';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005333' WHERE TT2_CODIGOELEMENTO='3T00222';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005313' WHERE TT2_CODIGOELEMENTO='3T00227';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005017' WHERE TT2_CODIGOELEMENTO='3T01879';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005648' WHERE TT2_CODIGOELEMENTO='3T02023';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000002399' WHERE TT2_CODIGOELEMENTO='1T00462';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005077' WHERE TT2_CODIGOELEMENTO='3T01950';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000001806' WHERE TT2_CODIGOELEMENTO='1T01401';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000003483' WHERE TT2_CODIGOELEMENTO='1T02766';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000005206' WHERE TT2_CODIGOELEMENTO='3T00995';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000001389' WHERE TT2_CODIGOELEMENTO='1T07435';
END;
/
COMMIT;

SELECT * FROM QA_TTT2_REGISTRO WHERE TT2_CODIGOELEMENTO='1T07435';
COMMIT;



SELECT TT2_CODIGOELEMENTO,TT2_CODE_CALP 
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_CALP<>'0';

SELECT * FROM ALL_TABLES
WHERE OWNER='BRAE'
AND TABLE_NAME LIKE 'QA_TTT2%';

SELECT * FROM QA_TTT2_CODIGO_UC;


SELECT QA_FBASE_CONV((MAX_CONSECUTIVO_IUA) FROM DUAL;

        SELECT MAX(TO_NUMBER(QA_FBASE_CONV(SUBSTR(TT2_CODE_IUA,2,5),36,10))) AS MAX_CONSEC
        --INTO MAX_CONSECUTIVO_IUA
        FROM BRAE.QA_TTT2_REGISTRO
        WHERE TT2_CODE_IUA IS NOT NULL;
        
--INSERT INTO QA_TTT2_REGISTRO        
SELECT TT2_CODIGOELEMENTO
,   TT2_CODE_IUA
,	TT2_GRUPOCALIDAD
,	TT2_IDMERCADO
,	TT2_CAPACIDAD
,	TT2_PROPIEDAD
,	TT2_TSUBESTACION
,	TT2_LONGITUD
,	TT2_LATITUD
,	TT2_ALTITUD
,	TT2_ESTADO
,	TT2_ESTADO_BRA11
,	TT2_RESMETODOLOGIA
,	TT2_CLASS_CARGA
,	TT2_NOMBRE_CIRCUITO
,	TT2_IUL
,	TT2_CODIGOPROYECTO
,	TT2_UNIDAD_CONSTRUCTIVA
,	TT2_RPP
,	TT2_SALINIDAD
,	TT2_TIPOINVERSION
,	TT2_REMUNERACION_PENDIENTE
,	TT2_ALTERNATIVA_VALORACION
,	TT2_ID_PLAN
,	TT2_CANTIDAD_REPOSICIONES
,	TT2_FESTADO
,	TT2_FCOLOCACION
,	TT2_FMODIFICACION
,	TT2_USR_COLOCACION
,	TT2_USR_MODFICACION
,	TT2_PERIODO_OP
,	TT2_ESTADOREPORTE
,	TT2_FSISTEMA
,	TT2_ACTIVOCONEXION
,	TT2_ACTIVOPROVISIONAL
,	TT2_AP_POTENCIA
,	TT2_CODE_CALP
,	TT2_FASES
,	TT2_POBLACION
,	TT2_VALOR_UC
,	TT2_OBSERVACIONES
FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO LIKE 'XT%';

SELECT * 
FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO LIKE 'XT%';


UPDATE QA_TTT2_REGISTRO
SET TT2_CODE_IUA='100J79009Z'
WHERE TT2_CODIGOELEMENTO LIKE 'XT%';

--COMMIT;




--GENEARCION DEL FORMATO TT2 FEBRERO 2022 E INSERSION A TABLA QA_TTT2_REPORTE
--INSERT INTO QA_TTT2_REPORTE
SELECT TO_DATE('01/02/2022','DD/MM/YYYY') AS TT2_PERIODO_OP
      ,TT2_CODIGOELEMENTO 
      ,TT2_CODE_IUA
      ,TO_NUMBER(TT2_GRUPOCALIDAD) AS TT2_GRUPOCALIDAD
      ,TO_NUMBER(TT2_IDMERCADO) AS TT2_IDMERCADO
      ,TT2_CAPACIDAD
      ,(CASE WHEN TT2_PROPIEDAD ='CENS'
             THEN 1
             ELSE 2
        END) AS TT2_PROPIEDAD
      ,TT2_TSUBESTACION
      ,TT2_LONGITUD
      ,TT2_LATITUD
      ,TT2_ALTITUD
      ,(CASE WHEN(TT2_ESTADO='OPERACION')    THEN(2) 
             WHEN(TT2_ESTADO='RETIRADO' )    THEN(3)
             WHEN(TT2_ESTADO='CONSTRUCCION') THEN(2)
        END)AS TT2_ESTADO
      ,TT2_FESTADO
      ,TT2_RESMETODOLOGIA
FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO NOT IN(SELECT DISTINCT TT2_CODIGOELEMENTO 
                                FROM QA_TTT2_REGISTRO
                                WHERE   TT2_ESTADO='CONSTRUCCION')
;


SELECT TO_DATE('01/02/2022','DD/MM/YYYY') AS TT2_PERIODO_OP
      ,TT2_CODIGOELEMENTO 
      ,TT2_CODE_IUA
      ,TO_NUMBER(TT2_GRUPOCALIDAD) AS TT2_GRUPOCALIDAD
      ,TO_NUMBER(TT2_IDMERCADO) AS TT2_IDMERCADO
      ,TT2_CAPACIDAD
      ,(CASE WHEN TT2_PROPIEDAD ='CENS'
             THEN 1
             ELSE 2
        END) AS TT2_PROPIEDAD
      ,TT2_TSUBESTACION
      ,TT2_LONGITUD
      ,TT2_LATITUD
      ,TT2_ALTITUD
      ,(CASE WHEN(TT2_ESTADO='OPERACION')    THEN(2) 
             WHEN(TT2_ESTADO='RETIRADO' )    THEN(3)
             WHEN(TT2_ESTADO='CONSTRUCCION') THEN(2)
        END)AS TT2_ESTADO
      ,TT2_FESTADO
      ,TT2_RESMETODOLOGIA
FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO <> 'CONSTRUCCION'
;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;


SELECT * FROM QA_TTT2_REPORTE
WHERE TT2_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY')
AND TT2_ESTADO=2;

--22405  Filas


EXEC QA_PTT2_REPORTE(TO_DATE('01/02/2022','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REPORTE
WHERE TT2_PERIODO_OP=TO_DATE('01/02/2022','DD/MM/YYYY');




--GENEARCION DEL FORMATO TT2 FEBRERO 2022

SELECT TT2_CODE_IUA
      ,TT2_GRUPOCALIDAD
      ,TT2_IDMERCADO
      ,TT2_CAPACIDAD_TRAFO
      ,TT2_PROPIEDAD
      ,TT2_TSUBESTACION
      ,LPAD(TT2_LONGITUD,10) AS TT2_LONGITUD
      ,LPAD(TT2_LATITUD,10) AS TT2_LATITUD
      ,TT2_LATITUD AS CCC
      ,TRUNC(TT2_ALTITUD,0)
      ,TT2_ESTADO
      ,TO_CHAR(TT2_FESTADO,'DD-MM-YYYY')
      ,TT2_RESMETODOLOGIA
FROM QA_TTT2_REPORTE
WHERE TT2_PERIODO_OP =  TO_DATE(:PERIODO,'DD/MM/YYYY')
;


SELECT TO_CHAR(10000,'L99G999D99MI',
               'NLS_NUMERIC_CHARACTERS = ''.,''
               NLS_CURRENCY = ''$''') "Amount"
           FROM DUAL;

SELECT DISTINCT TC1_PERIODO, TC1_IDCOMER FROM QA_TTC1
WHERE TC1_CODFRONCOM LIKE 'Frt33173'
ORDER BY 1;


SELECT TT2_CODIGOELEMENTO,TT2_FCOLOCACION,TT2_FMODIFICACION FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN ('5T03005','5T03006');

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_TEMP
                            MINUS
                            SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO);



SELECT * FROM QA_TCS3;

CREATE TABLE QA_TCS3_TEST AS
SELECT * FROM QA_TCS3;


SELECT * FROM QA_TCS3_TEST;


/
BEGIN
--DELETE FROM QA_TCS3_TEST;
QA_PCS3_TEST(TO_DATE('01/01/2022','DD/MM/YYYY'));
END;
/


SELECT  CS3_INCD1 AS INCDj1t,
        CS3_INCD2 AS INCDj2t,
        CS3_INCD3 AS INCDj3t,
        CS3_INCF1 AS INCFj1t,
        CS3_INCF2 AS INCFj2t,
        CS3_INCF3 AS INCFj3t,
        CS3_IC_SAIDI AS IC_SAIDIjt,
        CS3_IC_SAIFI AS IC_SAIFIjt,
        CS3_IF_SAIFI AS If_SAIFIjt,
        CS3_IF_SAIDI AS If_SAIDIjt,
        CS3_IV_SAIFI AS Iv_SAIFIjt,
        CS3_IV_SAIDI AS Iv_SAIDIjt
FROM QA_TCS3_TEST
WHERE CS3_PERIODO_OP=TRUNC(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'))
;


SELECT * FROM QA_TCBRAEN;
SELECT * FROM QA_TCS3;

--SOLO RESOLUCION ANTERIOR
UPDATE QA_TCBRAEN_TEST
SET CB_PERIODO=20213
WHERE CB_PERIODO=2021;
COMMIT;

SELE FROM QA_TCS3;
--COMMIT;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;


UPDATE QA_TTT2_REGISTRO
SET   TT2_ESTADOREPORTE=1
WHERE TT2_ESTADOREPORTE=0;
COMMIT;



SELECT *
--INTO MAX_CONSECUTIVO_CALP
FROM BRAE.QA_TTT2_REGISTRO
WHERE TT2_CODE_CALP LIKE 'CALP%';

desc QA_TTT2_REGISTRO;

SELECT DISTINCT TT2_TIPOINVERSION FROM QA_TTT2_BRAFO;


SELECT COUNT(*) FROM QA_TFDDREFERENCIA
WHERE FDD_PERIODO_OP=TO_DATE('01/02/2022','DD/MM/YYYY');

SELECT COUNT(*) FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='OPERACION';

SELECT * FROM QA_TFDDREFERENCIA;



SELECT TT2_CODE_CALP
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_CALP LIKE 'CALP%'
AND TT2_ESTADO='OPERACION'
MINUS
SELECT DISTINCT TC1_TC1 
FROM QA_TTC1
WHERE TC1_TC1 LIKE 'CALP%'
AND   TC1_PERIODO = 202202
;




SELECT DISTINCT TC1_CODCONEX,TC1_TC1 
FROM QA_TTC1
WHERE TC1_TC1 LIKE 'CALP%'
AND   TC1_PERIODO = 202202
MINUS
SELECT TT2_CODIGOELEMENTO,TT2_CODE_CALP
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_CALP LIKE 'CALP%'
AND TT2_ESTADO='OPERACION'
;




SELECT TT2_CODIGOELEMENTO,TT2_CODE_CALP
FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_CALP LIKE 'CALP%'
AND TT2_ESTADO='OPERACION'
MINUS
SELECT DISTINCT TC1_CODCONEX,TC1_TC1 
FROM QA_TTC1
WHERE TC1_TC1 LIKE 'CALP%'
AND   TC1_PERIODO = 202202
;



---------------------------------------------------GENERACION TT2_MAR_2022_OR_604

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE = 0; --ZERO REGISTER

EXEC QA_PTT2_REGISTRO(TO_DATE('01/03/2022','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='XT00001';

DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='XT00001';
--COMMIT;

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO='3T00363';

SELECT * FROM SPARD.TRANSFOR
WHERE CODE='3T00363';

DELETE FROM QA_TTC1_TEMP;

COMMIT;

DESC QA_TTC1;


SELECT * FROM QA_TTC1_TEMP;

SELECT * FROM QA_TTT2_REPORTE
WHERE TT2_PERIODO_OP=TO_DATE('01/03/2022','DD/MM/YYYY');

SELECT CODE,FPARENT FROM SPARD.TRANSFOR; 

SELECT CODE, MUNICIPIO FROM SPARD.TRANSFOR;



SELECT CODE,POBLACION FROM SPARD.TRANSFOR;

--SE AGREGA ELEMENTO PARA LA INCLUSION DE USUARIOS TEMPORALES EN FORMATO TC2--------------------------------------------------------------------------
INSERT INTO QA_TTT2_REGISTRO
SELECT 'XT00001'	TT2_CODIGOELEMENTO
,	TT2_CODE_IUA
,	TT2_GRUPOCALIDAD
,	TT2_IDMERCADO
,	TT2_CAPACIDAD
,	TT2_PROPIEDAD
,	TT2_TSUBESTACION
,	TT2_LONGITUD
,	TT2_LATITUD
,	TT2_ALTITUD
,	TT2_ESTADO
,	TT2_ESTADO_BRA11
,	TT2_RESMETODOLOGIA
,	TT2_CLASS_CARGA
,	TT2_NOMBRE_CIRCUITO
,	TT2_IUL
,	TT2_CODIGOPROYECTO
,	TT2_UNIDAD_CONSTRUCTIVA
,	TT2_RPP
,	TT2_SALINIDAD
,	TT2_TIPOINVERSION
,	TT2_REMUNERACION_PENDIENTE
,	TT2_ALTERNATIVA_VALORACION
,	TT2_ID_PLAN
,	TT2_CANTIDAD_REPOSICIONES
,	TT2_FESTADO
,	TT2_FCOLOCACION
,	TT2_FMODIFICACION
,	TT2_USR_COLOCACION
,	TT2_USR_MODFICACION
,	TT2_PERIODO_OP
,	TT2_ESTADOREPORTE
,	TT2_FSISTEMA
,	TT2_ACTIVOCONEXION
,	TT2_ACTIVOPROVISIONAL
,	TT2_AP_POTENCIA
,	TT2_CODE_CALP
,	TT2_FASES
,	TT2_POBLACION
,	TT2_VALOR_UC
,	TT2_OBSERVACIONES 
FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP = TO_DATE('01/03/2022','DD/MM/YYYY')
AND   TT2_ESTADO = 'OPERACION'
AND   TT2_TIPOINVERSION= '2'
AND   TT2_PROPIEDAD = 'CENS'
AND   TT2_CODIGOELEMENTO = '1T13270';

DESC QA_TTT2_REGISTRO;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO = 'XT00001';

SELECT MAX(TO_NUMBER(QA_FBASE_CONV(SUBSTR(TT2_CODE_IUA,2,5),36,10))) AS MAX_CONSEC
--INTO MAX_CONSECUTIVO_IUA
FROM  BRAE.QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA IS NOT NULL;


UPDATE BRAE.QA_TTT2_REGISTRO
SET   TT2_CODE_IUA        =  '1'|| LPAD(QA_FBASE_CONV((24941),10,36),5,0)||'0090'
WHERE TT2_CODIGOELEMENTO  = 'XT00001'
;
--100J820090        

COMMIT;

----------------------------------------------------------------------------------------------


SELECT MAX(TT2_FSISTEMA) FROM QA_TTT2_REGISTRO;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('3T00226'
,'3T00289'
,'3T00205'
,'1T01556'
,'4T00009'
,'5T01711'
,'4T00688'
,'2T00205'
,'3T00321'
,'1T04766'
,'1T01072'
,'1T07142'
,'3T00225'
,'1T07655'
,'1T00278'
,'3T00222'
,'3T00227'
,'3T01879'
,'3T02023'
,'1T00462'
,'3T01950'
,'1T01401'
,'1T02766'
,'3T00995'
,'1T07435');


SELECT * FROM QA_TTT2_TEMP
WHERE TT2_AP_POTENCIA>0
AND TT2_ESTADO='OPERACION';--6503  Filas

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_AP_POTENCIA>0
AND TT2_ESTADO='OPERACION';--6503  Filas

/
BEGIN
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006959' WHERE TT2_CODIGOELEMENTO='3T00226';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006960' WHERE TT2_CODIGOELEMENTO='3T00289';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006971' WHERE TT2_CODIGOELEMENTO='3T00205';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006972' WHERE TT2_CODIGOELEMENTO='1T01556';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006966' WHERE TT2_CODIGOELEMENTO='4T00009';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006967' WHERE TT2_CODIGOELEMENTO='5T01711';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006961' WHERE TT2_CODIGOELEMENTO='4T00688';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006949' WHERE TT2_CODIGOELEMENTO='2T00205';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006968' WHERE TT2_CODIGOELEMENTO='3T00321';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006964' WHERE TT2_CODIGOELEMENTO='1T04766';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006962' WHERE TT2_CODIGOELEMENTO='1T01072';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006969' WHERE TT2_CODIGOELEMENTO='1T07142';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006950' WHERE TT2_CODIGOELEMENTO='3T00225';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006947' WHERE TT2_CODIGOELEMENTO='1T07655';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006951' WHERE TT2_CODIGOELEMENTO='1T00278';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006954' WHERE TT2_CODIGOELEMENTO='3T00222';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006970' WHERE TT2_CODIGOELEMENTO='3T00227';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006965' WHERE TT2_CODIGOELEMENTO='3T01879';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006948' WHERE TT2_CODIGOELEMENTO='3T02023';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006955' WHERE TT2_CODIGOELEMENTO='1T00462';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000006953' WHERE TT2_CODIGOELEMENTO='3T01950';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000007060' WHERE TT2_CODIGOELEMENTO='1T01401';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000007062' WHERE TT2_CODIGOELEMENTO='1T02766';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000007064' WHERE TT2_CODIGOELEMENTO='3T00995';
UPDATE QA_TTT2_REGISTRO SET TT2_CODE_CALP='CALP000007061' WHERE TT2_CODIGOELEMENTO='1T07435';
END;
/


COMMIT;

SELECT * FROM QA_TTT2_REGISTRO;

SELECT * FROM OMS.INTERUPC
LEFT OUTER JOIN OMS.MANIOBRAS ON CODE=MINICIAL
WHERE TRAFO IN ('1T11425','1T12607')
AND   TO_CHAR(FINICIAL,'MMYYYY')='032022'
AND CAUSA<>'PRUEBA'
AND TYPEEQUIP='Transformer';


UPDATE QA_TTT2_REGISTRO
SET TT2_CODE_CALP='0',
    TT2_AP_POTENCIA=0
WHERE TT2_CODIGOELEMENTO IN ('1T11425','1T12607');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('1T11425','1T12607');

COMMIT;


SELECT CODE, ADDRESS FROM SPARD.TRANSFOR;


SELECT * FROM QA_TTT2_REGISTRO;

commit;

---------------------------------------generacion de TT2 MARZO 2022 

EXEC QA_PTT2_REPORTE(TO_DATE('01/03/2022','DD/MM/YYYY'));

SELECT TT2_CODE_IUA
      ,TT2_GRUPOCALIDAD
      ,TT2_IDMERCADO
      ,TT2_CAPACIDAD_TRAFO
      ,TT2_PROPIEDAD
      ,TT2_TSUBESTACION
      ,LPAD(TT2_LONGITUD,10) AS TT2_LONGITUD
      ,LPAD(TT2_LATITUD,8) AS TT2_LATITUD
      ,TRUNC(TT2_ALTITUD,0)
      ,TT2_ESTADO
      ,TO_CHAR(TT2_FESTADO,'DD-MM-YYYY')
      ,TT2_RESMETODOLOGIA
FROM QA_TTT2_REPORTE
WHERE TT2_PERIODO_OP =  TO_DATE(:PERIODO,'DD/MM/YYYY')
--AND TT2_CODE_IUA='100IXI0107';
;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='CONSTRUCCION';



SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;

SELECT * FROM QA_TTT2_REPORTE
WHERE TT2_PERIODO_OP= TO_DATE(:PERIODO,'DD/MM/YYYY')
;

COMMIT;


SELECT * FROM OMS.INTERUPC
WHERE TRAFO IN ('1T13205'
,'1T13206'
,'1T13207'
,'1T13208')
AND TO_CHAR(FINICIAL,'MM/YYYY')='03/2022';

SELECT * FROM QA_TFDDREGISTRO
WHERE FDD_CODIGOELEMENTO IN ('1T13205'
,'1T13206'
,'1T13207'
,'1T13208');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO LIKE 'XT%';


--SCRIPT QUE DETECTA LOS ACTIVOS QUE ESTAN SIENDO MODIFICADOS
--Script that detects the assets that are being modified

SELECT * 
--SELECT DISTINCT CODIGO_OPERATIVO
FROM B$CCOMUN@GTECH
WHERE LTT_ID IN (SELECT LTT_ID FROM LTT_IDENTIFIERS@GTECH)
AND G3E_FNO=20400 
AND EMPRESA_ORIGEN='CENS'
;
/*
1T04702
4T01100
2T02472
*/
SELECT * FROM QA_TTT2_BACKUP;
SELECT * FROM QA_TTT2_REGISTRO;


DELETE FROM QA_TTT2_BACKUP;
--COMMIT;

INSERT INTO QA_TTT2_BACKUP
SELECT * FROM QA_TTT2_REGISTRO;
--COMMIT;

SELECT * FROM QA_tTT2_BACKUP;


EXEC QA_PTT2_REGISTRO(TO_DATE('01/04/2022','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO LIKE 'XT%';

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/04/2022','DD/MM/YYYY');

SELECT COUNT(*) 
FROM QA_TTC1
WHERE TC1_PERIODO=TO_NUMBER(TO_CHAR(TO_DATE(:PERIODO,'DD/MM/YYYY'),'YYYYMM'));

EXEC QA_PFDDPRELIMINAR_AJ(TO_DATE('01/04/2022','DD/MM/YYYY'));


/
DECLARE
  CANT_REG_TC1    NUMBER;
BEGIN
  SELECT QA_PFDDPRELIMINAR_AJ(TO_DATE('01/04/2022','DD/MM/YYYY'),CANT_REG_TC1)  
  DBMS_OUTPUT.PUT_LINE('Cantidad de registros TC1 es: '||CANT_REG_TC1);
END;
/
--Se define en acuerdo con la persona encargada del FRONTEND realizar esa validacion en la capa de presentacion


--verificacion en la asignacion de CODIGOS CALPS

  DELETE FROM QA_TTT2_TEMP;
  COMMIT;


INSERT INTO QA_TTT2_TEMP
       WITH INFO_AP AS 
        (SELECT  SUBSTR(CON.NODO_TRANSFORM_V,1,20) AS NODO_TRANSFORM_V,SUM(LUM.POTENCIA) AS POTENCIA_INSTALADA
         FROM CCONECTIVIDAD_E@GTECH CON
         JOIN CCOMUN@GTECH COM ON CON.G3E_FID=COM.G3E_FID
         JOIN ELUMINAR_AT@GTECH LUM ON  LUM.G3E_FID = CON.G3E_FID
         WHERE CON.G3E_FNO = 21400
         GROUP BY CON.NODO_TRANSFORM_V)
            
        SELECT SUBSTR(CON.NODO_TRANSFORM_V,1,20)          AS TT2_CODIGOELEMENTO
            ,NULL                                         AS TT2_CODE_IUA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(COM.GRUPO_CALIDAD,1,2)                AS TT2_GRUPOCALIDAD
            ,SUBSTR(COM.ID_MERCADO,1,20)                  AS TT2_IDMERCADO
            ,TO_NUMBER(CON.CAPACIDAD_NOMINAL)             AS TT2_CAPACIDAD_TRAFO
            ,SUBSTR(CPRO.PROPIETARIO_1,1,20)              AS TT2_PROPIEDAD
            ,TO_NUMBER(ET.TIPO_SUBESTACION)               AS TT2_TSUBESTACION
            ,TO_NUMBER(COM.COOR_GPS_LON)                  AS TT2_LONGITUD
            ,TO_NUMBER(COM.COOR_GPS_LAT)                  AS TT2_LATITUD
            ,TO_NUMBER(COM.COOR_Z)                        AS TT2_ALTITUD
            ,SUBSTR(COM.ESTADO,1,20)                      AS TT2_ESTADO
            ,(CASE WHEN(ET.PROVISIONAL = 'SI') 
                   THEN('CONSTRUCCION'       ) 
                   ELSE(COM.ESTADO           ) 
              END)                                        AS TT2_ESTADO_BRA11
            ,'CREG 015'                                   AS TT2_RESMETODOLOGIA
            ,NULL                                         AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(CON.CIRCUITO,1,20)                    AS TT2_NOMBRE_CIRCUITO
            ,SUBSTR(TT1.TT1_CODIGOCIRCUITO,1,5)           AS TT2_IUL
            ,NULL                                         AS TT2_CODIGOPROYECTO --INDEFINIDO
            ,NULL                                         AS TT2_UNIDAD_CONSTRUCTIVA
            ,DECODE(CPRO.PROPIETARIO_1,'ESTADO',1,0)      AS TT2_RPP
            ,DECODE(COM.SALINIDAD, 'SI', '1', '2')        AS TT2_SALINIDAD
            ,(CASE WHEN (COM.TIPO_PROYECTO = 'T4')
                   THEN ('T4'                    )
                   ELSE (NULL                    ) 
              END)                                        AS TT2_TIPOINVERSION -- CONFIGURADO POR PROCEDIMIENTO
            ,2                                            AS TT2_REMUNERACION_PENDIENTE 
            ,DECODE
              (DECODE(ET.PROVISIONAL
                          ,'SI','CONSTRUCCION'
                          ,COM.ESTADO
                      ),'CONSTRUCCION','INVA'
                       ,'OPERACION','BRAEN'
                       ,'RETIRADO','BRAFO'
               )                                          AS TT2_ALTERNATIVA_VALORACION 
            ,NULL                                         AS TT2_ID_PLAN
            ,0                                            AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
            ,COM.FECHA_OPERACION                          AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
            ,COM.FECHA_COLOCACION                         AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
            ,COM.FECHA_MODIFICACION                       AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
            ,COM.USUARIO_COLOCACION                       AS TT2_USR_COLOCACION --PERS
            ,COM.USUARIO_MODIFICACION                     AS TT2_USR_MODFICACION
            ,TRUNC(SYSDATE)                               AS TT2_PERIODO_OP
            ,0                                            AS TT2_ESTADOREPORTE
            ,SYSDATE                                      AS TT2_FSISTEMA
            ,0                                            AS TT2_ACTIVOCONEXION --PENDIENTE TRAER DEL SISTEMA GTECH
            ,(CASE WHEN ET.PROVISIONAL='SI'
                   THEN 1 
                   ELSE 0 
              END)                                        AS TT2_ACTIVOPROVISIONAL --PENDIENTE TRAER DEL SISTEMA
            ,NVL(AP.POTENCIA_INSTALADA,0)                 AS TT2_AP_POTENCIA
            ,0                                            AS TT2_CODE_CALP
            ,CON.FASES                                    AS TT2_FASES
            ,COM.CLASIFICACION_MERCADO                    AS TT2_POBLACION
            ,NULL                                         AS TT2_VALOR_UC
            ,NULL                                         AS TT2_OBSERVACIONES
        --BULK COLLECT INTO   V_QA_TTT2_REGISTRO
        FROM                CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
            LEFT OUTER JOIN QA_TTT1_REGISTRO       TT1  ON  TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
            LEFT OUTER JOIN INFO_AP                AP   ON AP.NODO_TRANSFORM_V     = SUBSTR(CON.NODO_TRANSFORM_V,1,20)
        WHERE               COM.G3E_FNO = 20400
        ;
     
COMMIT;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_TIPOINVERSION=3
--AND TT2_CODE_CALP<>'0'
AND TT2_PERIODO_OP=TO_dATE('01/04/2022','DD/MM/YYYY');

--1T01518 CASO 1 (ELIMINACION) SIN REPOSICION
--1T00816 CASO 2 (ELIMINACION) CON REPOSICION
--

SELECT * FROM QA_TFDDREFERENCIA;

DESC QA_TTC1;


SELECT TRUNC(ADD_MONTHS(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'),1)) FROM DUAL;


UPDATE BRAE.QA_TFDDREFERENCIA
SET    FDD_AUTOGENERADOR  = 1
WHERE  FDD_CODIGOELEMENTO IN (
                              SELECT DISTINCT TC1_CODCONEX 
                              FROM QA_TTC1 
                              WHERE TC1_PERIODO = 202203
                              AND TC1_AUTOGEN=1
                              );




CREATE INDEX FOR_QA_TFDDREFERENCIA_1 ON QA_TTC1(TC1_PERIODO,TC1_AUTOGEN);


UPDATE   BRAE.QA_TFDDREFERENCIA T1
SET      FDD_CANTIDAD_USRS  = (
                                SELECT   TC1_CODCONEX
                                        ,COUNT(TC1_CODCONEX) AS CANT_USRS 
                                FROM     QA_TTC1
                                WHERE    TC1_PERIODO  = 202203
                                AND      TC1_TIPCONEX = 'T'
                                AND      TC1_CODCONEX = T1.FDD_CODIGOELEMENTO
                                GROUP BY TC1_CODCONEX
                               )
;

EXEC QA_PTT2_REGISTRO(TO_DATE('01/04/2022','DD/MM/YYYY'));


SELECT * FROM QA_TFDDREFERENCIA
WHERE FDD_PERIODO_OP=TO_DATE('01/05/2022','DD/MM/YYYY');



SELECT * FROM QA_TTT2_REGISTRO;


UPDATE QA_TTC1 T
SET   TC1_CODCONEX =  (
                       SELECT TT2_CODE_IUA
                       FROM   BRAE.QA_TTT2_REGISTRO
                       WHERE  TT2_ESTADO         = 'OPERACION'
                       AND    TT2_CODIGOELEMENTO = T.TC1_CODCONEX
                       )
     ,TC1_CODTRANSF = TC1_CODCONEX
WHERE '01'||SUBSTR(TC1_PERIODO,5,2)||SUBSTR(TC1_PERIODO,1,4) = TO_DATE('01/04/2022','DD/MM/YYYY') 
AND   TC1_TIPCONEX  = 'T'
;

SELECT COUNT(*) FROM QA_TTC1
WHERE TC1_PERIODO = TO_CHAR(TO_DATE('01/03/2022','DD/MM/YYYY'),'YYYYMM') 
;


SELECT COUNT(*) FROM QA_TTC1
WHERE TC1_PERIODO = 202203; --584691


DESC QA_TTC1;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_dATE('01/04/2022','DD/MM/YYYY');

SELECT * FROM QA_TTC1
       WHERE TC1_PERIODO   = '202204'
        AND   TC1_TIPCONEX  = 'T'
        AND   TC1_TC1 NOT LIKE 'ALPM%';
        
        
EXEC QA_PTT2_REGISTRO(TO_DATE('01/04/2022','DD/MM/YYYY'));--ITERACION 1

SELECT *
FROM QA_TTC1
WHERE TC1_PERIODO='202204';


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/04/2022','DD/MM/YYYY')
;


DELETE FROM QA_TTC1 
WHERE TC1_PERIODO=202204;

COMMIT;
/
DECLARE
BEGIN
BRAE.QA_PTT2_REGISTRO(TO_DATE('01/04/2022','DD/MM/YYYY'));--ITERACION 2
END;
/

SELECT DISTINCT TC1_CODCONEX 
FROM QA_TTC1 
WHERE TC1_PERIODO=202204
AND TC1_IUA = 'NA';

SELECT * FROM SPARD.TRANSFOR
WHERE CODE IN (SELECT DISTINCT TC1_CODCONEX 
                FROM QA_TTC1 
                WHERE TC1_PERIODO=202204
                AND TC1_IUA = 'NA');
                
                


CREATE TABLE QA_TTC1_OBS(
	TC1_TC1	VARCHAR2(20 BYTE)
,	TC1_CODCONEX	VARCHAR2(20 BYTE)
,	TC1_TIPCONEX	VARCHAR2(2 BYTE)
,	TC1_NT	NUMBER(2,0)
,	TC1_NTP	NUMBER(2,0)
,	TC1_PROPACTIV	VARCHAR2(5 BYTE)
,	TC1_CONEXRED	VARCHAR2(2 BYTE)
,	TC1_IDCOMER	VARCHAR2(10 BYTE)
,	TC1_IDMERC	VARCHAR2(5 BYTE)
,	TC1_GC	VARCHAR2(3 BYTE)
,	TC1_CODFRONCOM	VARCHAR2(20 BYTE)
,	TC1_CODCIRC	VARCHAR2(7 BYTE)
,	TC1_CODTRANSF	VARCHAR2(20 BYTE)
,	TC1_CODDANE	VARCHAR2(10 BYTE)
,	TC1_UBIC	VARCHAR2(2 BYTE)
,	TC1_DIREC	VARCHAR2(100 BYTE)
,	TC1_CONESP	VARCHAR2(3 BYTE)
,	TC1_CODARESP	VARCHAR2(5 BYTE)
,	TC1_TIPARESP	VARCHAR2(4 BYTE)
,	TC1_ESTSECT	VARCHAR2(2 BYTE)
,	TC1_ALTITUD	NUMBER(15,5)
,	TC1_LONGITUD	NUMBER(15,5)
,	TC1_LATITUD	NUMBER(38,0)
,	TC1_AUTOGEN	VARCHAR2(2 BYTE)
,	TC1_EXPENER	VARCHAR2(2 BYTE)
,	TC1_CAPAUTOGENR	VARCHAR2(6 BYTE)
,	TC1_TIPGENR	VARCHAR2(2 BYTE)
,	TC1_CODFRONEXP	VARCHAR2(20 BYTE)
,	TC1_FENTGEN	DATE
,	TC1_CONTRESP	VARCHAR2(6 BYTE)
,	TC1_CAPCONTRESP	VARCHAR2(6 BYTE)
,	TC1_PERIODO	NUMBER(6,0)
,	TC1_IUA	VARCHAR2(20 BYTE)
);  

INSERT INTO QA_TTC1_OBS
SELECT *
FROM QA_TTC1 
WHERE TC1_PERIODO=202204
AND TC1_IUA = 'NA';

COMMIT;

DELETE
FROM  QA_TTC1 
WHERE TC1_PERIODO = 202204
AND   TC1_IUA     = 'NA';

COMMIT;


SELECT *
FROM QA_TTC1 
WHERE TC1_PERIODO=202204
AND TC1_IUA = 'NA';


SELECT DISTINCT TC1_CODCONEX
FROM QA_TTC1 
WHERE TC1_PERIODO=202204
AND TC1_CODCIRC = 'NA';


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN (SELECT DISTINCT TC1_CODCONEX
                            FROM QA_TTC1 
                            WHERE TC1_PERIODO=202204
                            AND TC1_CODCIRC = 'NA');
 
 
                            
UPDATE BRAE.QA_TTC1 TC  
SET TC1_CODCIRC = (SELECT TC1_CODCIRC FROM QA_TTC1 WHERE TC1_PERIODO=202203 AND TC1_TC1=TC.TC1_TC1)
WHERE TC1_PERIODO=202204
AND TC1_CODCIRC = 'NA';


SELECT *
FROM QA_TTC1 
WHERE TC1_PERIODO=202204
AND TC1_CODCIRC IS NULL
;                  

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/04/2022','DD/MM/YYYY');

SELECT COUNT( FDD_AUTOGENERADOR) FROM QA_TFDDREFERENCIA WHERE FDD_AUTOGENERADOR=1;

SELECT * FROM QA_TFDDREFERENCIA;

SELECT *
FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01-04-2022','DD-MM-YYYY');



SELECT * FROM QA_TTT2_REPORTE
WHERE TT2_CODE_TRAFO IN(
SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='CONSTRUCCION');


SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='CONSTRUCCION';


SELECT * FROM QA_TTT2_TEMP;



        WITH INFO_AP AS 
        (SELECT  SUBSTR(CON.NODO_TRANSFORM_V,1,20) AS NODO_TRANSFORM_V,SUM(LUM.POTENCIA) AS POTENCIA_INSTALADA
         FROM CCONECTIVIDAD_E@GTECH CON
         JOIN CCOMUN@GTECH COM ON CON.G3E_FID=COM.G3E_FID
         JOIN ELUMINAR_AT@GTECH LUM ON  LUM.G3E_FID = CON.G3E_FID
         WHERE CON.G3E_FNO = 21400
         GROUP BY CON.NODO_TRANSFORM_V)
            
        SELECT SUBSTR(CON.NODO_TRANSFORM_V,1,20)          AS TT2_CODIGOELEMENTO
            ,NULL                                         AS TT2_CODE_IUA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(COM.GRUPO_CALIDAD,1,2)                AS TT2_GRUPOCALIDAD
            ,SUBSTR(COM.ID_MERCADO,1,20)                  AS TT2_IDMERCADO
            ,TO_NUMBER(CON.CAPACIDAD_NOMINAL)             AS TT2_CAPACIDAD_TRAFO
            ,SUBSTR(CPRO.PROPIETARIO_1,1,20)              AS TT2_PROPIEDAD
            ,TO_NUMBER(ET.TIPO_SUBESTACION)               AS TT2_TSUBESTACION
            ,TO_NUMBER(COM.COOR_GPS_LON)                  AS TT2_LONGITUD
            ,TO_NUMBER(COM.COOR_GPS_LAT)                  AS TT2_LATITUD
            ,TO_NUMBER(COM.COOR_Z)                        AS TT2_ALTITUD
            ,SUBSTR(COM.ESTADO,1,20)                      AS TT2_ESTADO
            ,(CASE WHEN(ET.PROVISIONAL = 'SI') 
                   THEN('CONSTRUCCION'       ) 
                   ELSE(COM.ESTADO           ) 
              END)                                        AS TT2_ESTADO_BRA11
            ,'CREG 015'                                   AS TT2_RESMETODOLOGIA
            ,NULL                                         AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(CON.CIRCUITO,1,20)                    AS TT2_NOMBRE_CIRCUITO
            ,SUBSTR(TT1.TT1_CODIGOCIRCUITO,1,5)           AS TT2_IUL
            ,NULL                                         AS TT2_CODIGOPROYECTO --INDEFINIDO
            ,NULL                                         AS TT2_UNIDAD_CONSTRUCTIVA
            ,DECODE(CPRO.PROPIETARIO_1,'ESTADO',1,0)      AS TT2_RPP
            ,DECODE(COM.SALINIDAD, 'SI', '1', '2')        AS TT2_SALINIDAD
            ,(CASE WHEN (COM.TIPO_PROYECTO = 'T4')
                   THEN ('T4'                    )
                   ELSE (NULL                    ) 
              END)                                        AS TT2_TIPOINVERSION -- CONFIGURADO POR PROCEDIMIENTO
            ,2                                            AS TT2_REMUNERACION_PENDIENTE 
            ,DECODE
              (DECODE(ET.PROVISIONAL
                          ,'SI','CONSTRUCCION'
                          ,COM.ESTADO
                      ),'CONSTRUCCION','INVA'
                       ,'OPERACION','BRAEN'
                       ,'RETIRADO','BRAFO'
               )                                          AS TT2_ALTERNATIVA_VALORACION 
            ,NULL                                         AS TT2_ID_PLAN
            ,0                                            AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
            ,COM.FECHA_OPERACION                          AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
            ,COM.FECHA_COLOCACION                         AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
            ,COM.FECHA_MODIFICACION                       AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
            ,COM.USUARIO_COLOCACION                       AS TT2_USR_COLOCACION --PERS
            ,COM.USUARIO_MODIFICACION                     AS TT2_USR_MODFICACION
            --,TRUNC(FECHAOPERACION)                        AS TT2_PERIODO_OP
            ,0                                            AS TT2_ESTADOREPORTE
            ,SYSDATE                                      AS TT2_FSISTEMA
            ,0                                            AS TT2_ACTIVOCONEXION --PENDIENTE TRAER DEL SISTEMA GTECH
            ,(CASE WHEN ET.PROVISIONAL='SI'
                   THEN 1 
                   ELSE 0 
              END)                                        AS TT2_ACTIVOPROVISIONAL --PENDIENTE TRAER DEL SISTEMA
            ,NVL(AP.POTENCIA_INSTALADA,0)                 AS TT2_AP_POTENCIA
            ,0                                            AS TT2_CODE_CALP
            ,CON.FASES                                    AS TT2_FASES
            ,COM.CLASIFICACION_MERCADO                    AS TT2_POBLACION
            ,NULL                                         AS TT2_VALOR_UC
            ,NULL                                         AS TT2_OBSERVACIONES
       -- BULK COLLECT INTO   V_QA_TTT2_REGISTRO
        FROM                CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
            LEFT OUTER JOIN QA_TTT1_REGISTRO       TT1  ON  TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
            LEFT OUTER JOIN INFO_AP                AP   ON AP.NODO_TRANSFORM_V     = SUBSTR(CON.NODO_TRANSFORM_V,1,20)
        WHERE               COM.G3E_FNO = 20400
        AND                 SUBSTR(CON.NODO_TRANSFORM_V,1,20) IN (SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO WHERE TT2_ESTADO='CONSTRUCCION')
        ;



SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('1T13239'
,'1T13243'
,'1T13204'
,'1T13205'
,'1T13206'
,'1T13207'
,'1T13209'
,'1T13208'
,'5T02997'
,'1T13231'
,'1T13255');

--- TRANSICIO DE ACTIVOS EN CONSTRUCCION A OPERACION
UPDATE QA_TTT2_REGISTRO
SET 
TT2_ESTADO = 'OPERACION'
,TT2_ESTADO_BRA11 = 'OPERACION'
,TT2_ALTERNATIVA_VALORACION = 'BRAEN'
,TT2_PERIODO_OP = TO_DATE('01/04/2022','DD/MM/YYYY')
,TT2_ESTADOREPORTE = 0
,TT2_OBSERVACIONES = 'Transicion CONSTRUCCION a OPERACION'
WHERE TT2_CODIGOELEMENTO IN ('1T13239'
,'1T13243'
,'1T13204'
,'1T13205'
,'1T13206'
,'1T13207'
,'1T13209'
,'1T13208'
,'5T02997'
,'1T13231'
,'1T13255');

COMMIT;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/04/2022','DD/MM/YYYY');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO LIKE 'XT%';


-----SCRIPT PARA ACTUALIZACON DE CONSTRUCCION A OPERACION

SELECT DISTINCT TT2_CODIGOELEMENTO 
FROM QA_TTT2_TEMP
WHERE TT2_ESTADO='OPERACION';


SELECT '3T04953' FROM DUAL
UNION ALL
SELECT '1T13258' FROM DUAL
UNION ALL
SELECT '3T04951' FROM DUAL
UNION ALL
SELECT '3T00001' FROM DUAL


UPDATE QA_TTT2_REGISTRO
SET TT2_ESTADO                 = 'OPERACION'
   ,TT2_ESTADO_BRA11           = 'OPERACION'
   ,TT2_ALTERNATIVA_VALORACION = 'BRAEN'
   ,TT2_PERIODO_OP             = TRUNC(FECHAOPEARCION)
   ,TT2_ESTADOREPORTE          = 0
   ,TT2_OBSERVACIONES          = 'Transicion CONSTRUCCION a OPERACION'
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT DISTINCT TT2_CODIGOELEMENTO 
                            FROM QA_TTT2_TEMP
                            WHERE TT2_ESTADO='OPERACION'
                            INTERSECT
                            SELECT DISTINCT TT2_CODIGOELEMENTO 
                            FROM QA_TTT2_REGISTRO
                            WHERE TT2_ESTADO='CONSTRUCCION'
                            );
                            
SELECT * FROM QA_TTT2_REGISTRO;


UPDATE QA_TTT2_REGISTRO
SET TT2_LONGITUD = TO_NUMBER(REPLACE(TO_CHAR(TT2_LONGITUD,'999D999999'),',','.'))
   ,TT2_LATITUD = TO_NUMBER(REPLACE(TO_CHAR(TT2_LATITUD,'9D999999'),',','.'));
   
 
 ROLLBACK;
 
SELECT TO_CHAR('123,456', '999D999999999') FROM DUAL;

ALTER TABLE QA_TTT2_REGISTRO
MODIFY TT2_LONGITUD VARCHAR2(20);

ALTER TABLE QA_TTT2_REGISTRO
ADD 
(
 TT2_LONGITUD_X VARCHAR2(20)
,TT2_LATITUD_X VARCHAR2(20)
);


SELECT * FROM QA_TTT2_REGISTRO;

UPDATE QA_TTT2_REGISTRO
SET TT2_LONGITUD_X = TT2_LONGITUD
   ,TT2_LATITUD_X  = TT2_LATITUD
   ;
   
COMMIT;   

UPDATE QA_TTT2_REGISTRO
SET TT2_LONGITUD = NULL
   ,TT2_LATITUD  = NULL
   ; 
   
   
ALTER TABLE QA_TTT2_REGISTRO
MODIFY (TT2_LONGITUD VARCHAR2(20)
       ,TT2_LATITUD  VARCHAR2(20)
        );
        
DESC QA_TTT2_REGISTRO;   

UPDATE QA_TTT2_REGISTRO
SET TT2_LONGITUD = TT2_LONGITUD_X
   ,TT2_LATITUD  = TT2_LATITUD_X
   ;

SELECT * FROM QA_TTT2_REGISTRO;

COMMIT;

ALTER TABLE QA_TTT2_REGISTRO
DROP (TT2_LONGITUD_X,TT2_LATITUD_X);


UPDATE QA_TTT2_REGISTRO
SET TT2_LONGITUD = REPLACE(TT2_LONGITUD,',','.')
   ,TT2_LATITUD = REPLACE(TT2_LATITUD,',','.');
   


UPDATE QA_TTT2_REGISTRO
SET TT2_LONGITUD = TRIM(TT2_LONGITUD)
   ,TT2_LATITUD = TRIM(TT2_LATITUD);
   
COMMIT;


SELECT * FROM QA_TTT2_REPORTE;

DESC QA_TTT2_REPORTE;



ALTER TABLE QA_TTT2_REPORTE
ADD 
(
 TT2_LONGITUD_X VARCHAR2(20)
,TT2_LATITUD_X VARCHAR2(20)
);


SELECT * FROM QA_TTT2_REPORTE;

UPDATE QA_TTT2_REPORTE
SET TT2_LONGITUD_X = TT2_LONGITUD
   ,TT2_LATITUD_X  = TT2_LATITUD
   ;
   
COMMIT;   

UPDATE QA_TTT2_REPORTE
SET TT2_LONGITUD = NULL
   ,TT2_LATITUD  = NULL
   ; 
   
COMMIT;   
   
ALTER TABLE QA_TTT2_REPORTE
MODIFY (TT2_LONGITUD VARCHAR2(20)
       ,TT2_LATITUD  VARCHAR2(20)
        );
        
DESC QA_TTT2_REPORTE;   

UPDATE QA_TTT2_REPORTE
SET TT2_LONGITUD = TT2_LONGITUD_X
   ,TT2_LATITUD  = TT2_LATITUD_X
   ;

SELECT * FROM QA_TTT2_REPORTE;

COMMIT;

ALTER TABLE QA_TTT2_REPORTE
DROP (TT2_LONGITUD_X,TT2_LATITUD_X);

--------------------


ALTER TABLE QA_TTT2_REGISTRO
MODIFY (TT2_LONGITUD VARCHAR2(20)
       ,TT2_LATITUD  VARCHAR2(20)
        );--OK
       
ALTER TABLE QA_TTT2_BRAFO
MODIFY (TT2_LONGITUD VARCHAR2(20)
       ,TT2_LATITUD  VARCHAR2(20)
        );--OK

DELETE FROM QA_TTT2_OBS;
COMMIT;
ALTER TABLE QA_TTT2_OBS
MODIFY (TT2_LONGITUD VARCHAR2(20)
       ,TT2_LATITUD  VARCHAR2(20)
        );--OK

ALTER TABLE QA_TTT2_TEMP
MODIFY (TT2_LONGITUD VARCHAR2(20)
       ,TT2_LATITUD  VARCHAR2(20)
        );--OK
        
DELETE FROM QA_TTT2_BACKUP;
COMMIT;
ALTER TABLE QA_TTT2_BACKUP
MODIFY (TT2_LONGITUD VARCHAR2(20)
       ,TT2_LATITUD  VARCHAR2(20)
        );--OK

--------


SELECT * FROM QA_TTT2_BRAFO;

DESC QA_TTT2_BRAFO;



ALTER TABLE QA_TTT2_BRAFO
ADD 
(
 TT2_LONGITUD_X VARCHAR2(20)
,TT2_LATITUD_X VARCHAR2(20)
);


SELECT * FROM QA_TTT2_BRAFO;

UPDATE QA_TTT2_BRAFO
SET TT2_LONGITUD_X = TT2_LONGITUD
   ,TT2_LATITUD_X  = TT2_LATITUD
   ;
   
COMMIT;   

UPDATE QA_TTT2_BRAFO
SET TT2_LONGITUD = NULL
   ,TT2_LATITUD  = NULL
   ; 
   
COMMIT;   
   
ALTER TABLE QA_TTT2_BRAFO
MODIFY (TT2_LONGITUD VARCHAR2(20)
       ,TT2_LATITUD  VARCHAR2(20)
        );
        
DESC QA_TTT2_BRAFO;   

UPDATE QA_TTT2_BRAFO
SET TT2_LONGITUD = TT2_LONGITUD_X
   ,TT2_LATITUD  = TT2_LATITUD_X
   ;

SELECT * FROM QA_TTT2_BRAFO;

COMMIT;

ALTER TABLE QA_TTT2_BRAFO
DROP (TT2_LONGITUD_X,TT2_LATITUD_X);

----
SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA='10097V0001';


SELECT * FROM QA_TTC1
WHERE TC1_PERIODO=202204
;

SELECT * FROM QA_TTC1 
WHERE TC1_TC1='154298'
AND TC1_PERIODO LIKE '2022%';





SELECT *
FROM QA_TTT2_REGISTRO;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=1
AND TT2_PERIODO_OP=TO_DATE('01-04-2022','DD/MM/YYYY');



------------------------------EJECUCION QA_PTT2_REGISTRO PERIODO MAY 2022

SELECT * FROM QA_TTT2_BACKUP;


INSERT INTO QA_TTT2_BACKUP
SELECT * FROM QA_TTT2_REGISTRO;
--COMMIT;


EXEC QA_PTT2_REGISTRO(TO_DATE('01/05/2022','DD/MM/YYYY'));


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/05/2022','DD/MM/YYYY');


SELECT COUNT(*) FROM QA_TTT2_OBS;

------------------GENERACION DE FORMATO BRA11 MARZO 2022-------------------------
SELECT   TT2_CODIGOPROYECTO
        ,TT2_IUL
        ,(CASE WHEN(TT2_ESTADO_BRA11<>'CONSTRUCCION') THEN(TT2_CODE_IUA) ELSE(NULL)  END) AS TT2_CODE_IUA
        ,(CASE WHEN(TT2_ESTADO_BRA11 ='CONSTRUCCION') THEN(TT2_CODE_IUA) ELSE(NULL)  END) AS TT2_CODE_IUA_PRO
        ,TT2_UNIDAD_CONSTRUCTIVA
        ,TT2_RPP
        ,TT2_SALINIDAD
        ,TT2_TIPOINVERSION
        ,TT2_OBSERVACIONES
        ,TO_CHAR(TT2_FESTADO,'YYYY') AS TT2_FESTADO
        ,TT2_REMUNERACION_PENDIENTE
        ,(CASE WHEN(TT2_ESTADO_BRA11 = 'OPERACION'   ) THEN(2)
               WHEN(TT2_ESTADO_BRA11 = 'RETIRADO'    ) THEN(3)
               WHEN(TT2_ESTADO_BRA11 = 'CONSTRUCCION') THEN(1)
          END)   AS TT2_ESTADO_BRA11
        ,TT2_RESMETODOLOGIA
        ,(CASE WHEN(TT2_ALTERNATIVA_VALORACION='BRAEN') THEN(6) 
               WHEN(TT2_ALTERNATIVA_VALORACION='BRAFO') THEN(3)
               WHEN(TT2_ALTERNATIVA_VALORACION='INVA' ) THEN(5) 
          END) AS TT2_ALTERNATIVA_VALORACION
        ,TT2_ID_PLAN
        ,(CASE WHEN(TT2_ESTADO_BRA11 = 'OPERACION'   ) THEN(1)
               WHEN(TT2_ESTADO_BRA11 = 'RETIRADO'    ) THEN(1)
               WHEN(TT2_ESTADO_BRA11 = 'CONSTRUCCION') THEN(0)
          END) AS TT2_CANTIDAD_REPOSICIONES
        ,TT2_IDMERCADO
FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE(:PERIODO,'DD/MM/YYYY')
UNION ALL
SELECT   TT2_CODIGOPROYECTO
        ,TT2_IUL
        ,(CASE WHEN(TT2_ESTADO_BRA11<>'CONSTRUCCION') THEN(TT2_CODE_IUA) ELSE(NULL)  END) AS TT2_CODE_IUA
        ,(CASE WHEN(TT2_ESTADO_BRA11 ='CONSTRUCCION') THEN(TT2_CODE_IUA) ELSE(NULL)  END) AS TT2_CODE_IUA_PRO
        ,TT2_UNIDAD_CONSTRUCTIVA
        ,TT2_RPP
        ,TT2_SALINIDAD
        ,TT2_TIPOINVERSION
        ,TT2_OBSERVACIONES
        ,TO_CHAR(TT2_FESTADO,'YYYY') AS TT2_FESTADO
        ,TT2_REMUNERACION_PENDIENTE
        ,(CASE WHEN(TT2_ESTADO_BRA11 = 'OPERACION'   ) THEN(2)
               WHEN(TT2_ESTADO_BRA11 = 'RETIRADO'    ) THEN(3)
               WHEN(TT2_ESTADO_BRA11 = 'CONSTRUCCION') THEN(1)
          END)   AS TT2_ESTADO_BRA11
        ,TT2_RESMETODOLOGIA
        ,(CASE WHEN(TT2_ALTERNATIVA_VALORACION='BRAEN') THEN(6) 
               WHEN(TT2_ALTERNATIVA_VALORACION='BRAFO') THEN(3)
               WHEN(TT2_ALTERNATIVA_VALORACION='INVA' ) THEN(5) 
          END) AS TT2_ALTERNATIVA_VALORACION
        ,TT2_ID_PLAN
        ,(CASE WHEN(TT2_ESTADO_BRA11 = 'OPERACION'   ) THEN(1)
               WHEN(TT2_ESTADO_BRA11 = 'RETIRADO'    ) THEN(1)
               WHEN(TT2_ESTADO_BRA11 = 'CONSTRUCCION') THEN(0)
          END) AS TT2_CANTIDAD_REPOSICIONES
        ,TT2_IDMERCADO
FROM QA_TTT2_BRAFO
WHERE TT2_PERIODO_OP=TO_DATE(:PERIODO,'DD/MM/YYYY');



------------------GENERACION DE FORMATO BRA11 ABRIL 2022-------------------------
SELECT   TT2_PERIODO_OP AS BRA11_PERIODO_OP
        ,TT2_CODIGOELEMENTO AS BRA11_CODIGOELEMENTO
        ,TT2_CODIGOPROYECTO AS BRA11_CODIGOPROYECTO
        ,TT2_IUL AS BRA11_IUL
        ,(CASE WHEN(TT2_ESTADO_BRA11<>'CONSTRUCCION') THEN(TT2_CODE_IUA) ELSE(NULL)  END) AS BRA11_CODE_IUA
        ,(CASE WHEN(TT2_ESTADO_BRA11 ='CONSTRUCCION') THEN(TT2_CODE_IUA) ELSE(NULL)  END) AS BRA11_CODE_IUA_PRO
        ,TT2_UNIDAD_CONSTRUCTIVA AS BRA11_UNIDAD_CONSTRUCTIVA
        ,TT2_RPP AS BRA11_RPP
        ,TT2_SALINIDAD AS BRA11_SALINIDAD
        ,TT2_TIPOINVERSION AS BRA11_TIPOINVERSION
        ,TT2_OBSERVACIONES AS BRA11_OBSERVACIONES
        ,TRUNC(TT2_PERIODO_OP,'YYYY') AS BRA11_FESTADO
        ,TT2_REMUNERACION_PENDIENTE AS BRA11_REMUNERACION_PENDIENTE
        ,(CASE WHEN(TT2_ESTADO_BRA11 = 'OPERACION'   ) THEN(2)
               WHEN(TT2_ESTADO_BRA11 = 'RETIRADO'    ) THEN(3)
               WHEN(TT2_ESTADO_BRA11 = 'CONSTRUCCION') THEN(1)
          END)   AS BRA11_ESTADO
        ,TT2_RESMETODOLOGIA AS BRA11_RESMETODOLOGIA
        ,(CASE WHEN(TT2_ALTERNATIVA_VALORACION='BRAEN') THEN(6) 
               WHEN(TT2_ALTERNATIVA_VALORACION='BRAFO') THEN(3)
               WHEN(TT2_ALTERNATIVA_VALORACION='INVA' ) THEN(5) 
          END) AS BRA11_ALTERNATIVA_VALORACION 
        ,TT2_ID_PLAN AS BRA11_ID_PLAN
        ,(CASE WHEN(TT2_ESTADO_BRA11 = 'OPERACION'   ) THEN(1)
               WHEN(TT2_ESTADO_BRA11 = 'RETIRADO'    ) THEN(1)
               WHEN(TT2_ESTADO_BRA11 = 'CONSTRUCCION') THEN(0)
          END) AS BRA11_CANTIDAD_REPOSICIONES
        ,TT2_IDMERCADO AS BRA11_IDMERCADO
FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE(:PERIODO,'DD/MM/YYYY');



---->REALIZAR PRUEBAS DEL SCRIPT DE TRANSICION DE CONSTRUCCION A OPERACION

SELECT * FROM QA_TTT2_BACKUP
WHERE TT2_CODIGOELEMENTO IN ('1T13241');

SELECT * FROM QA_TTT2_REGISTRO 
WHERE TT2_CODIGOELEMENTO IN (
SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_BACKUP
WHERE TT2_ESTADO='CONSTRUCCION'
MINUS
SELECT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='CONSTRUCCION');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_OBSERVACIONES LIKE 'Tran%'
AND TT2_PERIODO_OP=TO_DATE('01-05-2022','DD/MM/YYYY');


SELECT * FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO='1T13241';


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01-05-2022','DD/MM/YYYY');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='CONSTRUCCION';


SELECT * FROM QA_TTT2_REGISTRO
WHERE  TT2_ESTADOREPORTE          =  0
AND    TT2_OBSERVACIONES            = 'Transicion CONSTRUCCION a OPERACION'
AND    TT2_PERIODO_OP             = TO_dATE(:FECHAOPERACION,'DD/MM/YYYY');




SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/05/2022','DD/MM/YYYY');

SELECT * FROM QA_TTT2_BACKUP
WHERE TT2_CODIGOELEMENTO='1T13241';

EXEC QA_PTT2_REGISTRO(TO_DATE('01/05/2022','DD/MM/YYYY'));

--3099	CALP000007253
--3099	CALP000007253



SELECT * FROM QA_TBRA11_REGISTRO;
SELECT * FROM QA_TBRA11_REPORTE;




DESC QA_TTT2_REGISTRO;

CREATE TABLE BRAE.QA_TBRA11_REGISTRO(
	BRA11_PERIODO_OP	DATE
,	BRA11_CODIGOELEMENTO	VARCHAR2(20)
,	BRA11_CODIGOPROYECTO	VARCHAR2(20)
,	BRA11_IUL	VARCHAR2(5)
,	BRA11_CODE_IUA	VARCHAR2(20)
,	BRA11_CODE_IUA_PRO	VARCHAR2(20)
,	BRA11_UNIDAD_CONSTRUCTIVA	VARCHAR2(20)
,	BRA11_RPP	NUMBER
,	BRA11_SALINIDAD	VARCHAR2(2)
,	BRA11_TIPOINVERSION	VARCHAR2(5)
,	BRA11_OBSERVACIONES	VARCHAR2(400)
,	BRA11_FESTADO	DATE
,	BRA11_REMUNERACION_PENDIENTE	NUMBER
,	BRA11_ESTADO	VARCHAR2(20)
,	BRA11_RESMETODOLOGIA	VARCHAR2(20)
,	BRA11_ALTERNATIVA_VALORACION	VARCHAR2(20)
,	BRA11_ID_PLAN	NUMBER
,	BRA11_CANTIDAD_REPOSICIONES	NUMBER
,	BRA11_IDMERCADO	VARCHAR2(20)
);

CREATE TABLE BRAE.QA_TBRA11_REPORTE(
	BRA11_PERIODO_OP	DATE
,	BRA11_CODIGOELEMENTO	VARCHAR2(20)
,	BRA11_CODIGOPROYECTO	VARCHAR2(20)
,	BRA11_IUL	VARCHAR2(5)
,	BRA11_CODE_IUA	VARCHAR2(20)
,	BRA11_CODE_IUA_PRO	VARCHAR2(20)
,	BRA11_UNIDAD_CONSTRUCTIVA	VARCHAR2(20)
,	BRA11_RPP	NUMBER
,	BRA11_SALINIDAD	VARCHAR2(2)
,	BRA11_TIPOINVERSION	VARCHAR2(5)
,	BRA11_OBSERVACIONES	VARCHAR2(400)
,	BRA11_FESTADO	DATE
,	BRA11_REMUNERACION_PENDIENTE	NUMBER
,	BRA11_ESTADO	VARCHAR2(20)
,	BRA11_RESMETODOLOGIA	VARCHAR2(20)
,	BRA11_ALTERNATIVA_VALORACION	VARCHAR2(20)
,	BRA11_ID_PLAN	NUMBER
,	BRA11_CANTIDAD_REPOSICIONES	NUMBER
,	BRA11_IDMERCADO	VARCHAR2(20)
);

--EXPORTAR FORMATO BRA11
SELECT 
 	BRA11_CODIGOPROYECTO
,	BRA11_IUL
,	BRA11_CODE_IUA
,	BRA11_CODE_IUA_PRO
,	BRA11_UNIDAD_CONSTRUCTIVA
,	BRA11_RPP
,	BRA11_SALINIDAD
,	BRA11_TIPOINVERSION
,	BRA11_OBSERVACIONES
,	BRA11_FESTADO
,	BRA11_REMUNERACION_PENDIENTE
,	BRA11_ESTADO
,	BRA11_RESMETODOLOGIA
,	BRA11_ALTERNATIVA_VALORACION
,	BRA11_ID_PLAN
,	BRA11_CANTIDAD_REPOSICIONES
,	BRA11_IDMERCADO
FROM QA_TBRA11_REPORTE;


SELECT DISTINCT TT2_PERIODO_OP FROM QA_TTT2_REPORTE;

SELECT DISTINCT TT2_PERIODO_OP FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA IN ('10005G0001'	,'1001LV0001'	,'100DOQ0001'	,'1004DT0001'	,'1003NW0001'	,'1003P00001'	,'1003NH0001'	,'100E6L0001'	,'1000LJ0001'	,'1008V60001'	,'100ENF0001'	,'1003HQ0001'	,'100AP10001'	,'100DSK0001'	,'1002RV0001'	,'1008AV0001'	,'10075U0001'	,'1009K90001'	,'100FU30101'	,'100FBZ0001'	,'1009KH0001'	,'100I860101'	,'100I0M0101'	,'10064N0001'	,'100CE50001'	,'1008S40001'	,'100IBP0101'	,'1002420001'	,'1007FT0001'	,'100E7L0001'	,'100J1O009A'	,'100J1C0093'	,'100J1E0094'	,'100J07009Z'	,'100J1N0098'	,'100J1X009B'	,'100J1M0098'	,'100J06009Z'	,'100J21009H'	,'100J1W009B'	,'100J0A0090'	,'100J1L0098'	,'100J05009Z'	,'100J04009Z'	,'100J0T0102'	,'100J0Y0105'	,'100J03009Z'	,'100J02009Z'	,'100J0L0101'	,'100J120091'	,'100J01009Z'	,'100J0S0102'	,'100J0R0102'	,'100J1K0098'	,'100J0K0101'	,'100J0Q0102'	,'100J1J0098'	,'100J0P0102'	,'100J0J0101'	,'100J00009Z'	,'100J0H0101'	,'100IZZ009Z'	,'100J0O0102'	,'100IZY009Z'	,'100J0G0101'	,'100J0F0101'	,'100J1Z009C'	,'100J0E0101'	,'100J0D0101'	,'100J0N0102'	,'100J1B0092'	,'100J1D0094'	,'100J0X0104'	,'100IZX009Z'	,'100J0W0104'	,'1009CJ0001'	,'1005GQ0001'	,'100J110091'	,'100J1A0092'	,'100J1V009B'	,'100J17010D'	,'100J1I0098'	,'100J1Y009C'	,'100J0U0103'	,'100J20009D'	,'100J1U009B'	,'100J090090'	,'100J1H0098'	,'100J1T009B'	,'100J16010C'	,'100J080090'	,'100J1S009B'	,'100J18010E'	,'100J15010C'	,'100J1R009B'	,'100J1Q009B'	,'100J1G0098'	,'100J1F0098'	,'100J1P009B'	,'100J14010C'	,'100J100091'	,'100J0C0101'	,'100J0M0102'	,'100J0Z010A'	,'100J0B0101'	,'100J0V0104'	,'100J13010C'	,'100IZW009Z'	,'100J190092'	,'1001PT0001'	,'1004OT0001'	,'1001SW0001'	,'100E290001'	,'1008UZ0001'	,'100E2P0001'	,'100E040001'	,'1007JA0001'	,'1001V3009B'	,'1006QR0001'	,'1006UH0001'	,'1004K80001'	,'1003NT0001'	,'1003NX0001'	,'1004CZ0001'	,'1009M50001'	,'1008TW0001');


SELECT TT2_CODIGOELEMENTO, TT2_CODE_IUA
FROM QA_TTT2_REGISTRO;


SELECT TT2_CODIGOELEMENTO, TT2_CODE_IUA
FROM QA_TTT2_BRAFO;


SELECT DISTINCT BRA11_PERIODO_OP FROM QA_TBRA11_REPORTE;

UPDATE QA_TBRA11_REPORTE
SET BRA11_PERIODO_OP=TO_DATE('01/02/2022','DD/MM/YYYY')
WHERE BRA11_PERIODO_OP=TO_DATE('02/01/2022','DD/MM/YYYY');

COMMIT;


SELECT * FROM QA_TBRA11_REPORTE;

ALTER TABLE QA_TBRA11_REGISTRO
MODIFY BRA11_IDMERCADO NUMBER;

SELECT DISTINCT BRA11_CODIGOELEMENTO FROM QA_TBRA11_REPORTE
WHERE BRA11_ESTADO IN (1,2);


SELECT * FROM QA_TBRA11_REGISTRO;

SELECT * FROM BRAE.QA_TBRA11_REGISTRO
WHERE BRA11_CODIGOELEMENTO IN (
                               SELECT DISTINCT BRA11_CODIGOELEMENTO
                               FROM BRAE.QA_TBRA11_REGISTRO
                               WHERE BRA11_PERIODO_OP = TRUNC(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'))
                               )
AND   BRA11_PERIODO_OP < TRUNC(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY'));



SELECT COUNT(*) 
FROM  BRAE.QA_TBRA11_REGISTRO
WHERE BRA11_PERIODO_OP =  TO_DATE('01/04/2022','DD/MM/YYYY');


SELECT ADD_MONTHS(TRUNC(TO_DATE(:FECHAOPERACION,'DD/MM/YYYY')),-1) FROM DUAL;

SELECT * FROM QA_TTT9;

ALTER TABLE BRAE.QA_TTT9
DROP COLUMN CONCATENAR;

SELECT * FROM QA_TTT9;

SELECT DISTINCT BRA11_CANTIDAD_REPOSICIONES FROM QA_TBRA11_REGISTRO
WHERE BRA11_TIPOINVERSION IN (1,3);

UPDATE QA_TBRA11_REGISTRO
SET BRA11_CANTIDAD_REPOSICIONES = 0
WHERE BRA11_TIPOINVERSION IN (2,4);

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO;

SELECT * FROM QA_TBRA11_REPORTE
WHERE BRA11_PERIODO_OP=TO_DATE('01/01/2022','DD/MM/YYYY');


UPDATE QA_TBRA11_REPORTE
SET BRA11_CANTIDAD_REPOSICIONES = 1
WHERE BRA11_TIPOINVERSION IN (1,3);


UPDATE QA_TBRA11_REPORTE
SET BRA11_CANTIDAD_REPOSICIONES = 0
WHERE BRA11_TIPOINVERSION IN (2,4);

commit;

SELECT * FROM QA_TBRA11_REPORTE
WHERE BRA11_TIPOINVERSION IN (1,3);

SELECT * FROM QA_TTT2_REGISTRO
;--WHERE TT2_ACTIVOPROVISIONAL=1;

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_ACTIVOPROVISIONAL=1;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ACTIVOPROVISIONAL=1;


SELECT * FROM QA_TFDDREPORTE_AJ;


SELECT * FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN(SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO
                            WHERE TT2_PROPIEDAD NOT IN('CENS','COMPARTIDO','PARTICULAR')
                               OR TT2_PROPIEDAD IS NULL);

SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO
WHERE TT2_PROPIEDAD NOT IN('CENS','COMPARTIDO','PARTICULAR')
   OR TT2_PROPIEDAD IS NULL;
   
      
UPDATE QA_TTT2_REGISTRO R
SET   TT2_PROPIEDAD = (SELECT TT2_PROPIEDAD FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO=R.TT2_CODIGOELEMENTO)
WHERE TT2_PROPIEDAD NOT IN('CENS','COMPARTIDO','PARTICULAR')
   OR TT2_PROPIEDAD IS NULL;


SELECT DISTINCT TT2_PROPIEDAD FROM QA_TTT2_REGISTRO;

COMMIT;

UPDATE QA_TTT2_REGISTRO
SET   TT2_CLASS_CARGA = 'NA'
WHERE TT2_CLASS_CARGA IS NULL;


SELECT TT2_NOMBRE_CIRCUITO FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN(
SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO
WHERE TT2_NOMBRE_CIRCUITO = 'SIN CIRCUITO');


UPDATE QA_TTT2_REGISTRO R
SET   TT2_NOMBRE_CIRCUITO = (SELECT TT2_NOMBRE_CIRCUITO FROM QA_TTT2_TEMP WHERE TT2_CODIGOELEMENTO=R.TT2_CODIGOELEMENTO)
WHERE TT2_NOMBRE_CIRCUITO = 'SIN CIRCUITO';

ROLLBACK;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_NOMBRE_CIRCUITO = 'SIN CIRCUITO'
;
COMMIT;


UPDATE QA_TTT2_REGISTRO
SET   TT2_ESTADOREPORTE=1
WHERE TT2_ESTADOREPORTE=0;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP = TO_DATE('01/05/2022','DD/MM/YYYY');


UPDATE QA_TTT2_REGISTRO
SET   TT2_ESTADOREPORTE=0
WHERE TT2_PERIODO_OP = TO_DATE('01/05/2022','DD/MM/YYYY')
AND   TT2_OBSERVACIONES IS NULL;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ACTIVOPROVISIONAL=1;

SELECT * FROM QA_TBRA11_REGISTRO
WHERE BRA11_PERIODO_OP=TO_dATE('01/04/2022','DD/MM/YYYY');


EXEC QA_PTT2_REGISTRO(TO_dATE('01/05/2022','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO WHERE TT2_PERIODO_OP=TO_dATE('01/05/2022','DD/MM/YYYY');



SELECT * FROM QA_TTT2_TEMP
WHERE TT2_ESTADO='BRAFO';






        WITH INFO_AP AS 
        (SELECT  SUBSTR(CON.NODO_TRANSFORM_V,1,20) AS NODO_TRANSFORM_V,SUM(LUM.POTENCIA) AS POTENCIA_INSTALADA
         FROM CCONECTIVIDAD_E@GTECH CON
         JOIN CCOMUN@GTECH COM ON CON.G3E_FID=COM.G3E_FID
         JOIN ELUMINAR_AT@GTECH LUM ON  LUM.G3E_FID = CON.G3E_FID
         WHERE CON.G3E_FNO = 21400
         GROUP BY CON.NODO_TRANSFORM_V)
            
        SELECT SUBSTR(CON.NODO_TRANSFORM_V,1,20)          AS TT2_CODIGOELEMENTO
            ,NULL                                         AS TT2_CODE_IUA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(COM.GRUPO_CALIDAD,1,2)                AS TT2_GRUPOCALIDAD
            ,SUBSTR(COM.ID_MERCADO,1,20)                  AS TT2_IDMERCADO
            ,TO_NUMBER(CON.CAPACIDAD_NOMINAL)             AS TT2_CAPACIDAD_TRAFO
            ,SUBSTR(CPRO.PROPIETARIO_1,1,20)              AS TT2_PROPIEDAD
            ,TO_NUMBER(ET.TIPO_SUBESTACION)               AS TT2_TSUBESTACION
            ,REPLACE(TRIM(COM.COOR_GPS_LON),',','.')      AS TT2_LONGITUD
            ,REPLACE(TRIM(COM.COOR_GPS_LAT),',','.')      AS TT2_LATITUD
            ,TO_NUMBER(COM.COOR_Z)                        AS TT2_ALTITUD
            ,SUBSTR(COM.ESTADO,1,20)                      AS TT2_ESTADO
            ,(CASE WHEN(ET.PROVISIONAL = 'SI') 
                   THEN('CONSTRUCCION'       ) 
                   ELSE(COM.ESTADO           ) 
              END)                                        AS TT2_ESTADO_BRA11
            ,'CREG 015'                                   AS TT2_RESMETODOLOGIA
            ,NULL                                         AS TT2_CLASS_CARGA --GESTIONADO POR PROCEDIMIENTO
            ,SUBSTR(CON.CIRCUITO,1,20)                    AS TT2_NOMBRE_CIRCUITO
            ,SUBSTR(TT1.TT1_CODIGOCIRCUITO,1,5)           AS TT2_IUL
            ,NULL                                         AS TT2_CODIGOPROYECTO --INDEFINIDO
            ,NULL                                         AS TT2_UNIDAD_CONSTRUCTIVA
            ,DECODE(CPRO.PROPIETARIO_1,'ESTADO',1,0)      AS TT2_RPP
            ,DECODE(COM.SALINIDAD, 'SI', '1', '2')        AS TT2_SALINIDAD
            ,(CASE WHEN (COM.TIPO_PROYECTO = 'T4')
                   THEN ('T4'                    )
                   ELSE (NULL                    ) 
              END)                                        AS TT2_TIPOINVERSION -- CONFIGURADO POR PROCEDIMIENTO
            ,2                                            AS TT2_REMUNERACION_PENDIENTE 
            ,DECODE
              (DECODE(ET.PROVISIONAL
                          ,'SI','CONSTRUCCION'
                          ,COM.ESTADO
                      ),'CONSTRUCCION','INVA'
                       ,'OPERACION','BRAEN'
                       ,'RETIRADO','BRAFO'
               )                                          AS TT2_ALTERNATIVA_VALORACION 
            ,NULL                                         AS TT2_ID_PLAN
            ,0                                            AS TT2_CANTIDAD_REPOSICIONES --GESTIONADO POR PROCEDIMIENTO
            ,COM.FECHA_OPERACION                          AS TT2_FESTADO --FECHA MANUAL DE OPERACION DEL ACTIVO
            ,COM.FECHA_COLOCACION                         AS TT2_FCOLOCACION -- FECHA SISTEMA DE CREACION DE ACTIVO
            ,COM.FECHA_MODIFICACION                       AS TT2_FMODIFICACION --FECHA SISTEMA DE MODIFICACION DE ACTIVO
            ,COM.USUARIO_COLOCACION                       AS TT2_USR_COLOCACION --PERS
            ,COM.USUARIO_MODIFICACION                     AS TT2_USR_MODFICACION
            --,TRUNC(FECHAOPERACION)                        AS TT2_PERIODO_OP
            ,0                                            AS TT2_ESTADOREPORTE
            ,SYSDATE                                      AS TT2_FSISTEMA
            ,0                                            AS TT2_ACTIVOCONEXION --PENDIENTE TRAER DEL SISTEMA GTECH
            ,(CASE WHEN ET.PROVISIONAL='SI'
                   THEN 1 
                   ELSE 0 
              END)                                        AS TT2_ACTIVOPROVISIONAL --PENDIENTE TRAER DEL SISTEMA
            ,NVL(AP.POTENCIA_INSTALADA,0)                 AS TT2_AP_POTENCIA
            ,0                                            AS TT2_CODE_CALP
            ,CON.FASES                                    AS TT2_FASES
            ,COM.CLASIFICACION_MERCADO                    AS TT2_POBLACION
            ,NULL                                         AS TT2_VALOR_UC
            ,NULL                                         AS TT2_OBSERVACIONES
        --BULK COLLECT INTO   V_QA_TTT2_REGISTRO
        FROM                CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
            LEFT OUTER JOIN QA_TTT1_REGISTRO       TT1  ON  TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
            LEFT OUTER JOIN INFO_AP                AP   ON AP.NODO_TRANSFORM_V     = SUBSTR(CON.NODO_TRANSFORM_V,1,20)
        WHERE               COM.G3E_FNO = 20400
       AND TRUNC(COM.FECHA_MODIFICACION,'MM') = TO_DATE('01/05/2022','DD/MM/YYYY')
       --AND COM.ESTADO = 'RETIRADO'
       AND CON.NODO_TRANSFORM_V='1T01441'
        
        ;
        
        SELECT * FROM QA_TTT2_OBS;
        
SELECT * FROM QA_TTT2_REPORTE
WHERE TT2_CODE_TRAFO='1T01441';

            --SE ACTUALIZA LOS MODIFICADOS DE REPOSICION
            UPDATE BRAE.QA_TTT2_REGISTRO
            SET    TT2_PERIODO_OP             =  ADD_MONTHS(TRUNC(TT2_FSISTEMA,'MM'),-1),
                   TT2_ALTERNATIVA_VALORACION = 'BRAEN',
                   TT2_ESTADO                 = 'OPERACION',
                   TT2_ESTADO_BRA11           = 'OPERACION',
                   TT2_FESTADO                =  ADD_MONTHS(LAST_DAY(TT2_FSISTEMA),-1),
                   TT2_TIPOINVERSION           = '2'
            WHERE  TT2_ESTADOREPORTE          =  1
            AND    TT2_TIPOINVERSION IN ('1','3')
            AND    TT2_PERIODO_OP =  TO_DATE('01/05/2022','DD/MM/YYYY');
            COMMIT;
            
            --SE ACTUALIZAN LOS MODIFICADOS DE TRANSICION CONSTRUCCION-OPERACION
            UPDATE BRAE.QA_TTT2_REGISTRO
            SET    TT2_PERIODO_OP             =  ADD_MONTHS(TRUNC(TT2_FSISTEMA,'MM'),-1)
                  ,TT2_ALTERNATIVA_VALORACION = 'INVA'
                  ,TT2_ESTADO                 = 'CONSTRUCCION'
                  ,TT2_ESTADO_BRA11           = 'CONSTRUCCION'
                  ,TT2_OBSERVACIONES          =  NULL
                  ,TT2_ESTADOREPORTE          =  1
                  ,TT2_AP_POTENCIA            =  0
                  ,TT2_CODE_CALP              = '0' 
                  
            WHERE  TT2_ESTADOREPORTE          =  0
            AND    TT2_OBSERVACIONES          = 'Transicion CONSTRUCCION a OPERACION'
            AND    TT2_PERIODO_OP             = FECHAOPERACION;
            
        ;
        
SELECT * FROM QA_TTT2_BACKUP
WHERE TT2_PERIODO_OP=TO_DATE('01/04/2022','DD/MM/YYYY');        
--22487

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_ESTADO='BRAFO'
; 

CREATE TABLE QA_TX AS(
SELECT * FROM QA_TTT2_REGISTRO);

SELECT * FROM QA_TX;

DELETE FROM QA_TTT2_REGISTRO;
COMMIT;

INSERT INTO QA_TTT2_REGISTRO
SELECT * FROM QA_TTT2_BACKUP;


EXEC QA_PTT2_REGISTRO(TO_DATE('01/05/2022','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=TO_DATE('01/05/2022','DD/MM/YYYY');

SELECT * FROM QA_TTT2_BACKUP
WHERE TT2_ESTADOREPORTE=0;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_OBSERVACIONES like 'Trans%';

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT DISTINCT TT2_CODIGOELEMENTO 
                            FROM QA_TTT2_REGISTRO
                            WHERE TT2_ESTADO_BRA11='CONSTRUCCION'
                            AND   TT2_ESTADO      = 'OPERACION'
                            AND   TT2_ACTIVOPROVISIONAL = 0
                            );


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO_BRA11='CONSTRUCCION'
AND   TT2_ESTADO      = 'OPERACION'
AND   TT2_ACTIVOPROVISIONAL = 0;

UPDATE QA_TTT2_REGISTRO
SET   TT2_ESTADO      ='CONSTRUCCION'
WHERE TT2_ESTADO_BRA11='CONSTRUCCION'
AND   TT2_ESTADO      = 'OPERACION'
AND   TT2_ACTIVOPROVISIONAL = 0;

COMMIT;

EXEC QA_PTT2_REGISTRO(TO_DATE('01/05/2022','DD/MM/YYYY'));

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('3T04921',
'1T13164',
'1T13117',
'5T02989',
'3T04924',
'3T04938',
'3T04942',
'3T04923',
'4T01672',
'1T13170',
'3T04934',
'3T04931',
'3T04945',
'3T04915',
'1T13198',
'1T13169',
'3T04940',
'3T04916',
'3T04943',
'1T13186',
'1T13165',
'1T13136',
'3T04928',
'5T02990',
'1T13184',
'3T04917',
'3T04914',
'5T02992',
'5T02987',
'5T02988',
'1T13172',
'1T13185',
'3T04944',
'5T02991',
'1T13183',
'3T04946',
'1T13182',
'3T04941',
'1T13171')
;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ACTIVOPROVISIONAL=1
;

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO='5T02995';

SELECT * FROM QA_TTT2_REPORTE
WHERE TT2_CODE_TRAFO='5T02995';


DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='5T02995';
COMMIT;

EXEC QA_PTT2_REGISTRO(TO_DATE('01/05/2022','DD/MM/YYYY'));


SELECT * FROM QA_TTT2_OBS
WHERE TT2_CODIGOELEMENTO='5T02995';


SELECT TT2_CODIGOELEMENTO,TT2_CODE_IUA FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='OPERACION';

SELECT CIRCUITO,IUA FROM AC_TBRA11_BASE
;

SELECT BRA11_CODIGOELEMENTO,BRA11_CODE_IUA 
FROM QA_TBRA11_REGISTRO
WHERE BRA11_ESTADO='2';



SELECT *
FROM QA_TBRA11_REPORTE
WHERE BRA11_TIPOINVERSION IN (2,4);




SELECT * FROM QA_TTT2_REGISTRO 
WHERE TT2_CODIGOELEMENTO ='1T13203';


SET SERVEROUTPUT ON;
EXEC QA_PTC1_REGISTRO_FASE1(DATE'2022-05-01');

SELECT * FROM QA_TTC1_TEMP
WHERE TC1_IDCOMER<>'604';


SELECT *FROM AC_TBRA11_BASE;
WHERE ALTERNATIVA_VALORACION  =6;

SELECT * FROM QA_TBRA11_REGISTRO;

SELECT ANO_ENTRADA_SALIDA_OPERACION
      ,CIRCUITO
      ,ROYECTO
      ,IUL
      ,IUA
      ,'' AS IUA_PROV
      ,COD_UNIDAD_CONSTRUCTIVA
      ,RPP
      ,SALINIDAD
      ,TIPO_INVERSION
      ,OBSERVACIONES
      ,ANO_ENTRADA_SALIDA_OPERACION
      ,REMUNERACION_PENDIENTE
      ,ESTADO
      ,RESOLUCION_CREG
      ,ALTERNATIVA_VALORACION
      ,ID_PLAN
      ,CANTIDAD
      ,ID_MERCADO
FROM AC_TBRA11_BASE;
      






SELECT CIRCUITO FROM AC_TBRA11_BASE
MINUS
SELECT BRA11_CODIGOELEMENTO FROM QA_TBRA11_REGISTRO WHERE BRA11_ESTADO=2 AND BRA11_cODIGOELEMENTO='1T00002';

SELECT CIRCUITO FROM AC_TBRA11_BASE WHERE CIRCUITO NOT LIKE '%R%' 
MINUS
SELECT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO WHERE TT2_ESTADO='OPERACION';

SELECT * FROM SPARD.TRANSFOR WHERE CODE ='1T06858';

SELECT *
        FROM                CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
            LEFT OUTER JOIN QA_TTT1_REGISTRO       TT1  ON  TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
            --LEFT OUTER JOIN INFO_AP                AP   ON AP.NODO_TRANSFORM_V     = SUBSTR(CON.NODO_TRANSFORM_V,1,20)
        WHERE               COM.G3E_FNO = 20400
        AND CON.NODO_TRANSFORM_V ='1T06858';
     

ALTER
SELECT circuito, iua, iul, cod_unidad_constructiva, tipo_inversion, ano_entrada_salida_operacion, estado, alternativa_valoracion,  observaciones_propias, 'BASE' AS fuente 
    FROM ac_tbra11_base 
    WHERE circuito IN ('1T06858')
UNION
SELECT circuito, iua, iul, cod_unidad_constructiva, tipo_inversion, ano_entrada_salida_operacion, estado, alternativa_valoracion, observaciones_propias, 'BRAFO' 
    FROM ac_tbra11_brafo 
    WHERE circuito IN ('1T06858')
ORDER BY circuito, ano_entrada_salida_operacion; 

SELECT * FROM QA_TTT2_REPORTE
WHERE TT2_CODE_TRAFO='1T06858';

SELECT * FROM QA_TTC1_TEMP;

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REPORTE 
WHERE TT2_CODE_TRAFO IN (
SELECT DISTINCT TT2_CODIGOELEMENTO FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='CONSTRUCCION');


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='CONSTRUCCION';

DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='CONSTRUCCION';
COMMIT;


UPDATE QA_TTT2_REGISTRO
SET   TT2_ESTADO_BRA11='PLANEACION'
WHERE TT2_ESTADO_BRA11='CONSTRUCCION';

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO_BRA11='PLANEACION';

SELECT DISTINCT TT2_ESTADO_BRA11 FROM QA_TTT2_REGISTRO;

SELECT *
FROM ALL_TABLES
WHERE OWNER='OMS';

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO='1T13203';


DESC QA_TTC1_TEMP;

SELECT * FROM AC_TBRA11_BASE
WHERE CIRCUITO IN (
SELECT CIRCUITO FROM AC_TBRA11_BASE
WHERE CIRCUITO NOT LIKE '%R%'
MINUS
SELECT TT2_CODIGOELEMENTO
FROM (
SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=DATE'2022-05-01'
AND   TT2_ESTADO<>'OPERACION'
UNION ALL
SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP<>DATE'2022-05-01'));


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN(
SELECT CIRCUITO FROM AC_TBRA11_BASE
WHERE CIRCUITO NOT LIKE '%R%'
MINUS
SELECT TT2_CODIGOELEMENTO
FROM (
SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=DATE'2022-05-01'
AND   TT2_ESTADO<>'OPERACION'
UNION ALL
SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP<>DATE'2022-05-01'));



(SELECT CIRCUITO FROM AC_TBRA11_BASE
WHERE CIRCUITO NOT LIKE '%R%')
MINUS
(SELECT TT2_CODIGOELEMENTO
FROM (
    SELECT * FROM QA_TTT2_REGISTRO
    WHERE TT2_PERIODO_OP=DATE'2022-05-01'
    AND   TT2_ESTADO<>'OPERACION'
    UNION ALL
    SELECT * FROM QA_TTT2_REGISTRO
    WHERE TT2_PERIODO_OP<>DATE'2022-05-01')
 )   ;
    --18826  Rows 18862  Rows


SELECT *
FROM QA_TTT2_REGISTRO
--LEFT OUTER JOIN AC_TBRA11_BASE ON TT2_CODIGOELEMENTO=CIRCUITO
WHERE TT2_CODIGOELEMENTO IN('1T06858'
,'1T13117'
,'1T13136'
,'1T13164'
,'1T13165'
,'1T13169'
,'1T13170'
,'1T13171'
,'1T13172'
,'1T13182'
,'1T13183'
,'1T13184'
,'1T13185'
,'1T13186'
,'1T13198'
,'3T04914'
,'3T04915'
,'3T04916'
,'3T04917'
,'3T04921'
,'3T04923'
,'3T04924'
,'3T04928'
,'3T04931'
,'3T04934'
,'3T04938'
,'3T04940'
,'3T04941'
,'3T04942'
,'3T04943'
,'3T04944'
,'3T04945'
,'3T04946'
,'4T01672'
,'5T02991'
,'5T02992')
;



SELECT TT2_CODIGOELEMENTO
FROM (
    SELECT * FROM QA_TTT2_REGISTRO
    WHERE TT2_PERIODO_OP=DATE'2022-05-01'
    AND   TT2_ESTADO<>'OPERACION'
    UNION ALL
    SELECT * FROM QA_TTT2_REGISTRO
    WHERE TT2_PERIODO_OP<>DATE'2022-05-01')
WHERE TT2_CODIGOELEMENTO IN('1T06858'
,'1T13117'
,'1T13136'
,'1T13164'
,'1T13165'
,'1T13169'
,'1T13170'
,'1T13171'
,'1T13172'
,'1T13182'
,'1T13183'
,'1T13184'
,'1T13185'
,'1T13186'
,'1T13198'
,'3T04914'
,'3T04915'
,'3T04916'
,'3T04917'
,'3T04921'
,'3T04923'
,'3T04924'
,'3T04928'
,'3T04931'
,'3T04934'
,'3T04938'
,'3T04940'
,'3T04941'
,'3T04942'
,'3T04943'
,'3T04944'
,'3T04945'
,'3T04946'
,'4T01672'
,'5T02991'
,'5T02992')
;


SELECT * FROM QA_TTT2_REPORTE 
WHERE TT2_CODE_TRAFO IN('1T06858'
,'1T13117'
,'1T13136'
,'1T13164'
,'1T13165'
,'1T13169'
,'1T13170'
,'1T13171'
,'1T13172'
,'1T13182'
,'1T13183'
,'1T13184'
,'1T13185'
,'1T13186'
,'1T13198'
,'3T04914'
,'3T04915'
,'3T04916'
,'3T04917'
,'3T04921'
,'3T04923'
,'3T04924'
,'3T04928'
,'3T04931'
,'3T04934'
,'3T04938'
,'3T04940'
,'3T04941'
,'3T04942'
,'3T04943'
,'3T04944'
,'3T04945'
,'3T04946'
,'4T01672'
,'5T02991'
,'5T02992')
;



SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN(
                            SELECT CIRCUITO FROM AC_TBRA11_BASE
                            WHERE CIRCUITO NOT LIKE '%R%'
                            MINUS
                            SELECT TT2_CODIGOELEMENTO
                            FROM (
                                    SELECT * FROM QA_TTT2_REGISTRO
                                    WHERE TT2_PERIODO_OP=DATE'2022-05-01'
                                    AND   TT2_ESTADO<>'OPERACION'
                                    UNION ALL
                                    SELECT * FROM QA_TTT2_REGISTRO
                                    WHERE TT2_PERIODO_OP<>DATE'2022-05-01'
                                    UNION ALL
                                    SELECT * FROM QA_TTT2_REGISTRO
                                    WHERE TT2_PERIODO_OP=DATE'2022-05-01'
                                    AND TT2_OBSERVACIONES='Transicion CONSTRUCCION a OPERACION'
                                )
                             );
                             
                             
SELECT CIRCUITO FROM AC_TBRA11_BASE
WHERE CIRCUITO NOT LIKE '%R%'
MINUS
SELECT TT2_CODIGOELEMENTO
FROM (
        SELECT * FROM QA_TTT2_REGISTRO
        WHERE TT2_PERIODO_OP=DATE'2022-05-01'
        AND   TT2_ESTADO<>'OPERACION'
        UNION ALL
        SELECT * FROM QA_TTT2_REGISTRO
        WHERE TT2_PERIODO_OP<>DATE'2022-05-01'
        UNION ALL
        SELECT * FROM QA_TTT2_REGISTRO
        WHERE TT2_PERIODO_OP=DATE'2022-05-01'
        AND TT2_OBSERVACIONES='Transicion CONSTRUCCION a OPERACION'
    )
;

SELECT * FROM QA_TTT2_REPORTE
WHERE TT2_CODE_TRAFO='1T06858';

INSERT INTO AC_TBRA11_BRAFO
SELECT * FROM AC_TBRA11_BASE
WHERE CIRCUITO='1T06858';
--UNION ALL
--SELECT * FROM AC_TBRA11_BRAFO
--WHERE CIRCUITO='1T06858'
--;
ROLLBACK;
DELETE FROM AC_TBRA11_BASE
WHERE CIRCUITO='1T06858';

UPDATE AC_TBRA11_BRAFO
SET ESTADO=3
   ,ALTERNATIVA_VALORACION=3
   ,OBSERVACIONES_PROPIAS='2022_DESMANTELADO'
WHERE CIRCUITO='1T06858';


COMMIT;


SELECT * FROM AC_TBRA11_BASE;

DESC AC_TBRA11_BASE;


--PARA CONVERSION Y EXPORTACION A TABLA QA_TBRA11_REGISTRO DESDE LA TABLA AC_TBRA11_BASE************************
SELECT
   ANO_ENTRADA_SALIDA_OPERACION AS BRA11_PERIODO_OP
,	CIRCUITO AS BRA11_CODIGOELEMENTO
,   ROYECTO AS BRA11_CODIGOPROYECTO
,	IUL AS BRA11_IUL
,	IUA AS BRA11_CODE_IUA
,	COD_ACTIVO_PROVISIONAL AS BRA11_CODE_IUA_PRO
,	COD_UNIDAD_CONSTRUCTIVA AS BRA11_UNIDAD_CONSTRUCTIVA
,	RPP as BRA11_RPP
,	SALINIDAD as BRA11_SALINIDAD
,	TIPO_INVERSION as BRA11_TIPOINVERSION
,	OBSERVACIONES as BRA11_OBSERVACIONES
,	REMUNERACION_PENDIENTE AS BRA11_REMUNERACION_PENDIENTE
,	ESTADO AS BRA11_ESTADO
,	RESOLUCION_CREG AS BRA11_RESMETODOLOGIA
,	ALTERNATIVA_VALORACION  AS BRA11_ALTERNATIVA_VALORACION
,	ID_PLAN AS BRA11_ID_PLAN
,	CANTIDAD AS BRA11_CANTIDAD_REPOSICIONES
,	ID_MERCADO AS BRA11_IDMERCADO
FROM AC_TBRA11_BASE;


--VERIFICACION DE IUA'S DE TABLA QA_TBRA11_REGISTRO DESDE LA TABLA AC_TBRA11_BASE

SELECT CIRCUITO,IUA, TT2_CODE_IUA
FROM AC_TBRA11_BASE
LEFT OUTER JOIN (SELECT * FROM QA_TTT2_REGISTRO WHERE TT2_ESTADO='OPERACION') ON TT2_CODIGOELEMENTO=CIRCUITO
WHERE CIRCUITO NOT LIKE '%R%'
AND TT2_CODE_IUA <> IUA; -- 962  Rows QUE DEBEN SER SOLUCIONADAS CON LA DIF DE IUA.



SELECT *
FROM QA_TTT2_REPORTE
WHERE TT2_CODE_TRAFO='5T01036'
;
SELECT * FROM AC_TBRA11_BRAFO
WHERE CIRCUITO='5T01036';

SELECT TT2_CODIGOELEMENTO,TT2_CODE_IUA FROM QA_TTT2_REGISTRO
;


SELECT TT2_CODE_IUA,TT2_CODE_TRAFO,TT2_FESTADO FROM QA_TTT2_REPORTE
;



SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;


UPDATE QA_TTT2_REGISTRO
SET   TT2_ESTADOREPORTE=1
WHERE TT2_ESTADOREPORTE=0;

--COMMIT;

SELECT * FROM QA_TBRA11_REGISTRO
WHERE BRA11_PERIODO_OP=DATE'2022-06-01';

EXEC QA_PBRA11_REGISTRO(DATE'2022-06-01');

    SELECT COUNT(DISTINCT FDD_AJUSTADO) AS AJUSTADO
    --INTO AJUSTADO
    FROM QA_TFDDREGISTRO
    WHERE TRUNC(FDD_FINICIAL,'MM') = TRUNC(DATE'2022-06-01')
    AND   FDD_AJUSTADO = 'S';


SELECT * FROM QA_TBRA11_REGISTRO
WHERE BRA11_PERIODO_OP=DATE'2022-05-01';

EXEC QA_PBRA11_REGISTRO(DATE'2022-05-01');

EXEC QA_PBRA11_REPORTE(DATE'2022-05-01');

SELECT * FROM QA_TBRA11_REPORTE
WHERE BRA11_PERIODO_OP=DATE'2022-05-01';


SET SERVEROUTPUT ON;
--EXEC QA_PTT2_REGISTRO(DATE'2022-06-01');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=DATE'2022-06-01';

SELECT * FROM SPARD.TRANSFOR
WHERE CODE IN ('1T12414');

SELECT DISTINCT TT2_PERIODO_OP
FROM QA_TTT2_REPORTE
WHERE TT2_CODE_TRAFO='1T12414';

SELECT * FROM ALL_TABLES
WHERE OWNER='BRAE'
AND TABLE_NAME LIKE 'AC_T%';

SELECT * FROM AC_TBRA11_BASE;

SELECT COUNT(*) FROM QA_TTT2_REGISTRO
WHERE TT2_PERIODO_OP=DATE'2022-06-01';

SELECT* FROM QA_TBRA11_REGISTRO;

-----AGREGAR EL CAMPO LOCALIZACION A LA TABLA QA_TTT2_REGISTRO

ALTER TABLE QA_TTT2_REGISTRO
ADD TT2_LOCALIZACION VARCHAR2(20);
       
ALTER TABLE QA_TTT2_BRAFO
ADD TT2_LOCALIZACION VARCHAR2(20);

ALTER TABLE QA_TTT2_OBS
ADD TT2_LOCALIZACION VARCHAR2(20);

ALTER TABLE QA_TTT2_TEMP
ADD TT2_LOCALIZACION VARCHAR2(20);

ALTER TABLE QA_TTT2_BACKUP
ADD TT2_LOCALIZACION VARCHAR2(20);

UPDATE QA_TTT2_REGISTRO
SET TT2_LOCALIZACION = (SELECT PROPIEDAD FROM QA_TTEMP WHERE CODIGO = TT2_CODIGOELEMENTO)
;

SELECT * FROM QA_TTT2_REGISTRO
;--22.581

CREATE TABLE QA_TTEMP(
 CODIGO VARCHAR2(20)
,PROPIEDAD VARCHAR2(20)
);


SELECT * FROM QA_TTEMP;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_LOCALIZACION IS NULL;

SELECT DISTINCT TT2_LOCALIZACION FROM QA_TTT2_REGISTRO;

UPDATE QA_TTT2_REGISTRO
SET TT2_LOCALIZACION = 'AEREO'
WHERE TT2_LOCALIZACION IS NULL;


COMMIT;

DROP TABLE QA_TTEMP;



SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADO='OPERACION';


SELECT * FROM QA_TTT2_REGISTRO;


---AGREGAR LOS CAMPOS TT2_MUNICIPIO Y TT2_DEPARTAMENTO



ALTER TABLE QA_TTT2_REGISTRO
ADD TT2_MUNICIPIO VARCHAR2(100);
       
ALTER TABLE QA_TTT2_BRAFO
ADD TT2_MUNICIPIO VARCHAR2(100);

ALTER TABLE QA_TTT2_OBS
ADD TT2_MUNICIPIO VARCHAR2(100);

ALTER TABLE QA_TTT2_TEMP
ADD TT2_MUNICIPIO VARCHAR2(100);

ALTER TABLE QA_TTT2_BACKUP
ADD TT2_MUNICIPIO VARCHAR2(100);



ALTER TABLE QA_TTT2_REGISTRO
ADD TT2_DEPARTAMENTO VARCHAR2(100);
       
ALTER TABLE QA_TTT2_BRAFO
ADD TT2_DEPARTAMENTO VARCHAR2(100);

ALTER TABLE QA_TTT2_OBS
ADD TT2_DEPARTAMENTO VARCHAR2(100);

ALTER TABLE QA_TTT2_TEMP
ADD TT2_DEPARTAMENTO VARCHAR2(100);

ALTER TABLE QA_TTT2_BACKUP
ADD TT2_DEPARTAMENTO VARCHAR2(100);



SELECT  CON.NODO_TRANSFORM_V
       ,COM.DEPARTAMENTO, COM.MUNICIPIO
FROM                CCONECTIVIDAD_E@GTECH  CON
    LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
    LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
    LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
    LEFT OUTER JOIN QA_TTT1_REGISTRO       TT1  ON  TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
WHERE               COM.G3E_FNO = 20400
AND                 COM.ESTADO <> 'CONSTRUCCION'
;




SELECT * FROM QA_TTT2_REGISTRO;

CREATE TABLE QA_TEMPORAL(
CODIGOELEMENTO VARCHAR2(20)
,MUNICIPIO VARCHAR2(20)
,DEPARTAMENTO VARCHAR2(20)
);

DELETE FROM QA_TEMPORAL;
COMMIT;

INSERT INTO QA_TEMPORAL
SELECT DISTINCT CON.NODO_TRANSFORM_V
               ,COM.MUNICIPIO
               ,COM.DEPARTAMENTO
FROM                CCONECTIVIDAD_E@GTECH  CON
    LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
    LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
    LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
    LEFT OUTER JOIN QA_TTT1_REGISTRO       TT1  ON  TT1.TT1_NOMBRECIRCUITO = CON.CIRCUITO
WHERE               COM.G3E_FNO = 20400
AND                 COM.ESTADO = 'OPERACION'
;

COMMIT;

SELECT * FROM QA_TEMPORAL;

UPDATE QA_TTT2_REGISTRO 
SET TT2_MUNICIPIO = (SELECT DISTINCT MUNICIPIO FROM QA_TEMPORAL WHERE CODIGOELEMENTO =  TT2_CODIGOELEMENTO)
;

UPDATE QA_TTT2_REGISTRO 
SET TT2_DEPARTAMENTO = (SELECT DISTINCT DEPARTAMENTO FROM QA_TEMPORAL WHERE CODIGOELEMENTO =  TT2_CODIGOELEMENTO)
;


SELECT DISTINCT TT2_MUNICIPIO 
FROM QA_TTT2_REGISTRO
WHERE TT2_MUNICIPIO IN ('VILLA DEL ROSARIO','CÚCUTA','LOS PATIOS')
;

---CARGAR TABLA QA_TDIVIPOLA_DANE


CREATE TABLE BRAE.QA_TDIVIPOLA_DANE(
     CODIGO_DEPARTAMENTO NUMBER
    ,NOMBRE_DEPARTAMENTO VARCHAR2(200)
    ,CODIGO_MUNICIPIO NUMBER
    ,NOMBRE_MUNICIPIO VARCHAR2(200)
    ,CODIGO_CENTRO_POBLADO NUMBER
    ,NOMBRE_CENTRO_POBLADO VARCHAR2(200)
    ,TIPO VARCHAR2(10)
);


SELECT DISTINCT 
       NOMBRE_MUNICIPIO
      ,CODIGO_MUNICIPIO 
FROM QA_TDIVIPOLA_DANE
WHERE NOMBRE_MUNICIPIO = 'LOS PATIOS';




    SELECT 	TT2_CODE_CALP      AS	TC1_TC1
        ,	TT2_CODIGOELEMENTO AS	TC1_CODCONEX
        ,	MUN.CODIGO_MUNICIPIO||'000'  AS	TC1_CODDANE
    FROM BRAE.QA_TTT2_REGISTRO
    LEFT OUTER JOIN (    SELECT DISTINCT
                                NOMBRE_DEPARTAMENTO
                               ,NOMBRE_MUNICIPIO
                               ,CODIGO_MUNICIPIO 
                         FROM QA_TDIVIPOLA_DANE) MUN 
                     ON (    MUN.NOMBRE_MUNICIPIO    = TT2_MUNICIPIO 
                         AND MUN.NOMBRE_DEPARTAMENTO = TT2_DEPARTAMENTO
                         )
    WHERE TT2_CODE_CALP <> '0'
    AND   TT2_ESTADO = 'OPERACION'
    ;  


UPDATE QA_TDIVIPOLA_DANE
SET   NOMBRE_MUNICIPIO = 'CÚCUTA'
WHERE NOMBRE_MUNICIPIO LIKE '%CÚCUTA%';



UPDATE QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('3T01592',	'3T01549',	'1T09629',	'1T13284',	'1T13172',	'1T13205',	'5T02989',	'5T02990',	'3T04703');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_CALP<>'0'
;





SELECT COUNT(*) FROM QA_TTC1_TEMP;

--589452
--6613 CALPS

EXEC QA_PTC1_REGISTRO_FASE2(DATE'2022-06-01');

SELECT * FROM QA_TTC1_TEMP
WHERE TC1_CODCONEX LIKE 'ALPM%';

SELECT * FROM QA_TMUNDANE;



SELECT SUBSTR('54001000',1,5) FROM DUAL;

DESC QA_TMUNDANE;

DESC QA_tTT2_REGISTRO;



EXEC QA_PTC1_REGISTRO_FASE2(DATE'2022-06-01');


SELECT * FROM QA_TTC1_TEMP;


SELECT * FROM QA_TCS1;

--1T07345
SELECT TO_CHAR(TT2_PERIODO_OP,'YYYY') AS PERIODO,COUNT(TT2_CODIGOELEMENTO) AS CANTIDAD_ACTIVOS FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT TT2_CODIGOELEMENTO 
                            FROM QA_TTT2_REGISTRO
                            WHERE TT2_ACTIVOCONEXION=0
                            AND   TT2_ACTIVOPROVISIONAL=0
                            AND   TT2_ESTADO='OPERACION'
                             
                            MINUS
                            
                            SELECT CIRCUITO FROM AC_TBRA11_BASE
                            WHERE ESTADO=2
                            )
GROUP BY TO_CHAR(TT2_PERIODO_OP,'YYYY')
ORDER BY 1
;

--ACTIVOS NO REPORTADO DE TRANSFORMADORES BRAENR
SELECT  TO_CHAR(PERIODO,'YYYY-MM') AS PERIODO, COUNT(TT2_CODE_TRAFO) AS CANTIDAD
          FROM (
                SELECT MIN(TT2_PERIODO_OP) AS PERIODO, TT2_CODE_TRAFO 
                FROM   QA_TTT2_REPORTE
                WHERE TT2_CODE_TRAFO IN (
                                            SELECT TT2_CODIGOELEMENTO 
                                            FROM QA_TTT2_REGISTRO
                                            WHERE TT2_ACTIVOCONEXION=0
                                            AND   TT2_ACTIVOPROVISIONAL=0
                                            AND   TT2_ESTADO='OPERACION'
                                            
                                            MINUS
                                            
                                            SELECT CIRCUITO FROM AC_TBRA11_BASE
                                            WHERE ESTADO=2
                                         )
                GROUP BY TT2_CODE_TRAFO
              )
GROUP BY TO_CHAR(PERIODO,'YYYY-MM')
ORDER BY 1
;

---REVISAR CANTIDAD DE USUARIOS POR TRAFOS EN TC1
SELECT TC1_CODCONEX, COUNT(TC1_CODCONEX) CANTIDAD_USRS 
FROM QA_TTC1 
WHERE TC1_PERIODO=202206
AND TC1_TIPCONEX='T'
AND TC1_CODCONEX NOT LIKE 'ALPM%'
AND TC1_CODCONEX IN (
                    SELECT TT2_CODIGOELEMENTO 
                    FROM QA_TTT2_REGISTRO
                    WHERE TT2_ACTIVOCONEXION=0
                    AND   TT2_ACTIVOPROVISIONAL=0
                    AND   TT2_ESTADO='OPERACION'
                    
                    MINUS
                    
                    SELECT CIRCUITO FROM AC_TBRA11_BASE
                    WHERE ESTADO=2
                     )
HAVING COUNT(TC1_CODCONEX)>2
GROUP BY TC1_CODCONEX
;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_ESTADOREPORTE=0;



QA_PBRA11_REGISTRO


/*******************************************************************************************************************************
***************************************GENERACION BRA11 JULIO 2022**************************************************************
*******************************************************************************************************************************/


SELECT * FROM QA_TBRA11_REGISTRO
WHERE BRA11_PERIODO_OP=DATE'2022-07-01';

EXEC QA_PBRA11_REGISTRO(DATE'2022-07-01');

    SELECT COUNT(DISTINCT FDD_AJUSTADO) AS AJUSTADO
    --INTO AJUSTADO
    FROM QA_TFDDREGISTRO
    WHERE TRUNC(FDD_FINICIAL,'MM') = TRUNC(DATE'2022-07-01')
    AND   FDD_AJUSTADO = 'S';


EXEC QA_PBRA11_REPORTE(DATE'2022-07-01');

SELECT * FROM QA_TBRA11_REPORTE
WHERE BRA11_PERIODO_OP=DATE'2022-07-01';


SELECT CON.TENSION,CON.TENSION_SECUNDARIA
        FROM                CCONECTIVIDAD_E@GTECH  CON
            LEFT OUTER JOIN CCOMUN@GTECH           COM  ON  COM.G3E_FID            = CON.G3E_FID
            LEFT OUTER JOIN ETRANSFO_AT@GTECH      ET   ON  ET.G3E_FID             = COM.G3E_FID
            LEFT OUTER JOIN CPROPIETARIO@GTECH     CPRO ON  CPRO.G3E_FID           = CON.G3E_FID
        WHERE               COM.G3E_FNO = 20400
        AND                 COM.ESTADO <> 'CONSTRUCCION'
        ;

SELECT * FROM QA_TTT2_REGISTRO;

--AGREGAR DOS CAMPOS TT2_NT_PRIMARIA Y TT2_NT_SECUNDARIA

ALTER TABLE QA_TTT2_REGISTRO
ADD (TT2_NT_PRIMARIA   NUMBER
    ,TT2_NT_SECUNDARIA NUMBER);
       
ALTER TABLE QA_TTT2_BRAFO
ADD (TT2_NT_PRIMARIA   NUMBER
    ,TT2_NT_SECUNDARIA NUMBER);

ALTER TABLE QA_TTT2_OBS
ADD (TT2_NT_PRIMARIA   NUMBER
    ,TT2_NT_SECUNDARIA NUMBER);

ALTER TABLE QA_TTT2_TEMP
ADD (TT2_NT_PRIMARIA   NUMBER
    ,TT2_NT_SECUNDARIA NUMBER);

ALTER TABLE QA_TTT2_BACKUP
ADD (TT2_NT_PRIMARIA   NUMBER
    ,TT2_NT_SECUNDARIA NUMBER);



SELECT *
FROM QA_TTT2_REGISTRO;


UPDATE QA_TTT2_REGISTRO
SET TT2_CANTIDAD_REPOSICIONES = 0
WHERE TT2_CANTIDAD_REPOSICIONES IS NULL;

COMMIT;


UPDATE BRAE.QA_TTT2_REGISTRO T
SET   TT2_CANTIDAD_REPOSICIONES = (
                                   SELECT COUNT(TT2_CODIGOELEMENTO) AS CANTIDAD 
                                   FROM QA_TTT2_REGISTRO
                                   WHERE TT2_CODIGOELEMENTO = T.TT2_CODIGOELEMENTO
                                   HAVING COUNT(TT2_CODIGOELEMENTO)>1
                                   GROUP BY TT2_CODIGOELEMENTO
                                  )
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT TT2_CODIGOELEMENTO 
                            FROM QA_TTT2_REGISTRO
                            HAVING COUNT(TT2_CODIGOELEMENTO)>1
                            GROUP BY TT2_CODIGOELEMENTO
                            )
;


COMMIT;


SELECT TT2_CODIGOELEMENTO,COUNT(TT2_CODIGOELEMENTO) AS CANTIDAD 
FROM QA_TTT2_REGISTRO
HAVING COUNT(TT2_CODIGOELEMENTO)>1
GROUP BY TT2_CODIGOELEMENTO
;

-------------------------------------------ELIMINACION DE REPOSCIIONES INTERMEDIAS PARA MAS DE UNA REPOSCION POR MES


UPDATE QA_TTT2_REGISTRO T
SET   T.TT2_CANTIDAD_REPOSICIONES = 0
WHERE T.TT2_FMODIFICACION  <  (
                                SELECT MAX(TT2_FMODIFICACION) AS TT2_MAX_FECHA 
                                FROM  QA_TTT2_REGISTRO
                                WHERE TT2_CANTIDAD_REPOSICIONES>2
                                AND   TT2_CODIGOELEMENTO = T.TT2_CODIGOELEMENTO
                                AND   TT2_ESTADO = 'RETIRADO'
                                GROUP BY TT2_CODIGOELEMENTO
                              )
AND   T.TT2_CODIGOELEMENTO IN (
                                SELECT TT2_CODIGOELEMENTO 
                                FROM QA_TTT2_REGISTRO
                                WHERE TT2_CANTIDAD_REPOSICIONES>2
                                AND   TT2_ESTADO = 'RETIRADO'
                                GROUP BY TT2_CODIGOELEMENTO
                              )
AND   T.TT2_ESTADO = 'RETIRADO'
;
COMMIT;

DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_CANTIDAD_REPOSICIONES = 0;
COMMIT;

-------------------------------------------------------------------------------


SELECT TT2_CODIGOELEMENTO,MAX(TT2_FMODIFICACION) AS TT2_MAX_FECHA 
FROM QA_TTT2_REGISTRO
WHERE TT2_CANTIDAD_REPOSICIONES>1
--AND   TT2_ESTADO = 'RETIRADO'
GROUP BY TT2_CODIGOELEMENTO
;


UPDATE QA_TTT2_REGISTRO
SET   TT2_CANTIDAD_REPOSICIONES=1
WHERE TT2_CANTIDAD_REPOSICIONES=0;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CANTIDAD_REPOSICIONES IN (1);

COMMIT;


/*
01/01/2021 00:00:00
13/07/2022 23:00:39
*/
ROLLBACK;


--MODIFICAR COLUMNA TT2_CANTIDAD_REPOSICIONES TO TT2_CANTIDAD

ALTER TABLE QA_TTT2_REGISTRO
RENAME COLUMN TT2_CANTIDAD_REPOSICIONES TO TT2_CANTIDAD;
       
ALTER TABLE QA_TTT2_BRAFO
RENAME COLUMN TT2_CANTIDAD_REPOSICIONES TO TT2_CANTIDAD;

ALTER TABLE QA_TTT2_OBS
RENAME COLUMN TT2_CANTIDAD_REPOSICIONES TO TT2_CANTIDAD;

ALTER TABLE QA_TTT2_TEMP
RENAME COLUMN TT2_CANTIDAD_REPOSICIONES TO TT2_CANTIDAD;

ALTER TABLE QA_TTT2_BACKUP
RENAME COLUMN TT2_CANTIDAD_REPOSICIONES TO TT2_CANTIDAD;

----------------GENERACION FORAMTO TC6 JULIO 2022
SELECT  TC1_TC1
      , TC1_CODCONEX
      , TT2_AP_POTENCIA AS TC1_POTENCIA
      , TC1_IDCOMER
      , TC1_CODDANE 
      , MUND_DESCRIPCION
FROM QA_TTC1
LEFT OUTER JOIN (SELECT TT2_CODIGOELEMENTO
                       ,TT2_AP_POTENCIA
                 FROM QA_TTT2_REGISTRO
                 WHERE TT2_ESTADO='OPERACION') ON TT2_CODIGOELEMENTO =  TC1_CODCONEX
LEFT OUTER JOIN QA_TMUNDANE ON MUND_MUNDANE = SUBSTR(TC1_CODDANE,1,5)                
WHERE TC1_PERIODO=202207
AND TC1_TC1 LIKE 'CALP%';




--************************************************************ DEPURACION DE CAMPOS DEL FORMATO TT2*******************************
SELECT DISTINCT TT2_IUL FROM QA_TTT2_REGISTRO;

SELECT TT2_CODIGOELEMENTO,TT2_NOMBRE_CIRCUITO FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN('1T08030',	'1T08032',	'1T08033',	'2T01495',	'2T01954',	'1T02739',	'1T02482',	'1T06685',	'1T02263',	'1T04584',	'1T08793',	'1T09652',	'1T01674',	'1T08948',	'1T11209',	'1T08034',	'4T01421',	'4T01422',	'4T01423',	'4T01424',	'4T01425',	'4T01426',	'4T01427',	'4T01429',	'4T01430',	'4T01431',	'4T01552',	'4T01553',	'4T01554',	'4T01551',	'4T01556',	'4T01519',	'1T12684',	'1T11167',	'5T01227',	'5T02729',	'2T01885',	'1T01731',	'1T06765',	'1T08029',	'4T01428',	'4T01520',	'1T12869',	'1T00340',	'5T02735',	'2T02425',	'1T09818',	'1T10895',	'4T00361');

/*
TT2_CODIGOPROYECTO
TT2_UNIDAD_CONSTRUCTIVA
TT2_RPP
TT2_SALINIDAD
TT2_TIPOINVERSION
TT2_REMUNERACION_PENDIENTE
TT2_ALTERNATIVA_VALORACION
TT2_ID_PLAN
TT2_CANTIDAD
TT2_FESTADO
TT2_FCOLOCACION
TT2_FMODIFICACION
TT2_USR_COLOCACION
TT2_USR_MODFICACION
TT2_PERIODO_OP
TT2_ESTADOREPORTE
TT2_FSISTEMA
TT2_ACTIVOCONEXION
TT2_ACTIVOPROVISIONAL
TT2_AP_POTENCIA
TT2_CODE_CALP
TT2_FASES
TT2_POBLACION
TT2_VALOR_UC
TT2_OBSERVACIONES
TT2_LOCALIZACION
TT2_MUNICIPIO
TT2_DEPARTAMENTO
TT2_NT_PRIMARIA
TT2_NT_SECUNDARIA

*/


SELECT TT2_CODIGOELEMENTO
      ,TT2_NOMBRE_CIRCUITO 
FROM QA_TTT2_TEMP
WHERE  TT2_IUL IS NULL;

SELECT * FROM QA_TTT2_REGISTRO;



--22.625

SELECT * FROM ALL_TABLES
WHERE OWNER LIKE 'BRAE%'
AND TABLE_NAME LIKE 'QA_TTT2%';

DELETE FROM QA_TTT2_BACKUP;
COMMIT;
 
INSERT INTO QA_TTT2_BACKUP
SELECT * FROM QA_TTT2_REGISTRO;
COMMIT;

SELECT MAX(TT2_PERIODO_OP) FROM QA_TTT2_REGISTRO;

EXEC QA_PTT2_REGISTRO(DATE'2022-08-01');

--VERIFICACION DE TRANSFORMADORES SIN CODIGOS IUL
SELECT TT2_CODIGOELEMENTO
      ,TT2_NOMBRE_CIRCUITO 
FROM QA_TTT2_TEMP
WHERE  TT2_IUL IS NULL;--1T06765


SELECT DISTINCT TT2_CODIGOELEMENTO, TT2_NOMBRE_CIRCUITO 
FROM QA_TTT2_TEMP
WHERE  TT2_IUL IS NULL
AND TT2_NOMBRE_CIRCUITO NOT LIKE 'SIN CIRCUITO';


--VERIFICACION DE CUANTOS ESTAN EN TC1

SELECT TT2_NOMBRE_CIRCUITO,COUNT(TT2_NOMBRE_CIRCUITO)  AS CANTIDAD
FROM QA_TTC1
LEFT OUTER JOIN (
                    SELECT DISTINCT TT2_CODIGOELEMENTO, TT2_NOMBRE_CIRCUITO 
                    FROM QA_TTT2_TEMP
                    WHERE  TT2_IUL IS NULL
                    AND TT2_NOMBRE_CIRCUITO NOT LIKE 'SIN CIRCUITO' 
                 ) ON TT2_CODIGOELEMENTO=TC1_CODCONEX
WHERE TC1_PERIODO=202207
AND   TC1_CODCONEX IN (
                        SELECT TT2_CODIGOELEMENTO
                        FROM QA_TTT2_TEMP
                        WHERE  TT2_IUL IS NULL
                        AND TT2_NOMBRE_CIRCUITO NOT IN ('SIN CIRCUITO','ECO')
                      )
GROUP BY TT2_NOMBRE_CIRCUITO
ORDER BY CANTIDAD DESC;



SELECT * FROM QA_tTT2_REGISTRO;


SELECT * FROM QA_TTC1
WHERE TC1_PERIODO=202204
AND   TC1_TC1 IN ('1051762'
,'418974'
,'420879'
,'682402'
);



/*******************************************************************************************************************************
***************************************GENERACION BRA11 AGOSTO 2022*************************************************************
*******************************************************************************************************************************/


SELECT * FROM QA_TBRA11_REGISTRO
WHERE BRA11_PERIODO_OP=DATE'2022-08-01';

EXEC QA_PBRA11_REGISTRO(DATE'2022-08-01');

    SELECT COUNT(DISTINCT FDD_AJUSTADO) AS AJUSTADO
    --INTO AJUSTADO
    FROM QA_TFDDREGISTRO
    WHERE TRUNC(FDD_FINICIAL,'MM') = TRUNC(DATE'2022-08-01')
    AND   FDD_AJUSTADO = 'S';


EXEC QA_PBRA11_REPORTE(DATE'2022-08-01');

SELECT * FROM QA_TBRA11_REPORTE
WHERE BRA11_PERIODO_OP=DATE'2022-08-01';





--VERIFICACION DE IUA'S DE TABLA QA_TBRA11_REGISTRO DESDE LA TABLA AC_TBRA11_BASE

SELECT CIRCUITO,IUA AS CODE_BRA11, TT2_CODE_IUA AS CODE_TT2
FROM AC_TBRA11_BASE
LEFT OUTER JOIN (SELECT * FROM QA_TTT2_REGISTRO WHERE TT2_ESTADO='OPERACION') ON TT2_CODIGOELEMENTO=CIRCUITO
WHERE CIRCUITO NOT LIKE '%R%'
AND TT2_CODE_IUA <> IUA; -- 962  Rows QUE DEBEN SER SOLUCIONADAS CON LA DIF DE IUA.
--------------
SELECT TT2_CODIGOELEMENTO 
FROM QA_TTT2_REGISTRO
WHERE TT2_ACTIVOCONEXION=0
AND   TT2_ACTIVOPROVISIONAL=0
AND   TT2_ESTADO='OPERACION'

MINUS

SELECT CIRCUITO FROM AC_TBRA11_BASE
WHERE ESTADO=2
;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO = '1T04026';


SELECT * FROM QA_TTT2_OBS;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN (SELECT TT2_CODIGOELEMENTO
                             FROM QA_TTT2_REGISTRO
                             GROUP BY TT2_CODIGOELEMENTO
                             HAVING COUNT(TT2_CODIGOELEMENTO)>2)
AND TT2_ESTADO='RETIRADO'
AND TT2_CLASS_CARGA IS NULL;

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO 
WHERE TT2_CODIGOELEMENTO IN (SELECT TT2_CODIGOELEMENTO
                            FROM QA_TTT2_REGISTRO
                            GROUP BY TT2_CODIGOELEMENTO
                            HAVING COUNT(TT2_CODIGOELEMENTO)>1);
;

SELECT * FROM QA_TTT2_TEMP
WHERE TT2_CODIGOELEMENTO IN ('1T03386',
'3T02425',
'5T00988',
'1T06095',
'1T03627',
'3T01677',
'3T02418',
'1T06240',
'3T01150',
'3T01647',
'1T12906',
'1T03524',
'1T06473',
'3T01664',
'3T02382',
'1T06491',
'1T04251',
'1T04695',
'3T01532',
'1T03395',
'1T06093',
'1T04274',
'1T03586',
'1T03587',
'1T06243',
'1T06322',
'1T03416',
'3T04413',
'1T06502',
'3T02350',
'1T04191',
'1T05071',
'1T03460',
'1T04200');


ROLLBACK;

UPDATE QA_TTT2_TEMP
SET   TT2_FMODIFICACION = ADD_MONTHS(TT2_FMODIFICACION,1)
WHERE TT2_CODIGOELEMENTO IN ('1T03386',	'3T02425',	'5T00988',	'1T06095',	'1T03627',	'3T01677',	'3T02418',	'1T06240',	'3T01150',	'3T01647',	'1T12906',	'1T03524',	'1T06473',	'3T01664',	'3T02382',	'1T06491',	'1T04251',	'1T04695',	'3T01532',	'1T03395',	'1T06093',	'1T04274',	'1T03586',	'1T03587',	'1T06243',	'1T06322',	'1T03416',	'3T04413',	'1T06502',	'3T02350',	'1T04191',	'1T05071',	'1T03460',	'1T04200');


UPDATE QA_TTT2_TEMP
SET   TT2_FMODIFICACION = ADD_MONTHS(TT2_FMODIFICACION,9)
WHERE TT2_CODIGOELEMENTO = '3T02418'
AND   TT2_FMODIFICACION = '07/12/2021 16:35:55';


COMMIT;

DELETE FROM QA_TTT2_BACKUP;
COMMIT;

INSERT INTO QA_TTT2_BACKUP
SELECT * FROM QA_TTT2_REGISTRO;
COMMIT;

EXEC QA_PTT2_REGISTRO(DATE'2022-10-01');

SELECT * FROM QA_TTT2_OBS;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('1T03386',	'3T02425',	'5T00988',	'1T06095',	'1T03627',	'3T01677',	'3T02418',	'1T06240',	'3T01150',	'3T01647',	'1T12906',	'1T03524',	'1T06473',	'3T01664',	'3T02382',	'1T06491',	'1T04251',	'1T04695',	'3T01532',	'1T03395',	'1T06093',	'1T04274',	'1T03586',	'1T03587',	'1T06243',	'1T06322',	'1T03416',	'3T04413',	'1T06502',	'3T02350',	'1T04191',	'1T05071',	'1T03460',	'1T04200');


SELECT * FROM QA_TTT2_REGISTRO 
WHERE TT2_CODIGOELEMENTO IN (SELECT TT2_CODIGOELEMENTO
                            FROM QA_TTT2_REGISTRO
                            GROUP BY TT2_CODIGOELEMENTO
                            HAVING COUNT(TT2_CODIGOELEMENTO)>2)
AND TT2_ESTADO='RETIRADO'
AND TT2_CLASS_CARGA IS NULL;


DELETE FROM QA_TTT2_REGISTRO 
WHERE TT2_CODIGOELEMENTO IN (SELECT TT2_CODIGOELEMENTO
                            FROM QA_TTT2_REGISTRO
                            GROUP BY TT2_CODIGOELEMENTO
                            HAVING COUNT(TT2_CODIGOELEMENTO)>2)
AND TT2_ESTADO='RETIRADO'
AND TT2_CLASS_CARGA IS NULL;

COMMIT;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN (SELECT TT2_CODIGOELEMENTO
                            FROM QA_TTT2_REGISTRO
                            GROUP BY TT2_CODIGOELEMENTO
                            HAVING COUNT(TT2_CODIGOELEMENTO)=2);
;

SELECT * FROM QA_TTT2_BACKUP;

select * from qa_ttt2_registro;

EXEC QA_PBRA11_REGISTRO(DATE'2022-10-01');
EXEC QA_PBRA11_REPORTE(DATE'2022-10-01');

SELECT * FROM QA_TBRA11_REPORTE
WHERE BRA11_PERIODO_OP=DATE'2022-10-01';


SELECT * FROM QA_TBRA11_REGISTRO
WHERE BRA11_PERIODO_OP=DATE'2022-10-01';

SELECT   TT2_PERIODO_OP AS BRA11_PERIODO_OP
                ,TT2_CODIGOELEMENTO AS BRA11_CODIGOELEMENTO
                ,TT2_CODIGOPROYECTO AS BRA11_CODIGOPROYECTO
                ,TT2_IUL AS BRA11_IUL
                ,(CASE WHEN(TT2_ESTADO_BRA11<>'PLANEACION') THEN(TT2_CODE_IUA) ELSE(NULL)  END) AS BRA11_CODE_IUA
                ,(CASE WHEN(TT2_ESTADO_BRA11 ='PLANEACION') THEN(TT2_CODE_IUA) ELSE(NULL)  END) AS BRA11_CODE_IUA_PRO
                ,TT2_UNIDAD_CONSTRUCTIVA AS BRA11_UNIDAD_CONSTRUCTIVA
                ,TT2_RPP AS BRA11_RPP
                ,TT2_SALINIDAD AS BRA11_SALINIDAD
                ,TT2_TIPOINVERSION AS BRA11_TIPOINVERSION
                ,TT2_OBSERVACIONES AS BRA11_OBSERVACIONES
                ,TRUNC(TT2_PERIODO_OP,'YYYY') AS BRA11_FESTADO
                ,TT2_REMUNERACION_PENDIENTE AS BRA11_REMUNERACION_PENDIENTE
                ,(CASE WHEN(TT2_ESTADO_BRA11 = 'OPERACION'   ) THEN(2)
                       WHEN(TT2_ESTADO_BRA11 = 'RETIRADO'    ) THEN(3)
                       WHEN(TT2_ESTADO_BRA11 = 'PLANEACION'  ) THEN(1)
                  END)   AS BRA11_ESTADO
                ,TT2_RESMETODOLOGIA AS BRA11_RESMETODOLOGIA
                ,(CASE WHEN(TT2_ALTERNATIVA_VALORACION = 'BRAEN') THEN(6) 
                       WHEN(TT2_ALTERNATIVA_VALORACION = 'BRAFO') THEN(3)
                       WHEN(TT2_ALTERNATIVA_VALORACION = 'INVA' ) THEN(5) 
                  END) AS BRA11_ALTERNATIVA_VALORACION 
                ,TT2_ID_PLAN AS BRA11_ID_PLAN
                ,(CASE WHEN(TT2_TIPOINVERSION IN (1,3)) THEN(1) ELSE(0) END) AS BRA11_CANTIDAD_REPOSICIONES
                ,TT2_IDMERCADO AS BRA11_IDMERCADO
        FROM QA_TTT2_REGISTRO
        WHERE TT2_PERIODO_OP=TRUNC(DATE'2022-10-01');

SELECT MAX(BRA11_PERIODO_OP) FROM QA_TBRA11_REGISTRO;



SELECT CIRCUITO,IUA AS CODE_BRA11, TT2_CODE_IUA AS CODE_TT2
FROM AC_TBRA11_BASE
LEFT OUTER JOIN (SELECT * FROM QA_TTT2_REGISTRO WHERE TT2_ESTADO='OPERACION') ON TT2_CODIGOELEMENTO=CIRCUITO
WHERE CIRCUITO NOT LIKE '%R%'
--AND TT2_CODE_IUA <> IUA;
AND TT2_CODIGOELEMENTO IN ('1T04440',	'3T00809',	'1T08778',	'1T07381',	'1T04936',	'3T03106',	'1T00027',	'1T03233',	'4T00182',	'1T03811',	'5T02581',	'4T00115',	'4T00829',	'1T03462',	'1T10107',	'1T06778',	'3T00967',	'1T03713',	'1T03942',	'1T04341',	'3T00248',	'2T01317',	'1T02880',	'1T00568',	'1T10117',	'1T08159',	'3T01138',	'3T01822',	'2T01630',	'4T00038',	'5T00338',	'3T00566',	'1T12340',	'1T03261',	'4T00564',	'1T00633',	'1T09150',	'5T00099',	'1T07830',	'3T04041',	'1T01798',	'1T11637',	'4T00243',	'1T09032',	'3T01817',	'3T00714',	'3T01558',	'1T08756',	'1T03280',	'2T01433',	'3T02924',	'4T00650',	'5T01055',	'1T02332',	'1T10486',	'2T01009',	'1T00537',	'4T01218',	'1T02185',	'1T09213',	'1T00717',	'1T02714',	'4T01002',	'4T00898',	'3T02389',	'1T07674',	'4T00179',	'2T00153',	'3T01153',	'1T04695',	'1T03228',	'4T01027',	'5T00533',	'1T08674',	'3T01546',	'1T04311',	'1T01444',	'1T07901',	'1T03868',	'1T10876',	'1T07907',	'1T02795')
;


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODE_IUA IN ('100ICZ009Z',	'100IBC009Z',	'100IC40101',	'100J51009Z',	'100J540102',	'100J3F0101',	'100J5A009C',	'100J4G009Z',	'100J4I0101',	'100J3G0101',	'100J3H0101',	'100J4J0101',	'100J78009Z',	'100J4K009Z',	'100J6U009Z',	'100J4M009Z',	'100J5Y0101',	'100J4N0094',	'100J4O0102',	'100J75009B',	'100J4P0102',	'100J4R009Z',	'100J4S009Z',	'100J6E0101',	'100J4U0102',	'100J4V0101',	'100J4W009Z',	'100J3I009Z',	'100J3J0101',	'100J52009Z',	'100J3K0101',	'100J550103',	'100J3L0101',	'100J3M009Z',	'100J3N0101',	'100J3O009Z',	'100J3P009Z',	'100J3Q009Z',	'100J690094',	'100J6A0102',	'100J3W0101',	'100J6B0102',	'100J4X009Z',	'100J4Y009Z',	'100J770097',	'100J5W0092',	'100J610102',	'100J620107',	'100J630102',	'100J640102',	'100J3X0102',	'100J3Y009Z',	'100J3Z0104',	'100J67009B',	'100J68009C',	'100J53009Z',	'100J5M0101',	'100J6Z009C',	'100J72009B',	'100J40009B',	'100J6T009D',	'100J6O0101',	'100J6P010A',	'100J410098',	'100J420101',	'100J43009Z',	'100J440101',	'100J46009Z',	'100J470098',	'100J480101',	'100J490101',	'100J6D009C',	'100J6C0103',	'100J66009B',	'100J4B0101',	'100J650094',	'100J350098',	'100J36009B',	'100J380098',	'100J390102',	'100J3A009Z',	'100J3B0104',	'100J3D0101',	'100J5H009Z',	'100J5J009Z',	'100J4C0101',	'100J4D009Z',	'100J4E009Z',	'100J4F009Z',	'100J58009B');


SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('1T04822',	'3T00766',	'4T00414',	'1T04855',	'1T05050',	'1T05074',	'4T00070',	'4T00183',	'4T00203',	'1T05088',	'1T06076',	'4T00317',	'4T00480',	'4T00491',	'4T00504',	'4T01206',	'4T01445',	'5T00072',	'5T00256',	'5T00257',	'5T00484',	'5T00743',	'5T00750',	'5T00826',	'5T01445',	'5T01502',	'5T01816',	'1T06198',	'1T06203',	'1T06215',	'1T06245',	'1T06306',	'1T06314',	'1T06417',	'1T06444',	'1T06450',	'1T06503',	'1T06710',	'1T07189',	'1T08218',	'1T08643',	'1T08657',	'5T02456',	'5T02518',	'5T02961',	'5T02967',	'5T02968',	'5T02969',	'5T02970',	'5T02971',	'1T09307',	'1T09313',	'1T09316',	'1T10305',	'1T10374',	'1T10573',	'1T10831',	'1T13000',	'1T13014',	'1T13060',	'1T13076',	'1T13098',	'1T13099',	'2T00049',	'2T01109',	'3T00717',	'3T00741',	'3T01445',	'3T01756',	'3T01994',	'3T02384',	'1T00030',	'1T00057',	'1T01491',	'3T02512',	'1T01856',	'1T02217',	'1T02218',	'1T02967',	'1T03267',	'1T03886',	'1T04374',	'1T04694',	'1T04707',	'1T04728',	'3T02887',	'3T02916',	'3T03578',	'3T03815',	'4T00008');


DELETE FROM QA_TTT2_BACKUP;
COMMIT;

INSERT INTO QA_TTT2_BACKUP
SELECT * FROM QA_TTT2_REGISTRO;
COMMIT;

CREATE TABLE TT2_TEMPORAL AS
SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('1T04822',	'3T00766',	'4T00414',	'1T04855',	'1T05050',	'1T05074',	'4T00070',	'4T00183',	'4T00203',	'1T05088',	'1T06076',	'4T00317',	'4T00480',	'4T00491',	'4T00504',	'4T01206',	'4T01445',	'5T00072',	'5T00256',	'5T00257',	'5T00484',	'5T00743',	'5T00750',	'5T00826',	'5T01445',	'5T01502',	'5T01816',	'1T06198',	'1T06203',	'1T06215',	'1T06245',	'1T06306',	'1T06314',	'1T06417',	'1T06444',	'1T06450',	'1T06503',	'1T06710',	'1T07189',	'1T08218',	'1T08643',	'1T08657',	'5T02456',	'5T02518',	'5T02961',	'5T02967',	'5T02968',	'5T02969',	'5T02970',	'5T02971',	'1T09307',	'1T09313',	'1T09316',	'1T10305',	'1T10374',	'1T10573',	'1T10831',	'1T13000',	'1T13014',	'1T13060',	'1T13076',	'1T13098',	'1T13099',	'2T00049',	'2T01109',	'3T00717',	'3T00741',	'3T01445',	'3T01756',	'3T01994',	'3T02384',	'1T00030',	'1T00057',	'1T01491',	'3T02512',	'1T01856',	'1T02217',	'1T02218',	'1T02967',	'1T03267',	'1T03886',	'1T04374',	'1T04694',	'1T04707',	'1T04728',	'3T02887',	'3T02916',	'3T03578',	'3T03815',	'4T00008');
;

DELETE FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('1T04822',	'3T00766',	'4T00414',	'1T04855',	'1T05050',	'1T05074',	'4T00070',	'4T00183',	'4T00203',	'1T05088',	'1T06076',	'4T00317',	'4T00480',	'4T00491',	'4T00504',	'4T01206',	'4T01445',	'5T00072',	'5T00256',	'5T00257',	'5T00484',	'5T00743',	'5T00750',	'5T00826',	'5T01445',	'5T01502',	'5T01816',	'1T06198',	'1T06203',	'1T06215',	'1T06245',	'1T06306',	'1T06314',	'1T06417',	'1T06444',	'1T06450',	'1T06503',	'1T06710',	'1T07189',	'1T08218',	'1T08643',	'1T08657',	'5T02456',	'5T02518',	'5T02961',	'5T02967',	'5T02968',	'5T02969',	'5T02970',	'5T02971',	'1T09307',	'1T09313',	'1T09316',	'1T10305',	'1T10374',	'1T10573',	'1T10831',	'1T13000',	'1T13014',	'1T13060',	'1T13076',	'1T13098',	'1T13099',	'2T00049',	'2T01109',	'3T00717',	'3T00741',	'3T01445',	'3T01756',	'3T01994',	'3T02384',	'1T00030',	'1T00057',	'1T01491',	'3T02512',	'1T01856',	'1T02217',	'1T02218',	'1T02967',	'1T03267',	'1T03886',	'1T04374',	'1T04694',	'1T04707',	'1T04728',	'3T02887',	'3T02916',	'3T03578',	'3T03815',	'4T00008');
;
COMMIT;



SELECT * FROM TT2_TEMPORAL;

DESC QA_TTT2_REGISTRO;

INSERT INTO TT2_TEMPORAL
SELECT 	TT2_CODIGOELEMENTO
,NULL	TT2_CODE_IUA
,	TT2_GRUPOCALIDAD
,	TT2_IDMERCADO
,	TT2_CAPACIDAD
,	TT2_PROPIEDAD
,	TT2_TSUBESTACION
,	TT2_LONGITUD
,	TT2_LATITUD
,	TT2_ALTITUD
,	TT2_ESTADO
,	TT2_ESTADO_BRA11
,	TT2_RESMETODOLOGIA
,	TT2_CLASS_CARGA
,	TT2_NOMBRE_CIRCUITO
,	TT2_IUL
,	TT2_CODIGOPROYECTO
,	TT2_UNIDAD_CONSTRUCTIVA
,	TT2_RPP
,	TT2_SALINIDAD
,	TT2_TIPOINVERSION
,	TT2_REMUNERACION_PENDIENTE
,	TT2_ALTERNATIVA_VALORACION
,	TT2_ID_PLAN
,	TT2_CANTIDAD
,	TT2_FESTADO
,	TT2_FCOLOCACION
,	TT2_FMODIFICACION
,	TT2_USR_COLOCACION
,	TT2_USR_MODFICACION
,	TT2_PERIODO_OP
,	TT2_ESTADOREPORTE
,	TT2_FSISTEMA
,	TT2_ACTIVOCONEXION
,	TT2_ACTIVOPROVISIONAL
,	TT2_AP_POTENCIA
,	TT2_CODE_CALP
,	TT2_FASES
,	TT2_POBLACION
,	TT2_VALOR_UC
,	TT2_OBSERVACIONES
,	TT2_LOCALIZACION
,	TT2_MUNICIPIO
,	TT2_DEPARTAMENTO
,	TT2_NT_PRIMARIA
,	TT2_NT_SECUNDARIA
 FROM TT2_TEMPORAL;
 
 
 SELECT * FROM TT2_TEMPORAL
 WHERE TT2_CODE_IUA IS NOT NULL;
 
 
 UPDATE TT2_TEMPORAL
 SET   TT2_ESTADO='RETIRADO'
 ,     TT2_ESTADO_BRA11='RETIRADO'
 ,     TT2_OBSERVACIONES = 'Retirado por Recodificacion'
 ,     TT2_PERIODO_OP=DATE'2022-10-01'
 WHERE TT2_CODE_IUA IS NOT NULL;
 
 COMMIT;
 
 SELECT * FROM TT2_TEMPORAL
 WHERE TT2_CODE_IUA IS NULL;
 
 
 SELECT * FROM QA_TTT2_REGISTRO;
 
 
 
 UPDATE TT2_TEMPORAL T
 SET   TT2_CODE_IUA = (SELECT IUA FROM AC_TBRA11_BASE WHERE CIRCUITO = T.TT2_CODIGOELEMENTO)
 ,     TT2_OBSERVACIONES = 'Reposicion por Recodificacion'
 ,     TT2_PERIODO_OP=DATE'2022-10-01'
 WHERE TT2_CODE_IUA IS NULL;
 
 
 SELECT * FROM TT2_TEMPORAL
 WHERE TT2_ESTADO='OPERACION'
 ;
 
 COMMIT;
 
 INSERT INTO QA_TTT2_REGISTRO
 SELECT * FROM TT2_TEMPORAL;
 
 
 
SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN (SELECT TT2_CODIGOELEMENTO
                            FROM QA_TTT2_REGISTRO
                            GROUP BY TT2_CODIGOELEMENTO
                            HAVING COUNT(TT2_CODIGOELEMENTO)=2);
                            
 
 --VERIFICACION DE IUA'S DE TABLA QA_TBRA11_REGISTRO DESDE LA TABLA AC_TBRA11_BASE

SELECT CIRCUITO,IUA AS CODE_BRA11, TT2_CODE_IUA AS CODE_TT2
FROM AC_TBRA11_BASE
LEFT OUTER JOIN (SELECT * FROM QA_TTT2_REGISTRO WHERE TT2_ESTADO='OPERACION') ON TT2_CODIGOELEMENTO=CIRCUITO
WHERE CIRCUITO NOT LIKE '%R%'
AND TT2_CODE_IUA <> IUA; 


--------------
SELECT TT2_CODIGOELEMENTO 
FROM QA_TTT2_REGISTRO
WHERE TT2_ACTIVOCONEXION=0
AND   TT2_ACTIVOPROVISIONAL=0
AND   TT2_ESTADO='OPERACION'
AND   TT2_NOREPORT_CREG = 0

MINUS

SELECT CIRCUITO FROM AC_TBRA11_BASE
WHERE ESTADO=2
;



ALTER TABLE QA_TTT2_REGISTRO
ADD TT2_NOREPORT_CREG NUMBER;

ALTER TABLE QA_TTT2_BRAFO
ADD TT2_NOREPORT_CREG NUMBER;

ALTER TABLE QA_TTT2_OBS
ADD TT2_NOREPORT_CREG NUMBER;

ALTER TABLE QA_TTT2_TEMP
ADD TT2_NOREPORT_CREG NUMBER;

ALTER TABLE QA_TTT2_BACKUP
ADD TT2_NOREPORT_CREG NUMBER;


--MARCAR EL CAMPO

SELECT*FROM QA_TTT2_REGISTRO;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN (
                            SELECT TT2_CODIGOELEMENTO 
                            FROM QA_TTT2_REGISTRO
                            WHERE TT2_ACTIVOCONEXION=0
                            AND   TT2_ACTIVOPROVISIONAL=0
                            AND   TT2_ESTADO='OPERACION'
                        MINUS
                            SELECT CIRCUITO FROM AC_TBRA11_BASE
                            WHERE ESTADO=2)
;


UPDATE QA_TTT2_REGISTRO
SET TT2_NOREPORT_CREG = 0
WHERE TT2_CODIGOELEMENTO NOT IN (
                            SELECT TT2_CODIGOELEMENTO 
                            FROM QA_TTT2_REGISTRO
                            WHERE TT2_ACTIVOCONEXION=0
                            AND   TT2_ACTIVOPROVISIONAL=0
                            AND   TT2_ESTADO='OPERACION'
                        MINUS
                            SELECT CIRCUITO FROM AC_TBRA11_BASE
                            WHERE ESTADO=2)
;


COMMIT;


SELECT * FROM QA_TTT2_REGISTRO;


SELECT * FROM AC_TBRA11_BASE
WHERE CIRCUITO IN (
                    SELECT CIRCUITO FROM AC_TBRA11_BASE
                    WHERE ESTADO=2
                    AND   CIRCUITO  NOT LIKE '%R%'
                    
                    MINUS
                    
                    SELECT TT2_CODIGOELEMENTO 
                    FROM QA_TTT2_REGISTRO
                    WHERE   TT2_ESTADO='OPERACION' 
                    --AND   TT2_ACTIVOPROVISIONAL=1
                    AND   TT2_ACTIVOCONEXION=0
                    --AND   TT2_NOREPORT_CREG = 0
                    )
                    ;

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN(
SELECT CIRCUITO FROM AC_TBRA11_BASE
WHERE CIRCUITO IN (
                    SELECT CIRCUITO FROM AC_TBRA11_BASE
                    WHERE ESTADO=2
                    AND   CIRCUITO  NOT LIKE '%R%'
                    
                    MINUS
                    
                    SELECT TT2_CODIGOELEMENTO 
                    FROM QA_TTT2_REGISTRO
                    WHERE   TT2_ESTADO='OPERACION' 
                    --AND   TT2_ACTIVOPROVISIONAL=1
                    AND   TT2_ACTIVOCONEXION=0
                    --AND   TT2_NOREPORT_CREG = 0
                    ))
                    ;
SELECT * FROM QA_TTT2_REPORTE
WHERE TT2_CODE_TRAFO IN ('1T13201');

SELECT * FROM QA_TTT2_REGISTRO
WHERE TT2_CODIGOELEMENTO IN ('1T13201');


commit;



SELECT * FROM QA_TTT12_REPORTE;

EXEC QA_PTT12_REPORTE(DATE'2022-10-01');


SELECT * FROM QA_TTT12_REPORTE
WHERE TT12_NOMBRE_CIRCUITO LIKE 'GAB%';

SELECT * FROM QA_TFDDREGISTRO
WHERE FDD_CODIGOEVENTO='959125'
;



SELECT * FROM QA_TFDDREGISTRO 
WHERE FDD_IUA IN ('100H2C0101',	'100GDR009Z',	'100HFT009Z',	'100H2B0101',	'100H2A009Z',	'100H2D009Z',	'100H9A009Z',	'100HFU009Z',	'100I3F009Z',	'100GDT009Z',	'100HFV009Z',	'100HAC009Z',	'100H7J010D',	'100H5V009Z',	'100GF2009Z',	'100H290102',	'100GDS009Z')
AND TO_CHAR(FDD_FINICIAL,'YYYYMM')='202210'
AND FDD_CAUSA_SSPD='14';

SELECT * FROM QA_TTC1_TEMP
WHERE TC1_IUA IN ('100H2C0101',	'100GDR009Z',	'100HFT009Z',	'100H2B0101',	'100H2A009Z',	'100H2D009Z',	'100H9A009Z',	'100HFU009Z',	'100I3F009Z',	'100GDT009Z',	'100HFV009Z',	'100HAC009Z',	'100H7J010D',	'100H5V009Z',	'100GF2009Z',	'100H290102',	'100GDS009Z')
;


SELECT CODIGOEVENTO AS FDD_CODIGOEVENTO,FINICIAL AS FDD_FINICIAL,FFINAL AS FDD_FFINAL,DURACION AS FDD_DURACION
  ,LISTAGG (NOMBRECIRCUITO, ',') WITHIN GROUP (ORDER BY NOMBRECIRCUITO) AS FDD_CIRCUITOS
      FROM(
            SELECT DISTINCT FDD_CODIGOEVENTO AS CODIGOEVENTO
                  ,  TO_DATE(TO_CHAR(FDD_FINICIAL,'DD/MM/YYYY HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') AS FINICIAL
                  , TO_DATE(TO_CHAR(FDD_FFINAL  ,'DD/MM/YYYY HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') AS FFINAL
                  , ROUND((TO_DATE(TO_CHAR(FDD_FFINAL  ,'DD/MM/YYYY HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS')
                  - TO_DATE(TO_CHAR(FDD_FINICIAL,'DD/MM/YYYY HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS'))*24,2) AS DURACION
                  , TT1_NOMBRECIRCUITO AS NOMBRECIRCUITO
            FROM QA_TFDDREGISTRO R
            --LEFT OUTER JOIN (SELECT * FROM QA_TTT2_REGISTRO WHERE TT2_ESTADO='OPERACION') ON TT2_CODIGOELEMENTO = FDD_CODIGOELEMENTO
            LEFT OUTER JOIN (SELECT DISTINCT TC1_CODCONEX,TC1_CODCIRC FROM QA_TTC1
                             WHERE TC1_PERIODO=202210) ON TC1_CODCONEX = FDD_CODIGOELEMENTO
            LEFT OUTER JOIN QA_TTT1_REGISTRO ON TT1_CODIGOCIRCUITO = TC1_CODCIRC
            WHERE TO_CHAR(FDD_FINICIAL,'MM/YYYY') = TO_CHAR(TO_DATE(:PERIODO,'DD/MM/YYYY'),'MM/YYYY')
            AND FDD_CAUSA_SSPD IN ('14')
            --AND TT1_NOMBRECIRCUITO IS NOT NULL
         )
WHERE CODIGOEVENTO NOT IN(SELECT DISTINCT TT12_CODIGOEVENTO FROM QA_TTT12_TEMP)
GROUP BY CODIGOEVENTO,FINICIAL,FFINAL,DURACION;





SELECT * FROM QA_TTT12_TEMP;

SELECT DISTINCT TC1_CODCONEX,TC1_CODCIRC FROM QA_TTC1
WHERE TC1_PERIODO=202210;

SELECT * FROM QA_TTT12_REPORTE;


SELECT * FROM QA_TTT2_REGISTRO WHERE TT2_FSISTEMA = DATE'2022-11-23';
